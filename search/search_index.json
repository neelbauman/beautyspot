{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\ud83c\udf11 beautyspot","text":"<ul> <li>\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>PyPI</li> <li>\u30e9\u30a4\u30bb\u30f3\u30b9</li> </ul>"},{"location":"#concept","title":"Concept","text":"<p>\"You focus on the logic. We handle the rest.\"</p> <p>\u751f\u6210AI\u306e\u30d0\u30c3\u30c1\u51e6\u7406\u3084\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3001\u91cd\u3044\u8a08\u7b97\u51e6\u7406\u3092\u884c\u3046\u969b\u3001\u672c\u8cea\u7684\u306a\u30ed\u30b8\u30c3\u30af\u4ee5\u5916\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u306e\u306f\u5927\u5909\u3067\u3059\u3088\u306d\u3002</p> <ul> <li>API\u5236\u9650\u3092\u5b88\u308b\u305f\u3081\u306e <code>time.sleep()</code> \u3084\u30c8\u30fc\u30af\u30f3\u8a08\u7b97</li> <li>\u9014\u4e2d\u505c\u6b62\u3057\u305f\u969b\u306e\u30ea\u30ab\u30d0\u30ea\u51e6\u7406\uff08 <code>try-except</code> \u3068 <code>continue</code> \uff09</li> <li>\u7d50\u679c\u3092\u4fdd\u5b58\u30fb\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30ebI/O</li> <li>\u91cd\u8907\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9632\u3050\u305f\u3081\u306eID\u7ba1\u7406</li> </ul> <p><code>beautyspot</code> \u306f\u3001\u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\u306b\u300c\u9ed2\u5b50/\u307b\u304f\u308d\uff08\u30c7\u30b3\u30ec\u30fc\u30bf\uff09\u300d\u3092\u4e00\u3064\u4ed8\u3051\u308b\u3060\u3051\u3067\u3001\u3053\u308c\u3089\u306e\u9762\u5012\u306a\u30a4\u30f3\u30d5\u30e9\u5236\u5fa1\u3092\u3059\u3079\u3066\u5f15\u304d\u53d7\u3051\u308b\u300c\u9ed2\u5b50/\u304f\u308d\u3053\u300d\u3067\u3059\u3002</p> <p>\u8efd\u91cf\u3067\u5c11\u306a\u3044\u4f9d\u5b58\u6027\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u958b\u767a\u306b\u3066\u3053\u306e\u3088\u3046\u306a\u30a4\u30f3\u30d5\u30e9\u3092\u624b\u8efd\u306b\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u76ee\u6307\u3057\u3066\u958b\u767a\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p>v2.0.0 \u3067\u306f\u3001API\u3092\u76f4\u611f\u7684\u306a Spot &amp; Mark \u306e\u6982\u5ff5\u306b\u5237\u65b0\u3057\u3001\u5b9f\u884c\u6642\u306e\u67d4\u8edf\u306a\u5236\u5fa1\u3092\u53ef\u80fd\u306b\u3059\u308b cached_run \u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002</p>"},{"location":"#installation","title":"\u26a1 Installation","text":"<pre><code>pip install beautyspot\n</code></pre> <ul> <li>Standard: <code>msgpack</code> \u304c\u540c\u68b1\u3055\u308c\u3001\u9ad8\u901f\u304b\u3064\u5b89\u5168\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002</li> <li>Options:</li> <li><code>pip install \"beautyspot[s3]\"</code>: S3\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\u5834\u5408</li> <li><code>pip install \"beautyspot[dashboard]\"</code>: \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u5229\u7528\u3059\u308b\u5834\u5408</li> <li><code>pip install \"beautyspot[all]\"</code>: \u5168\u90e8\u5165\u308a</li> </ul>"},{"location":"#quick-start","title":"\ud83d\ude80 Quick Start","text":"<p>\u95a2\u6570\u306b <code>@spot.mark</code> \u3092\u4ed8\u3051\u308b\u3060\u3051\u3067\u3001\u305d\u306e\u95a2\u6570\u304a\u3088\u3073\u5165\u51fa\u529b\u306f\u6c38\u7d9a\u5316\u3055\u308c\u3001\u540c\u3058\u8a08\u7b97\u3092\u7121\u99c4\u306b\u591a\u91cd\u306b\u7e70\u308a\u8fd4\u3059\u3053\u3068\u3092\u83ef\u9e97\u306b\u56de\u907f\u3057\u307e\u3059\u3002</p> <pre><code>import time\nimport beautyspot as bs\n\n# 1. Spot (\u73fe\u5834/\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8) \u3092\u5b9a\u7fa9\n# \u30c7\u30d5\u30a9\u30eb\u30c8\u3067 \"./my_experiment.db\" \u3092\u4f5c\u6210\nspot = bs.Spot(\"my_experiment\")\n\n# 2. Mark (\u5370) \u3092\u4ed8\u3051\u308b\n@spot.mark\ndef heavy_process(text):\n    # \u5b9f\u884c\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u51e6\u7406\u3084\u3001\u8ab2\u91d1\u3055\u308c\u308bAPI\u30b3\u30fc\u30eb\n    time.sleep(2)\n    return f\"Processed: {text}\"\n\n# \u30d0\u30c3\u30c1\u51e6\u7406\ninputs = [\"A\", \"B\", \"C\", \"A\"]\n\nfor i in inputs:\n    # 1. \u521d\u56de\u306e \"A\", \"B\", \"C\" \u306f\u5b9f\u884c\u3055\u308c\u308b\n    # 2. \u6700\u5f8c\u306e \"A\" \u306f\u3001DB\u304b\u3089\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5373\u5ea7\u306b\u8fd4\u308b\uff08\u5b9f\u884c\u6642\u95930\u79d2\uff09\n    # 3. \u9014\u4e2d\u505c\u6b62\u3057\u3066\u3082\u3001\u6b21\u56de\u306f\u300c\u672a\u5b8c\u4e86\u306e\u30bf\u30b9\u30af\u300d\u3060\u3051\u304c\u5b9f\u884c\u3055\u308c\u308b\n    print(heavy_process(i))\n</code></pre>"},{"location":"#key-features","title":"\ud83d\udca1 Key Features","text":"<p><code>beautyspot</code> \u306f\u3001\u5358\u306a\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 \u300c\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08Spot\uff09\u300d\u3068\u3044\u3046\u6982\u5ff5\u3092\u901a\u3058\u3066\u3001\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3001\u6d41\u91cf\u5236\u5fa1\u3001\u305d\u3057\u3066\u30a4\u30f3\u30d5\u30e9\u306e\u62bd\u8c61\u5316\u3092\u4e00\u624b\u306b\u5f15\u304d\u53d7\u3051\u308b\u300c\u9ed2\u5b50\uff08Kuroko\uff09\u300d\u3067\u3059\u3002</p>"},{"location":"#1-core-concepts-spot-mark-v20","title":"1. Core Concepts: Spot &amp; Mark (v2.0)","text":"<p>v2.0 \u3088\u308a\u3001API \u306f\u3088\u308a\u76f4\u611f\u7684\u306a <code>Spot</code> \u3068 <code>mark</code> \u3068\u3044\u3046\u6982\u5ff5\u306b\u5237\u65b0\u3055\u308c\u307e\u3057\u305f\u3002</p> <ul> <li>Spot (\u5834\u6240/\u73fe\u5834): \u30c7\u30fc\u30bf\u4fdd\u5b58\u5148\u3001DB\u63a5\u7d9a\u3001\u30ec\u30fc\u30c8\u5236\u9650\u306e\u8a2d\u5b9a\u306a\u3069\u3092\u7ba1\u7406\u3059\u308b\u300c\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u300d\u3002</li> <li>Mark (\u5370\u4ed8\u3051): \u300c\u3053\u306e\u95a2\u6570\u306f Spot \u306e\u7ba1\u7406\u4e0b\u306b\u7f6e\u304f\u300d\u3068\u3044\u3046\u5ba3\u8a00\u3002</li> </ul> <pre><code>import beautyspot as bs\n\n# 1. Spot (\u73fe\u5834) \u3092\u5b9a\u7fa9\nspot = bs.Spot(\"my_analysis\")\n\n# 2. Mark (\u5370) \u3092\u4ed8\u3051\u308b\n@spot.mark\ndef process(data):\n    return data * 2\n</code></pre>"},{"location":"#2-feature-deep-dive","title":"2. Feature Deep Dive","text":""},{"location":"#1-secure-serialization-msgpack-custom-types","title":"\ud83d\udee1\ufe0f 1. Secure Serialization (Msgpack &amp; Custom Types)","text":"<p>\"No more Pickle.\" <code>beautyspot</code> \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5b89\u5168\u304b\u3064\u9ad8\u901f\u306a Msgpack \u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>Msgpack \u304c\u6a19\u6e96\u3067\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u578b\uff08\u4f8b: \u81ea\u4f5c\u30af\u30e9\u30b9\uff09\u3092\u6271\u3046\u5834\u5408\u3001<code>register_type</code> \u3067\u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u767b\u9332\u3057\u307e\u3059\u3002</p> <pre><code>class MyModel:\n    def __init__(self, name): self.name = name\n\n# \u5909\u63db\u30ed\u30b8\u30c3\u30af\u306e\u767b\u9332 (Code: 0-127)\nspot.register_type(\n    type_=MyModel,\n    code=10,\n    encoder=lambda obj: obj.name.encode('utf-8'),\n    decoder=lambda data: MyModel(data.decode('utf-8'))\n)\n</code></pre>"},{"location":"#2-hybrid-storage-strategy","title":"\ud83d\udcbe 2. Hybrid Storage Strategy","text":"<p>\u30c7\u30fc\u30bf\u306e\u30b5\u30a4\u30ba\u306b\u5fdc\u3058\u3066\u3001\u6700\u9069\u306a\u4fdd\u5b58\u5148\u3092\u81ea\u52d5\u3067\u4f7f\u3044\u5206\u3051\u307e\u3059\u3002</p> <ul> <li>Small Data: SQLite (TaskDB) \u306b\u76f4\u63a5 JSON/BLOB \u3068\u3057\u3066\u4fdd\u5b58\u3002\u9ad8\u901f\u306a\u691c\u7d22\u304c\u53ef\u80fd\u3002</li> <li>Large Data (<code>save_blob=True</code>): \u753b\u50cf\u3084\u5de8\u5927\u306a\u914d\u5217\u306f Storage (File/S3) \u306b\u9003\u304c\u3057\u3001DB\u306b\u306f\u305d\u306e\u30d1\u30b9\u306e\u307f\u3092\u8a18\u9332\u3002DB\u306e\u80a5\u5927\u5316\u3092\u9632\u304e\u307e\u3059\u3002</li> </ul> <pre><code>@spot.mark(save_blob=True)  # \u5de8\u5927\u30c7\u30fc\u30bf\u306fBlob\u3078\ndef generate_image():\n    return b\"...\" * 1024 * 1024\n</code></pre>"},{"location":"#3-rate-limiting-gcra","title":"\ud83d\udea6 3. Rate Limiting (GCRA)","text":"<p>API \u5236\u9650\uff08\u4f8b: 1\u5206\u9593\u306b100\u56de\u307e\u3067\uff09\u3092\u5b88\u308b\u305f\u3081\u306b\u3001GCRA (Generic Cell Rate Algorithm) \u30d9\u30fc\u30b9\u306e\u30ea\u30df\u30c3\u30bf\u30fc\u3092\u642d\u8f09\u3057\u3066\u3044\u307e\u3059\u3002 \u5358\u7d14\u306a\u30b9\u30ea\u30fc\u30d7\u3068\u306f\u7570\u306a\u308a\u3001\u7406\u8ad6\u4e0a\u306e\u5230\u9054\u6642\u523b\uff08TAT\uff09\u3092\u8a08\u7b97\u3059\u308b\u3053\u3068\u3067\u3001\u30d0\u30fc\u30b9\u30c8\uff08\u96c6\u4e2d\u30a2\u30af\u30bb\u30b9\uff09\u3092\u7269\u7406\u7684\u306b\u9632\u304e\u307e\u3059\u3002</p> <pre><code># TPM (Tokens Per Minute) = 60 (1\u79d2\u306b1\u56de)\nspot = bs.Spot(\"api_client\", tpm=60)\n\n@spot.mark\n@spot.limiter(cost=1)  # 1\u56de\u306e\u5b9f\u884c\u30671\u30c8\u30fc\u30af\u30f3\u6d88\u8cbb\ndef call_api():\n    ...\n</code></pre>"},{"location":"#4-dependency-injection-custom-backend","title":"\ud83e\udde9 4. Dependency Injection (Custom Backend)","text":"<p><code>Spot</code> \u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff08DB\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\uff09\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3055\u3048\u6e80\u305f\u305b\u3070\u4f55\u306b\u3067\u3082\u5dee\u3057\u66ff\u3048\u53ef\u80fd\u3067\u3059\u3002 \u3053\u308c\u306b\u3088\u308a\u3001\u300c\u30ed\u30fc\u30ab\u30eb\u5b9f\u9a13\u300d\u304b\u3089\u300c\u30af\u30e9\u30a6\u30c9\u672c\u756a\u74b0\u5883\u300d\u3078\u306e\u79fb\u884c\u304c\u3001\u30b3\u30fc\u30c9\u306e\u5909\u66f4\u306a\u3057\uff08\u8a2d\u5b9a\u306e\u6ce8\u5165\u306e\u307f\uff09\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <ul> <li>TaskDB: \u30e1\u30bf\u30c7\u30fc\u30bf\u7ba1\u7406 (SQLite, Postgres, Redis...)</li> <li>Storage: \u5b9f\u30c7\u30fc\u30bf\u4fdd\u5b58 (Local, S3, GCS...)</li> </ul>"},{"location":"#3-the-advanced-use-case-all-in-one-pipeline","title":"3. \ud83d\ude80 The Advanced Use Case: \"All-in-One Pipeline\"","text":"<p>\u3053\u308c\u3089\u5168\u3066\u306e\u6a5f\u80fd\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u3001\u9ad8\u5ea6\u306a\u30c7\u30fc\u30bf\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u4f8b\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <p>\u30b7\u30ca\u30ea\u30aa:</p> <ul> <li>\u5165\u529b: S3\u4e0a\u306e\u5de8\u5927\u306a\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u7fa4\u3002</li> <li>\u51e6\u7406: \u5916\u90e8API\u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u3092\u89e3\u6790\uff08\u30ec\u30fc\u30c8\u5236\u9650\u304c\u5fc5\u8981\uff09\u3002</li> <li>\u51fa\u529b: \u89e3\u6790\u7d50\u679c\u306e\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08Msgpack\u62e1\u5f35\uff09\u3002</li> <li>\u30a4\u30f3\u30d5\u30e9:</li> <li>\u30e1\u30bf\u30c7\u30fc\u30bf\u306f Redis \u3067\u9ad8\u901f\u306b\u5171\u6709\u7ba1\u7406\u3057\u305f\u3044\uff08Custom DB\uff09\u3002</li> <li>\u7d50\u679c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f GCS (Google Cloud Storage) \u306b\u4fdd\u5b58\u3057\u305f\u3044\uff08Custom Storage\uff09\u3002</li> <li>\u30d5\u30a1\u30a4\u30eb\u306e\u66f4\u65b0\u65e5\u6642\u3092\u898b\u3066\u3001\u5909\u66f4\u304c\u3042\u3063\u305f\u5834\u5408\u306e\u307f\u518d\u8a08\u7b97\u3057\u305f\u3044\uff08Smart Caching\uff09\u3002</li> </ul>"},{"location":"#implementation","title":"Implementation","text":"<pre><code>import os\nimport json\nimport time\nfrom typing import Any, Dict, Optional\n\nimport redis\nfrom google.cloud import storage as gcs\n\nimport beautyspot as bs\nfrom beautyspot.db import TaskDB\nfrom beautyspot.storage import BlobStorageBase\nfrom beautyspot.cachekey import KeyGen\n\n# --- 1. Custom Components Implementation (\u7701\u7565: \u8a73\u7d30\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u53c2\u7167) ---\n# RedisTaskDB, GCSStorage \u30af\u30e9\u30b9\u306e\u5b9f\u88c5...\n\n# --- 2. Custom Data Type ---\n\nclass AnalysisResult:\n    \"\"\"API\u89e3\u6790\u7d50\u679c\u3092\u4fdd\u6301\u3059\u308b\u30ab\u30b9\u30bf\u30e0\u30af\u30e9\u30b9\"\"\"\n    def __init__(self, score: float, summary: str):\n        self.score = score\n        self.summary = summary\n\n# --- 3. Constructing the \"Spot\" ---\n\n# \u4f9d\u5b58\u6027\u306e\u6ce8\u5165 (Dependency Injection)\nmy_db = RedisTaskDB(host=\"redis-server\")\nmy_storage = GCSStorage(bucket_name=\"my-app-blobs\")\n\n# Spot\u306e\u521d\u671f\u5316\n# tpm=60: API\u5236\u9650 (1\u5206\u9593\u306b60\u56de) \u3092\u8a2d\u5b9a\nspot = bs.Spot(\n    name=\"production_pipeline\",\n    db=my_db,\n    storage=my_storage,\n    tpm=60\n)\n\n# \u30ab\u30b9\u30bf\u30e0\u578b\u306e\u767b\u9332\nspot.register_type(\n    type_=AnalysisResult,\n    code=20,\n    encoder=lambda o: json.dumps({\"s\": o.score, \"t\": o.summary}).encode(),\n    decoder=lambda b: AnalysisResult(**{k:v for k,v in json.loads(b).items() if k in [\"s\",\"t\"]})\n)\n\n# --- 4. The \"Marked\" Logic ---\n\n@spot.mark(\n    save_blob=True,                     # 1. \u7d50\u679c\u306fGCS\u3078 (Blob)\n    input_key_fn=KeyGen.from_path_stat, # 2. \u30d5\u30a1\u30a4\u30eb\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u898b\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u5224\u5b9a\n    version=\"v2.0.1\",                   # 3. \u30ed\u30b8\u30c3\u30af\u5909\u66f4\u6642\u306f\u3053\u3053\u3092\u5909\u3048\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u7121\u52b9\u5316\n    content_type=\"application/json\"     # 4. \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u8868\u793a\u7528\u30d2\u30f3\u30c8\n)\n@spot.limiter(cost=1)                   # 5. \u30ec\u30fc\u30c8\u5236\u9650\u3092\u9069\u7528\ndef analyze_log_file(file_path: str) -&gt; AnalysisResult:\n    \"\"\"\n    \u91cd\u3044\u51e6\u7406\u306e\u5b9f\u4f53\u3002\n    \"\"\"\n    print(f\"Processing {file_path}...\")\n    time.sleep(0.5) \n    return AnalysisResult(score=0.95, summary=f\"Processed {os.path.basename(file_path)}\")\n\n# --- 5. Execution ---\n\nif __name__ == \"__main__\":\n    files = [\"/data/log1.txt\", \"/data/log2.txt\"]\n\n    # \u30d0\u30c3\u30c1\u51e6\u7406\u3068\u3057\u3066\u5b9f\u884c\n    for f in files:\n        result = analyze_log_file(f)\n        print(f\"Result: {result.summary}\")\n</code></pre>"},{"location":"#dashboard-result-viewer","title":"\ud83d\udcca Dashboard (Result Viewer)","text":"<p>\"Minimal viewer, not a full tracer.\"</p> <p>\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306f\u3001\u3042\u304f\u307e\u3067\u300c\u5b9f\u884c\u72b6\u6cc1\uff08\u623b\u308a\u5024\uff09\u306e\u78ba\u8a8d\u300d\u3068\u300c\u30ad\u30e3\u30c3\u30b7\u30e5DB\u304c\u7834\u7dbb\u3057\u3066\u3044\u306a\u3044\u304b\u306e\u78ba\u8a8d\u300d\u306b\u7279\u5316\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code># \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eDB\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\n$ beautyspot ui ./my_experiment.db\n</code></pre>"},{"location":"#license","title":"\ud83e\udd1d License","text":"<p>MIT License</p>"},{"location":"adr/0000-adr-example/","title":"Manage Executor Lifecycle via Instance Ownership and Weak References","text":""},{"location":"adr/0000-adr-example/#context-and-problem-statement","title":"Context and Problem Statement / \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<p><code>src/beautyspot/core.py</code> \u306b\u304a\u3044\u3066\u3001\u975e\u540c\u671f\u30bf\u30b9\u30af\u306eIO\u30aa\u30d5\u30ed\u30fc\u30c9\u7528\u306b <code>ThreadPoolExecutor</code> \u304c\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570 <code>_io_executor</code> \u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3002</p> <p>\u3053\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u3042\u308b\uff1a</p> <ol> <li>\u30ea\u30bd\u30fc\u30b9\u5236\u5fa1\u306e\u6b20\u5982: \u30b9\u30ec\u30c3\u30c9\u6570\uff08<code>max_workers=4</code>\uff09\u304c\u30cf\u30fc\u30c9\u30b3\u30fc\u30c9\u3055\u308c\u3066\u304a\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u5b9f\u884c\u74b0\u5883\uff08AWS Lambda\u3001\u5f37\u529b\u306a\u30b5\u30fc\u30d0\u30fc\u7b49\uff09\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3067\u304d\u306a\u3044\u3002</li> <li>\u30be\u30f3\u30d3\u30d7\u30ed\u30bb\u30b9: \u30d7\u30ed\u30bb\u30b9\u7d42\u4e86\u6642\u306b\u660e\u793a\u7684\u306a\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u304c\u884c\u308f\u308c\u306a\u3044\u305f\u3081\u3001\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u30be\u30f3\u30d3\u30d7\u30ed\u30bb\u30b9\u5316\u3059\u308b\u30ea\u30b9\u30af\u304c\u3042\u308b\u3002</li> <li>\u30c6\u30b9\u30c8\u56f0\u96e3\u6027: \u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u306f\u30e2\u30c3\u30af\u5316\u304c\u96e3\u3057\u304f\u3001\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306e\u5206\u96e2\u3092\u59a8\u3052\u308b\u3002</li> </ol> <p>\u4ee3\u66ff\u6848\u3068\u3057\u3066 <code>with</code> \u6587\uff08Context Manager\uff09\u306b\u3088\u308b\u7ba1\u7406\u3082\u691c\u8a0e\u3055\u308c\u305f\u304c\u3001<code>beautyspot</code> \u306e\u300c\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u4ed8\u4e0e\u3059\u308b\u3060\u3051\u3067\u52d5\u4f5c\u3059\u308b\u300d\u3068\u3044\u3046\u7c21\u6613\u306a\u5229\u7528\u4f53\u9a13\uff08DX\uff09\u3092\u640d\u306a\u3046\u305f\u3081\u3001\u63a1\u7528\u306b\u306f\u81f3\u3089\u306a\u304b\u3063\u305f\u3002\u30e6\u30fc\u30b6\u30fc\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3055\u305b\u305a\u306b\u3001\u5b89\u5168\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3059\u308b\u4ed5\u7d44\u307f\u304c\u5fc5\u8981\u3067\u3042\u308b\u3002</p>"},{"location":"adr/0000-adr-example/#decision-drivers","title":"Decision Drivers / \u8981\u6c42","text":"<ul> <li>Developer Experience (DX): \u30e6\u30fc\u30b6\u30fc\u306b <code>shutdown()</code> \u306e\u547c\u3073\u51fa\u3057\u3084 <code>with</code> \u6587\u3092\u5f37\u5236\u3057\u305f\u304f\u306a\u3044\u3002</li> <li>Configurability: \u30b9\u30ec\u30c3\u30c9\u6570\u3084 Executor \u306e\u5b9f\u88c5\u3092\u30e6\u30fc\u30b6\u30fc\u304c\u5236\u5fa1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002</li> <li>Safety: \u30d7\u30ed\u30bb\u30b9\u7d42\u4e86\u6642\u3084\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7834\u68c4\u6642\u306b\u3001\u78ba\u5b9f\u306b\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u3092\u9589\u3058\u305f\u3044\u3002</li> <li>Memory Safety: \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u51e6\u7406\u306e\u767b\u9332\u306b\u3088\u3063\u3066\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\uff08\u5faa\u74b0\u53c2\u7167\uff09\u3092\u5f15\u304d\u8d77\u3053\u3057\u3066\u306f\u306a\u3089\u306a\u3044\u3002</li> </ul>"},{"location":"adr/0000-adr-example/#considered-options","title":"Considered Options / \u691c\u8a0e","text":"<ul> <li>Option 1: \u73fe\u72b6\u7dad\u6301\uff08\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u306e\u307e\u307e\uff09\u3002</li> <li>Option 2: <code>Project</code> \u3092 Context Manager \u5316\u3057\u3001<code>__exit__</code> \u3067 <code>shutdown()</code> \u3092\u547c\u3076\u3002</li> <li>Option 3: <code>atexit</code> \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3044\u3001\u7d42\u4e86\u6642\u306b <code>shutdown()</code> \u3092\u547c\u3076\u3002</li> <li>Option 4: \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7ba1\u7406\u306b\u5909\u66f4\u3057\u3001<code>weakref.finalize</code> \u3067\u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3092\u884c\u3046\u3002</li> </ul>"},{"location":"adr/0000-adr-example/#decision-outcome","title":"Decision Outcome / \u6c7a\u5b9a","text":"<p>Chosen option: Option 4.</p> <p><code>Project</code> \u30af\u30e9\u30b9\u306e\u8a2d\u8a08\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\uff1a</p> <ol> <li>Executor\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316:     \u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3092\u5ec3\u6b62\u3057\u3001<code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3054\u3068\u306b <code>ThreadPoolExecutor</code> \u3092\u4fdd\u6301\u3059\u308b\u3002</li> <li>Dependency Injection (DI):     \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u5916\u90e8 <code>Executor</code> \u306e\u6ce8\u5165\u3092\u8a31\u53ef\u3059\u308b\u3002</li> <li>\u6240\u6709\u6a29\u3068\u8cac\u4efb\u306e\u5206\u96e2:<ul> <li>\u5916\u90e8\u6ce8\u5165 (<code>executor</code> \u5f15\u6570\u3042\u308a): <code>Project</code> \u306f\u305d\u308c\u3092\u501f\u7528\u3059\u308b\u306e\u307f\u3002\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u306e\u8cac\u4efb\u306f\u30e6\u30fc\u30b6\u30fc\uff08\u547c\u3073\u51fa\u3057\u5143\uff09\u306b\u3042\u308b\u305f\u3081\u3001\u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u306f\u884c\u308f\u306a\u3044\u3002</li> <li>\u5185\u90e8\u751f\u6210 (<code>executor</code> \u5f15\u6570\u306a\u3057): <code>Project</code> \u304c\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3092\u7ba1\u7406\u3059\u308b\u8cac\u4efb\u3092\u6301\u3064\u3002</li> </ul> </li> <li>\u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7:     \u5185\u90e8\u751f\u6210\u3057\u305f\u5834\u5408\u306b\u9650\u308a\u3001<code>weakref.finalize</code> \u3092\u4f7f\u7528\u3057\u3066\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3092\u81ea\u52d5\u5316\u3059\u308b\u3002</li> </ol>"},{"location":"adr/0000-adr-example/#technical-details-why-weakreffinalize-instead-of-atexit","title":"Technical Details / \u6280\u8853\u8a73\u7d30: Why <code>weakref.finalize</code> instead of <code>atexit</code>?","text":"<p>\u5358\u7d14\u306a <code>atexit.register(self.shutdown)</code> \u3092\u63a1\u7528\u3057\u306a\u304b\u3063\u305f\u7406\u7531\u306f\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\uff08\u5faa\u74b0\u53c2\u7167\uff09\u306e\u30ea\u30b9\u30af \u3067\u3042\u308b\u3002</p> <ul> <li>\u554f\u984c\u70b9: <code>atexit</code> \u30ec\u30b8\u30b9\u30c8\u30ea\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\uff08<code>self.shutdown</code>\uff09\u3092\u767b\u9332\u3059\u308b\u3068\u3001<code>atexit</code> \u304c <code>self</code> \u3078\u306e\u5f37\u53c2\u7167\uff08Strong Reference\uff09\u3092\u4fdd\u6301\u3057\u7d9a\u3051\u308b\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\u4e2d\u306b <code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4e0d\u8981\u306b\u306a\u3063\u3066\u3082\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\uff08GC\uff09\u3055\u308c\u305a\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3092\u5f15\u304d\u8d77\u3053\u3059\u3002\u3053\u308c\u3092\u9632\u3050\u306b\u306f <code>atexit.unregister</code> \u304c\u5fc5\u8981\u306b\u306a\u308b\u304c\u3001\u7ba1\u7406\u304c\u8907\u96d1\u306b\u306a\u308b\u3002</li> <li>\u89e3\u6c7a\u7b56: <code>weakref.finalize(self, func, *args)</code> \u3092\u63a1\u7528\u3059\u308b\u3002<ul> <li><code>self</code> \u304cGC\u3055\u308c\u305f\u6642\u70b9\u3067\u3001\u5373\u5ea7\u306b <code>func</code>\uff08\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u51e6\u7406\uff09\u304c\u5b9f\u884c\u3055\u308c\u308b\u3002</li> <li>\u30d7\u30ed\u30b0\u30e9\u30e0\u7d42\u4e86\u6642\u307e\u3067 <code>self</code> \u304c\u751f\u5b58\u3057\u3066\u3044\u305f\u5834\u5408\u3082\u3001<code>atexit</code> \u76f8\u5f53\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067 <code>func</code> \u304c\u5b9f\u884c\u3055\u308c\u308b\u3002</li> <li>\u91cd\u8981: \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u95a2\u6570 <code>_shutdown_executor</code> \u306f <code>staticmethod</code> \u3068\u3057\u3001\u5f15\u6570\u306b\u306f <code>self</code> \u3067\u306f\u306a\u304f <code>self.executor</code> \u306e\u307f\u3092\u6e21\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d5\u30a1\u30a4\u30ca\u30e9\u30a4\u30b6\u304c <code>self</code> \u3092\u53c2\u7167\u3057\u7d9a\u3051\u3066\u5bff\u547d\u3092\u5ef6\u3070\u3057\u3066\u3057\u307e\u3046\u4e8b\u6545\u3092\u9632\u3050\u3002</li> </ul> </li> </ul> <pre><code># Implementation Sketch\nclass Project:\n    def __init__(self, ...):\n        # ...\n        self.executor = ThreadPoolExecutor(...)\n        # self \u3092\u53c2\u7167\u3057\u306a\u3044\u3088\u3046\u3001executor \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3051\u3092\u6e21\u3059\n        self._finalizer = weakref.finalize(self, self._shutdown_executor, self.executor)\n\n    @staticmethod\n    def _shutdown_executor(executor):\n        executor.shutdown(wait=True)\n</code></pre>"},{"location":"adr/0000-adr-example/#consequences","title":"Consequences / \u6c7a\u5b9a","text":"<ul> <li>Positive:<ul> <li>\u30e6\u30fc\u30b6\u30fc\u306f\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u3001API\u3082\u30b7\u30f3\u30d7\u30eb\u306b\u4fdd\u305f\u308c\u308b\u3002</li> <li><code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cGC\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u3082\u56de\u53ce\u3055\u308c\u308b\u305f\u3081\u3001\u30ea\u30bd\u30fc\u30b9\u52b9\u7387\u304c\u826f\u3044\u3002</li> <li>DI\u306b\u3088\u308a\u3001\u30c6\u30b9\u30c8\u6642\u306b\u30e2\u30c3\u30afExecutor\u3092\u5dee\u3057\u8fbc\u3080\u3053\u3068\u304c\u5bb9\u6613\u306b\u306a\u308b\u3002</li> </ul> </li> <li>Negative:<ul> <li><code>core.py</code> \u306e\u5b9f\u88c5\u306b\u304a\u3044\u3066\u3001GC\u306e\u6319\u52d5\u3068 <code>weakref</code> \u306e\u4ed5\u69d8\u3092\u7406\u89e3\u3057\u305f\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304c\u5fc5\u8981\u306b\u306a\u308a\u3001\u5185\u90e8\u7684\u306a\u8907\u96d1\u6027\u304c\u82e5\u5e72\u5897\u3059\u3002</li> <li><code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5927\u91cf\u306b\u751f\u6210\u30fb\u7834\u68c4\u3059\u308b\u3088\u3046\u306a\u7279\u6b8a\u306a\u4f7f\u3044\u65b9\u3092\u3057\u305f\u5834\u5408\u3001\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u306e\u751f\u6210\u30b3\u30b9\u30c8\u304c\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u7684\u306a\u5229\u7528\u3092\u63a8\u5968\u3059\u308b\u3053\u3068\u3067\u7de9\u548c\u3059\u308b\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0001-stable-argument-hashing/","title":"1. Stable Hashing for Function Arguments","text":""},{"location":"adr/0001-stable-argument-hashing/#context","title":"Context / \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<p><code>beautyspot</code> \u306e\u30b3\u30a2\u6a5f\u80fd\u3067\u3042\u308b\u300c\u95a2\u6570\u306e\u30e1\u30e2\u5316\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\uff09\u300d\u306b\u304a\u3044\u3066\u3001\u95a2\u6570\u306e\u5f15\u6570 (<code>args</code>, <code>kwargs</code>) \u304b\u3089\u4e00\u610f\u306a\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u3092\u751f\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u521d\u671f\u5b9f\u88c5 (<code>v0.1.0</code>) \u3067\u306f\u3001<code>json.dumps</code> \u304c\u5931\u6557\u3057\u305f\u5834\u5408\u306e\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3057\u3066 <code>str((args, kwargs))</code> \u306e\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u3002</p> <p>\u3057\u304b\u3057\u3001Python\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e <code>__str__</code> / <code>__repr__</code> \u5b9f\u88c5\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30e2\u30ea\u30a2\u30c9\u30ec\u30b9\uff08\u4f8b: <code>&lt;MyObject at 0x10a...&gt;</code>\uff09\u3092\u542b\u3080\u3053\u3068\u304c\u591a\u304f\u3042\u308a\u307e\u3059\u3002</p> <p>\u3053\u308c\u306b\u3088\u308a\u4ee5\u4e0b\u306e\u554f\u984c\u304c\u767a\u751f\u3057\u3066\u3044\u307e\u3057\u305f\uff1a</p> <ol> <li>\u518d\u8d77\u52d5\u3054\u3068\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u7121\u52b9\u5316: \u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u30e1\u30e2\u30ea\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u308a\u3001\u540c\u3058\u5165\u529b\u5024\u3067\u3082\u30cf\u30c3\u30b7\u30e5\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3046\u3002</li> <li>\u5206\u6563\u74b0\u5883\u3067\u306e\u4e0d\u6574\u5408: \u7570\u306a\u308b\u30de\u30b7\u30f3\uff08\u3042\u308b\u3044\u306f\u7570\u306a\u308b\u30d7\u30ed\u30bb\u30b9\uff09\u3067\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u304c\u4e00\u81f4\u3057\u306a\u3044\u3002</li> </ol> <p>\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\uff08<code>joblib</code> \u7b49\uff09\u3092\u4f7f\u3048\u3070\u89e3\u6c7a\u3057\u307e\u3059\u304c\u3001<code>beautyspot</code> \u306f\u8efd\u91cf\u306a\u300c\u9ed2\u5b50\u300d\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u76ee\u6307\u3057\u3066\u304a\u308a\u3001\u4f9d\u5b58\u95a2\u4fc2\u3092\u5897\u3084\u3057\u305f\u304f\u3042\u308a\u307e\u305b\u3093\u3002</p>"},{"location":"adr/0001-stable-argument-hashing/#decision","title":"Decision / \u6c7a\u5b9a","text":"<p>\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306e <code>json</code> \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3001\u72ec\u81ea\u306e <code>default</code> \u30b7\u30ea\u30a2\u30e9\u30a4\u30b6 (<code>_stable_serialize_default</code>) \u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u3067\u3001\u4f9d\u5b58\u95a2\u4fc2\u306a\u3057\u3067 \u5805\u7262\u306a\u30cf\u30c3\u30b7\u30e5\u751f\u6210\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306e\u6226\u7565\u3092\u63a1\u7528\u3057\u307e\u3059\uff1a</p> <ol> <li>Set/Frozenset\u306e\u30bd\u30fc\u30c8: JSON\u306f\u9806\u5e8f\u3092\u6301\u305f\u306a\u3044\u96c6\u5408\u3092\u6271\u3048\u306a\u3044\u305f\u3081\u3001<code>sorted(list(obj))</code> \u3067\u30ea\u30b9\u30c8\u5316\u3057\u3001\u9806\u5e8f\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</li> <li>\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8f9e\u66f8\u5316: <code>__dict__</code> \u307e\u305f\u306f <code>__slots__</code> \u3092\u53c2\u7167\u3057\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u300c\u4e2d\u8eab\u306e\u5024\u300d\u3092\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u5bfe\u8c61\u3068\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e1\u30e2\u30ea\u30a2\u30c9\u30ec\u30b9\u3078\u306e\u4f9d\u5b58\u3092\u6392\u9664\u3057\u307e\u3059\u3002</li> <li>Bytes\u578b: 16\u9032\u6570\u6587\u5b57\u5217 (<code>hex</code>) \u306b\u5909\u63db\u3057\u307e\u3059\u3002</li> <li>\u6700\u7d42\u624b\u6bb5: \u305d\u308c\u3067\u3082\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3067\u304d\u306a\u3044\u578b\uff08\u5faa\u74b0\u53c2\u7167\u306a\u3069\uff09\u306b\u3064\u3044\u3066\u306f\u3001\u4f8b\u5916\u7684\u306b <code>str()</code> \u3092\u4f7f\u7528\u3057\u307e\u3059\uff08\u3053\u306e\u5834\u5408\u306e\u307f\u4e0d\u5b89\u5b9a\u306b\u306a\u308b\u30ea\u30b9\u30af\u3092\u8a31\u5bb9\u3057\u307e\u3059\uff09\u3002</li> </ol>"},{"location":"adr/0001-stable-argument-hashing/#consequences","title":"Consequences / \u7d50\u679c","text":"<ul> <li> <p>\u30e1\u30ea\u30c3\u30c8:</p> <ul> <li>\u30a2\u30d7\u30ea\u518d\u8d77\u52d5\u5f8c\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u6709\u52b9\u306b\u6a5f\u80fd\u3059\u308b\uff08\u6c38\u7d9a\u5316\u306e\u4fe1\u983c\u6027\u5411\u4e0a\uff09\u3002</li> <li><code>pydantic</code> \u30e2\u30c7\u30eb\u3084 <code>dataclass</code> \u3082\u8a2d\u5b9a\u306a\u3057\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u53ef\u80fd\u306b\u306a\u308b\u3002</li> <li>\u5916\u90e8\u4f9d\u5b58\uff08<code>numpy</code>, <code>joblib</code> \u7b49\uff09\u3092\u5897\u3084\u3055\u305a\u306b\u6e08\u3080\u3002</li> </ul> </li> <li> <p>\u30c7\u30e1\u30ea\u30c3\u30c8:</p> <ul> <li>\u5358\u306a\u308b <code>str()</code> \u5909\u63db\u3088\u308a\u3082\u3001\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u51e6\u7406\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\uff08CPU\u30b3\u30b9\u30c8\uff09\u304c\u308f\u305a\u304b\u306b\u5897\u52a0\u3059\u308b\u3002</li> <li>\u5faa\u74b0\u53c2\u7167\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3055\u308c\u305f\u5834\u5408\u306e\u5b8c\u5168\u306a\u89e3\u6c7a\u7b56\u3067\u306f\u306a\u3044\uff08\u305f\u3060\u3057\u3001\u30bf\u30b9\u30af\u306e\u5165\u529b\u5f15\u6570\u3068\u3057\u3066\u306f\u7a00\u3067\u3042\u308b\u3068\u5224\u65ad\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0002-robust-rate-limiter/","title":"2. Smooth Rate Limiter (GCRA)","text":""},{"location":"adr/0002-robust-rate-limiter/#context","title":"Context / \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<p><code>beautyspot</code> \u306e\u30ec\u30fc\u30c8\u5236\u9650\u6a5f\u80fd (<code>limiter</code>) \u306b\u304a\u3044\u3066\u3001\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u3042\u3063\u305f\u3002</p> <ol> <li>Idle Burst: \u30c8\u30fc\u30af\u30f3\u30d0\u30b1\u30c3\u30c8\u65b9\u5f0f\u3067\u306f\u3001\u30a2\u30a4\u30c9\u30eb\u4e2d\u306b\u30c8\u30fc\u30af\u30f3\u304c\u6e9c\u307e\u308a\u3001\u518d\u958b\u76f4\u5f8c\u306b\u30d0\u30fc\u30b9\u30c8\uff08\u96c6\u4e2d\u30a2\u30af\u30bb\u30b9\uff09\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3046\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306b\u5bb9\u91cf(<code>capacity</code>)\u3092\u5c0f\u3055\u304f\u3059\u308b\u3068\u3001\u4eca\u5ea6\u306f\u5de8\u5927\u306a\u30b3\u30b9\u30c8\u3092\u6301\u3064\u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3067\u304d\u306a\u304f\u306a\u308b\uff08\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\uff09\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u3002</li> <li>Start Dash Prevention: \u30d7\u30ed\u30bb\u30b9\u8d77\u52d5\u76f4\u5f8c\u306b\u8907\u6570\u306e\u30bf\u30b9\u30af\u304c\u540c\u6642\u306b\u8d70\u308b\u306e\u3092\u9632\u304e\u305f\u3044\u304c\u3001\u6700\u521d\u306e1\u56de\u76ee\u307e\u3067\u5f85\u305f\u3055\u308c\u308b\u306e\u306f\u907f\u3051\u305f\u3044\u3002</li> <li>Clock Dependency: \u30b7\u30b9\u30c6\u30e0\u6642\u523b\u306e\u5909\u66f4\u306b\u5805\u7262\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002</li> <li>Max Cost Guard: <code>tokens_per_minute</code> \u3092\u5358\u767a\u30bf\u30b9\u30af\u306e\u30b3\u30b9\u30c8\u4e0a\u9650\u3068\u3059\u308b\u3002<ul> <li>\u3053\u308c\u3092\u8d85\u3048\u308b\u30b3\u30b9\u30c8\u304c <code>consume()</code> \u306b\u6e21\u3055\u308c\u305f\u5834\u5408\u3001\u5373\u5ea7\u306b <code>ValueError</code> \u3092\u9001\u51fa\u3059\u308b\u3002</li> <li>\u7406\u7531: API\u306e\u7269\u7406\u7684\u306a\u30ec\u30fc\u30c8\u5236\u9650\u3092\u8d85\u3048\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u3001\u5f85\u6a5f\u3057\u305f\u3068\u3053\u308d\u3067\u6210\u529f\u3059\u308b\u898b\u8fbc\u307f\u304c\u8584\u304f\u3001\u65e9\u671f\u306b\u8a2d\u5b9a\u30df\u30b9\u3084\u5165\u529b\u30df\u30b9\u3092\u30e6\u30fc\u30b6\u30fc\u306b\u901a\u77e5\u3059\u3079\u304d\u3067\u3042\u308b\u305f\u3081\u3002</li> </ul> </li> </ol>"},{"location":"adr/0002-robust-rate-limiter/#decision","title":"Decision / \u6c7a\u5b9a","text":"<p>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30c8\u30fc\u30af\u30f3\u30d0\u30b1\u30c3\u30c8\u304b\u3089 GCRA (Generic Cell Rate Algorithm)\u3001\u3042\u308b\u3044\u306f \"Leaky Bucket as a Meter\" \u3068\u547c\u3070\u308c\u308b\u65b9\u5f0f\u306b\u5909\u66f4\u3059\u308b\u3002</p> <ul> <li>\u7406\u8ad6\u7684\u5230\u9054\u6642\u523b (TAT: Theoretical Arrival Time) \u3092\u7ba1\u7406\u3059\u308b\u3002</li> <li>\u30bf\u30b9\u30af\u304c\u6765\u308b\u3068\u3001\u305d\u306e\u30b3\u30b9\u30c8\u5206\u3060\u3051 TAT \u3092\u672a\u6765\u3078\u9032\u3081\u308b\u3002</li> <li><code>\u73fe\u5728\u6642\u523b &lt; TAT</code> \u306a\u3089\u3070\u3001\u305d\u306e\u5dee\u5206\u3060\u3051\u5f85\u6a5f\uff08sleep\uff09\u3057\u3066\u304b\u3089\u5b9f\u884c\u3059\u308b\u3002</li> <li><code>\u73fe\u5728\u6642\u523b &gt;= TAT</code> \uff08\u30a2\u30a4\u30c9\u30eb\u72b6\u614b\uff09\u306a\u3089\u3070\u3001TAT \u3092\u73fe\u5728\u6642\u523b\u306b\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u304b\u3089\u8a08\u7b97\u3059\u308b\uff08\u904e\u53bb\u306e\u8caf\u91d1\u306f\u6368\u3066\u308b\uff09\u3002</li> </ul>"},{"location":"adr/0002-robust-rate-limiter/#consequences","title":"Consequences / \u7d50\u679c","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u5b8c\u5168\u306a\u5b9a\u901f\u904b\u8ee2: \u30a2\u30a4\u30c9\u30eb\u5f8c\u3067\u3082\u30d0\u30fc\u30b9\u30c8\u305b\u305a\u3001\u8a2d\u5b9a\u3055\u308c\u305f\u30ec\u30fc\u30c8\uff08TPM\uff09\u3092\u53b3\u5b88\u3059\u308b\u3002</li> <li>\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u30d5\u30ea\u30fc: \u3069\u3093\u306a\u306b\u5927\u304d\u306a\u30b3\u30b9\u30c8\u306e\u30bf\u30b9\u30af\u3067\u3082\u3001\u5fc5\u8981\u306a\u5f85\u6a5f\u6642\u9593\u3092\u8a08\u7b97\u3057\u3066\u51e6\u7406\u3067\u304d\u308b\u3002</li> <li>\u5373\u6642\u8d77\u52d5: \u6700\u521d\u306e1\u56de\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u5f85\u3061\u6642\u9593\u306a\u3057\u3067\u5b9f\u884c\u3055\u308c\u30012\u56de\u76ee\u4ee5\u964d\u304b\u3089\u30da\u30fc\u30b7\u30f3\u30b0\u304c\u52b9\u304f\u3002</li> <li>Fail Fast: \u8a2d\u5b9a\u5024\u3092\u8d85\u3048\u308b\u7121\u8336\u306a\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u65e9\u671f\u767a\u898b\u3067\u304d\u308b\u3002</li> </ul> </li> <li>\u30c7\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u5b9f\u88c5\u304c\u300c\u30c8\u30fc\u30af\u30f3\u3092\u6d88\u8cbb\u3059\u308b\u300d\u3068\u3044\u3046\u76f4\u611f\u7684\u306a\u30e1\u30bf\u30d5\u30a1\u30fc\u304b\u3089\u5c11\u3057\u96e2\u308c\u308b\uff08\u30b3\u30fc\u30c9\u5185\u306e\u8aac\u660e\u3067\u88dc\u8db3\u3059\u308b\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0003-resilient-deserializeation-and-versioning/","title":"3. Resilient Deserialization and Explicit Versioning","text":""},{"location":"adr/0003-resilient-deserializeation-and-versioning/#context","title":"Context","text":"<p>Python\u306e <code>pickle</code> \u306f\u3001\u4fdd\u5b58\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30af\u30e9\u30b9\u5b9a\u7fa9\u3068\u73fe\u5728\u306e\u30b3\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3059\u308b\u3002 \u958b\u767a\u4e2d\u306f\u30af\u30e9\u30b9\u5b9a\u7fa9\u304c\u983b\u7e41\u306b\u5909\u66f4\u3055\u308c\u308b\u305f\u3081\u3001\u904e\u53bb\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8aad\u307f\u8fbc\u3080\u969b\u306b <code>AttributeError</code> \u7b49\u304c\u767a\u751f\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30af\u30e9\u30c3\u30b7\u30e5\u3059\u308b\u554f\u984c\u304c\u3042\u3063\u305f\u3002</p>"},{"location":"adr/0003-resilient-deserializeation-and-versioning/#decision","title":"Decision","text":"<ol> <li>Fail Safe (Auto Recalc): <code>Storage.load()</code> \u3067\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u30a8\u30e9\u30fc\uff08\u30af\u30e9\u30b9\u4e0d\u6574\u5408\u3084\u7834\u640d\uff09\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001\u3053\u308c\u3092 <code>CacheCorruptedError</code> \u3068\u3057\u3066\u6355\u6349\u3057\u3001<code>core.py</code> \u5074\u3067 \u300c\u30ad\u30e3\u30c3\u30b7\u30e5\u30df\u30b9\u300d \u3068\u3057\u3066\u6271\u3046\u3002\u3053\u308c\u306b\u3088\u308a\u30a2\u30d7\u30ea\u3092\u30af\u30e9\u30c3\u30b7\u30e5\u3055\u305b\u305a\u3001\u81ea\u52d5\u7684\u306b\u518d\u8a08\u7b97\u3092\u884c\u3046\u3002</li> <li>Explicit Versioning: \u30e6\u30fc\u30b6\u30fc\u304c\u610f\u56f3\u7684\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7121\u52b9\u5316\u3067\u304d\u308b\u3088\u3046\u3001<code>@task</code> \u30c7\u30b3\u30ec\u30fc\u30bf\u306b <code>version</code> \u5f15\u6570\u3092\u8ffd\u52a0\u3059\u308b\u3002\u3053\u308c\u3092\u5909\u66f4\u3059\u308b\u3068\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u304c\u5909\u308f\u308a\u3001\u53e4\u3044\uff08\u4e92\u63db\u6027\u306e\u306a\u3044\uff09\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u53c2\u7167\u3057\u306a\u304f\u306a\u308b\u3002</li> <li>User Guidance: \u81ea\u52d5\u518d\u8a08\u7b97\u304c\u767a\u751f\u3057\u305f\u969b\u3001\u30ed\u30b0\u306b\u300c\u30b3\u30fc\u30c9\u5909\u66f4\u6642\u306f <code>version</code> \u306e\u66f4\u65b0\u3092\u691c\u8a0e\u3057\u3066\u306d\u300d\u3068\u3044\u3046\u30d2\u30f3\u30c8\u3092\u51fa\u529b\u3057\u3001\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3078\u8a98\u5c0e\u3059\u308b\u3002</li> </ol>"},{"location":"adr/0003-resilient-deserializeation-and-versioning/#consequences","title":"Consequences","text":"<ul> <li>\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u958b\u767a\u4e2d\u306e\u30af\u30e9\u30c3\u30b7\u30e5\u3092\u9632\u304e\u3001\u30b9\u30e0\u30fc\u30ba\u306aDX\u3092\u63d0\u4f9b\u3059\u308b\u3002</li> <li>\u672c\u756a\u904b\u7528\u6642\u3067\u3082\u3001<code>version</code> \u3092\u4f7f\u3046\u3053\u3068\u3067\u5b89\u5168\u306a\u30c7\u30d7\u30ed\u30a4\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u5207\u308a\u66ff\u3048\uff09\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002</li> </ul> </li> <li>\u30c7\u30e1\u30ea\u30c3\u30c8:<ul> <li>\u518d\u8a08\u7b97\u30b3\u30b9\u30c8\u304c\u767a\u751f\u3059\u308b\uff08\u304c\u3001\u30af\u30e9\u30c3\u30b7\u30e5\u3088\u308a\u306f\u30de\u30b7\u3067\u3042\u308b\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0004-io-executor-lifecyle-management/","title":"Manage Executor Lifecycle via Instance Ownership and Weak References","text":""},{"location":"adr/0004-io-executor-lifecyle-management/#context-and-problem-statement","title":"Context and Problem Statement","text":"<p><code>src/beautyspot/core.py</code> \u306b\u304a\u3044\u3066\u3001\u975e\u540c\u671f\u30bf\u30b9\u30af\u306eIO\u30aa\u30d5\u30ed\u30fc\u30c9\u7528\u306b <code>ThreadPoolExecutor</code> \u304c\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570 <code>_io_executor</code> \u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3002</p> <p>\u3053\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u3042\u308b\uff1a</p> <ol> <li>\u30ea\u30bd\u30fc\u30b9\u5236\u5fa1\u306e\u6b20\u5982: \u30b9\u30ec\u30c3\u30c9\u6570\uff08<code>max_workers=4</code>\uff09\u304c\u30cf\u30fc\u30c9\u30b3\u30fc\u30c9\u3055\u308c\u3066\u304a\u308a\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u5b9f\u884c\u74b0\u5883\uff08AWS Lambda\u3001\u5f37\u529b\u306a\u30b5\u30fc\u30d0\u30fc\u7b49\uff09\u306b\u5408\u308f\u305b\u3066\u8abf\u6574\u3067\u304d\u306a\u3044\u3002</li> <li>\u30be\u30f3\u30d3\u30d7\u30ed\u30bb\u30b9: \u30d7\u30ed\u30bb\u30b9\u7d42\u4e86\u6642\u306b\u660e\u793a\u7684\u306a\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u304c\u884c\u308f\u308c\u306a\u3044\u305f\u3081\u3001\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u30be\u30f3\u30d3\u30d7\u30ed\u30bb\u30b9\u5316\u3059\u308b\u30ea\u30b9\u30af\u304c\u3042\u308b\u3002</li> <li>\u30c6\u30b9\u30c8\u56f0\u96e3\u6027: \u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u306f\u30e2\u30c3\u30af\u5316\u304c\u96e3\u3057\u304f\u3001\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306e\u5206\u96e2\u3092\u59a8\u3052\u308b\u3002</li> </ol> <p>\u4ee3\u66ff\u6848\u3068\u3057\u3066 <code>with</code> \u6587\uff08Context Manager\uff09\u306b\u3088\u308b\u7ba1\u7406\u3082\u691c\u8a0e\u3055\u308c\u305f\u304c\u3001<code>beautyspot</code> \u306e\u300c\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u4ed8\u4e0e\u3059\u308b\u3060\u3051\u3067\u52d5\u4f5c\u3059\u308b\u300d\u3068\u3044\u3046\u7c21\u6613\u306a\u5229\u7528\u4f53\u9a13\uff08DX\uff09\u3092\u640d\u306a\u3046\u305f\u3081\u3001\u63a1\u7528\u306b\u306f\u81f3\u3089\u306a\u304b\u3063\u305f\u3002\u30e6\u30fc\u30b6\u30fc\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3055\u305b\u305a\u306b\u3001\u5b89\u5168\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3059\u308b\u4ed5\u7d44\u307f\u304c\u5fc5\u8981\u3067\u3042\u308b\u3002</p>"},{"location":"adr/0004-io-executor-lifecyle-management/#decision-drivers","title":"Decision Drivers","text":"<ul> <li>Developer Experience (DX): \u30e6\u30fc\u30b6\u30fc\u306b <code>shutdown()</code> \u306e\u547c\u3073\u51fa\u3057\u3084 <code>with</code> \u6587\u3092\u5f37\u5236\u3057\u305f\u304f\u306a\u3044\u3002</li> <li>Configurability: \u30b9\u30ec\u30c3\u30c9\u6570\u3084 Executor \u306e\u5b9f\u88c5\u3092\u30e6\u30fc\u30b6\u30fc\u304c\u5236\u5fa1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002</li> <li>Safety: \u30d7\u30ed\u30bb\u30b9\u7d42\u4e86\u6642\u3084\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7834\u68c4\u6642\u306b\u3001\u78ba\u5b9f\u306b\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u3092\u9589\u3058\u305f\u3044\u3002</li> <li>Memory Safety: \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u51e6\u7406\u306e\u767b\u9332\u306b\u3088\u3063\u3066\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\uff08\u5faa\u74b0\u53c2\u7167\uff09\u3092\u5f15\u304d\u8d77\u3053\u3057\u3066\u306f\u306a\u3089\u306a\u3044\u3002</li> </ul>"},{"location":"adr/0004-io-executor-lifecyle-management/#considered-options","title":"Considered Options","text":"<ul> <li>Option 1: \u73fe\u72b6\u7dad\u6301\uff08\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u306e\u307e\u307e\uff09\u3002</li> <li>Option 2: <code>Project</code> \u3092 Context Manager \u5316\u3057\u3001<code>__exit__</code> \u3067 <code>shutdown()</code> \u3092\u547c\u3076\u3002</li> <li>Option 3: <code>atexit</code> \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3044\u3001\u7d42\u4e86\u6642\u306b <code>shutdown()</code> \u3092\u547c\u3076\u3002</li> <li>Option 4: \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7ba1\u7406\u306b\u5909\u66f4\u3057\u3001<code>weakref.finalize</code> \u3067\u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3092\u884c\u3046\u3002</li> </ul>"},{"location":"adr/0004-io-executor-lifecyle-management/#decision-outcome","title":"Decision Outcome","text":"<p>Chosen option: Option 4.</p> <p><code>Project</code> \u30af\u30e9\u30b9\u306e\u8a2d\u8a08\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\uff1a</p> <ol> <li>Executor\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316:     \u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3092\u5ec3\u6b62\u3057\u3001<code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3054\u3068\u306b <code>ThreadPoolExecutor</code> \u3092\u4fdd\u6301\u3059\u308b\u3002</li> <li>Dependency Injection (DI):     \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u5916\u90e8 <code>Executor</code> \u306e\u6ce8\u5165\u3092\u8a31\u53ef\u3059\u308b\u3002</li> <li>\u6240\u6709\u6a29\u3068\u8cac\u4efb\u306e\u5206\u96e2:<ul> <li>\u5916\u90e8\u6ce8\u5165 (<code>executor</code> \u5f15\u6570\u3042\u308a): <code>Project</code> \u306f\u305d\u308c\u3092\u501f\u7528\u3059\u308b\u306e\u307f\u3002\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u306e\u8cac\u4efb\u306f\u30e6\u30fc\u30b6\u30fc\uff08\u547c\u3073\u51fa\u3057\u5143\uff09\u306b\u3042\u308b\u305f\u3081\u3001\u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u306f\u884c\u308f\u306a\u3044\u3002</li> <li>\u5185\u90e8\u751f\u6210 (<code>executor</code> \u5f15\u6570\u306a\u3057): <code>Project</code> \u304c\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3092\u7ba1\u7406\u3059\u308b\u8cac\u4efb\u3092\u6301\u3064\u3002</li> </ul> </li> <li>\u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7:     \u5185\u90e8\u751f\u6210\u3057\u305f\u5834\u5408\u306b\u9650\u308a\u3001<code>weakref.finalize</code> \u3092\u4f7f\u7528\u3057\u3066\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3092\u81ea\u52d5\u5316\u3059\u308b\u3002</li> </ol>"},{"location":"adr/0004-io-executor-lifecyle-management/#technical-details-why-weakreffinalize-instead-of-atexit","title":"Technical Details: Why <code>weakref.finalize</code> instead of <code>atexit</code>?","text":"<p>\u5358\u7d14\u306a <code>atexit.register(self.shutdown)</code> \u3092\u63a1\u7528\u3057\u306a\u304b\u3063\u305f\u7406\u7531\u306f\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\uff08\u5faa\u74b0\u53c2\u7167\uff09\u306e\u30ea\u30b9\u30af \u3067\u3042\u308b\u3002</p> <ul> <li>\u554f\u984c\u70b9: <code>atexit</code> \u30ec\u30b8\u30b9\u30c8\u30ea\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\uff08<code>self.shutdown</code>\uff09\u3092\u767b\u9332\u3059\u308b\u3068\u3001<code>atexit</code> \u304c <code>self</code> \u3078\u306e\u5f37\u53c2\u7167\uff08Strong Reference\uff09\u3092\u4fdd\u6301\u3057\u7d9a\u3051\u308b\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\u4e2d\u306b <code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4e0d\u8981\u306b\u306a\u3063\u3066\u3082\u30ac\u30d9\u30fc\u30b8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\uff08GC\uff09\u3055\u308c\u305a\u3001\u30e1\u30e2\u30ea\u30ea\u30fc\u30af\u3092\u5f15\u304d\u8d77\u3053\u3059\u3002\u3053\u308c\u3092\u9632\u3050\u306b\u306f <code>atexit.unregister</code> \u304c\u5fc5\u8981\u306b\u306a\u308b\u304c\u3001\u7ba1\u7406\u304c\u8907\u96d1\u306b\u306a\u308b\u3002</li> <li>\u89e3\u6c7a\u7b56: <code>weakref.finalize(self, func, *args)</code> \u3092\u63a1\u7528\u3059\u308b\u3002<ul> <li><code>self</code> \u304cGC\u3055\u308c\u305f\u6642\u70b9\u3067\u3001\u5373\u5ea7\u306b <code>func</code>\uff08\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u51e6\u7406\uff09\u304c\u5b9f\u884c\u3055\u308c\u308b\u3002</li> <li>\u30d7\u30ed\u30b0\u30e9\u30e0\u7d42\u4e86\u6642\u307e\u3067 <code>self</code> \u304c\u751f\u5b58\u3057\u3066\u3044\u305f\u5834\u5408\u3082\u3001<code>atexit</code> \u76f8\u5f53\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067 <code>func</code> \u304c\u5b9f\u884c\u3055\u308c\u308b\u3002</li> <li>\u91cd\u8981: \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u95a2\u6570 <code>_shutdown_executor</code> \u306f <code>staticmethod</code> \u3068\u3057\u3001\u5f15\u6570\u306b\u306f <code>self</code> \u3067\u306f\u306a\u304f <code>self.executor</code> \u306e\u307f\u3092\u6e21\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d5\u30a1\u30a4\u30ca\u30e9\u30a4\u30b6\u304c <code>self</code> \u3092\u53c2\u7167\u3057\u7d9a\u3051\u3066\u5bff\u547d\u3092\u5ef6\u3070\u3057\u3066\u3057\u307e\u3046\u4e8b\u6545\u3092\u9632\u3050\u3002</li> </ul> </li> </ul> <pre><code># Implementation Sketch\nclass Project:\n    def __init__(self, ...):\n        # ...\n        self.executor = ThreadPoolExecutor(...)\n        # self \u3092\u53c2\u7167\u3057\u306a\u3044\u3088\u3046\u3001executor \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3051\u3092\u6e21\u3059\n        self._finalizer = weakref.finalize(self, self._shutdown_executor, self.executor)\n\n    @staticmethod\n    def _shutdown_executor(executor):\n        executor.shutdown(wait=True)\n</code></pre>"},{"location":"adr/0004-io-executor-lifecyle-management/#consequences","title":"Consequences","text":"<ul> <li>Positive:<ul> <li>\u30e6\u30fc\u30b6\u30fc\u306f\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u3001API\u3082\u30b7\u30f3\u30d7\u30eb\u306b\u4fdd\u305f\u308c\u308b\u3002</li> <li><code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cGC\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u3082\u56de\u53ce\u3055\u308c\u308b\u305f\u3081\u3001\u30ea\u30bd\u30fc\u30b9\u52b9\u7387\u304c\u826f\u3044\u3002</li> <li>DI\u306b\u3088\u308a\u3001\u30c6\u30b9\u30c8\u6642\u306b\u30e2\u30c3\u30afExecutor\u3092\u5dee\u3057\u8fbc\u3080\u3053\u3068\u304c\u5bb9\u6613\u306b\u306a\u308b\u3002</li> </ul> </li> <li>Negative:<ul> <li><code>core.py</code> \u306e\u5b9f\u88c5\u306b\u304a\u3044\u3066\u3001GC\u306e\u6319\u52d5\u3068 <code>weakref</code> \u306e\u4ed5\u69d8\u3092\u7406\u89e3\u3057\u305f\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304c\u5fc5\u8981\u306b\u306a\u308a\u3001\u5185\u90e8\u7684\u306a\u8907\u96d1\u6027\u304c\u82e5\u5e72\u5897\u3059\u3002</li> <li><code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5927\u91cf\u306b\u751f\u6210\u30fb\u7834\u68c4\u3059\u308b\u3088\u3046\u306a\u7279\u6b8a\u306a\u4f7f\u3044\u65b9\u3092\u3057\u305f\u5834\u5408\u3001\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u306e\u751f\u6210\u30b3\u30b9\u30c8\u304c\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u7684\u306a\u5229\u7528\u3092\u63a8\u5968\u3059\u308b\u3053\u3068\u3067\u7de9\u548c\u3059\u308b\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0005-dashboard-interaction-model/","title":"ADR-002: Dashboard Interaction Model","text":""},{"location":"adr/0005-dashboard-interaction-model/#context","title":"Context","text":"<p>\u73fe\u72b6\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 (<code>dashboard.py</code>) \u3067\u306f\u3001\u30bf\u30b9\u30af\u4e00\u89a7\u306e\u8868\u793a\u3068\u8a73\u7d30\u30c7\u30fc\u30bf\u306e\u5fa9\u5143\u64cd\u4f5c\u304c\u5206\u96e2\u3057\u3066\u3044\u308b\u3002 \u30e6\u30fc\u30b6\u30fc\u306f\u4e00\u89a7\u30c6\u30fc\u30d6\u30eb\u3067\u5bfe\u8c61\u3092\u78ba\u8a8d\u3057\u305f\u5f8c\u3001\u5225\u9014\u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u5bfe\u5fdc\u3059\u308b <code>cache_key</code> (\u30cf\u30c3\u30b7\u30e5\u5024) \u3092\u624b\u52d5\u3067\u63a2\u3057\u51fa\u3059\u5fc5\u8981\u304c\u3042\u308a\u3001\u8a8d\u77e5\u8ca0\u8377\u304c\u9ad8\u3044\u3002 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f9d\u5b58\u95a2\u4fc2\u3068\u3057\u3066 <code>streamlit&gt;=1.51.0</code> \u304c\u78ba\u4fdd\u3055\u308c\u3066\u304a\u308a\u3001\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306a\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u6a5f\u80fd\u304c\u5229\u7528\u53ef\u80fd\u3067\u3042\u308b\u3002</p>"},{"location":"adr/0005-dashboard-interaction-model/#decision","title":"Decision","text":"<p><code>st.dataframe</code> \u306e <code>on_select</code> \u6a5f\u80fd\u3092\u4f7f\u7528\u3057\u3001\u30c6\u30fc\u30d6\u30eb\u884c\u306e\u30af\u30ea\u30c3\u30af\u306b\u3088\u3063\u3066\u8a73\u7d30\u30d3\u30e5\u30fc\uff08Restore Data\uff09\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u5207\u308a\u66ff\u3048\u308b\u65b9\u5f0f\u3092\u63a1\u7528\u3059\u308b\u3002</p>"},{"location":"adr/0005-dashboard-interaction-model/#consequences","title":"Consequences","text":"<ul> <li>Positive: \u30e6\u30fc\u30b6\u30fc\u306f\u76f4\u611f\u7684\u306b\u30ec\u30b3\u30fc\u30c9\u3092\u9078\u629e\u30fb\u5fa9\u5143\u3067\u304d\u308b\u3002</li> <li>Positive: \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3055\u308c\u305f\u7d50\u679c\u306b\u5bfe\u3057\u3066\u3082\u3001\u6b63\u3057\u3044\u884c\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3067\u8a73\u7d30\u3078\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3002</li> <li>Negative: Streamlit \u306e\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\uff08&lt;1.35\uff09\u3068\u306e\u4e92\u63db\u6027\u304c\u5931\u308f\u308c\u308b\uff08\u305f\u3060\u3057 <code>pyproject.toml</code> \u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u6e08\u307f\u306e\u305f\u3081\u8a31\u5bb9\uff09\u3002</li> </ul>"},{"location":"adr/0005-dashboard-interaction-model/#status","title":"Status","text":"<p>Proposed</p>"},{"location":"adr/0006-semantic-content-type-support/","title":"Semantic Content Type Support","text":""},{"location":"adr/0006-semantic-content-type-support/#context","title":"Context","text":"<p>\u751f\u6210AI\u30bf\u30b9\u30af\u306e\u51fa\u529b\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u3060\u3051\u3067\u306a\u304f\u3001\u753b\u50cf\u3001\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3001\u30c0\u30a4\u30a2\u30b0\u30e9\u30e0\uff08Mermaid, Graphviz/DOT, HTML\uff09\u306a\u3069\u591a\u5c90\u306b\u308f\u305f\u308b\u3002 \u73fe\u72b6\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b9\u30ad\u30fc\u30de\uff08<code>result_type</code> = <code>FILE</code> | <code>DIRECT</code>\uff09\u306f\u300c\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u5f62\u5f0f\u300d\u3057\u304b\u4fdd\u6301\u3057\u3066\u304a\u3089\u305a\u3001\u300c\u30c7\u30fc\u30bf\u306e\u610f\u5473\u7684\u7a2e\u985e\uff08Semantic Type\uff09\u300d\u304c\u4e0d\u660e\u3067\u3042\u308b\u305f\u3081\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u306e\u5fa9\u5143\u6642\u306b\u9069\u5207\u306a\u53ef\u8996\u5316\uff08\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\uff09\u304c\u3067\u304d\u306a\u3044\u3002</p> <p>\u307e\u305f\u3001<code>beautyspot</code> \u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u306e\u624b\u5143\u3067\u52d5\u4f5c\u3059\u308b\u305f\u3081\u3001\u8907\u96d1\u306a\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u624b\u9806\u3084\u91cd\u91cf\u7d1a\u306e\u4f9d\u5b58\u95a2\u4fc2\uff08Alembic\u306a\u3069\uff09\u3092\u5f37\u5236\u3059\u308b\u3053\u3068\u306fUX\u3092\u640d\u306a\u3046\u3002</p>"},{"location":"adr/0006-semantic-content-type-support/#decision","title":"Decision","text":""},{"location":"adr/0006-semantic-content-type-support/#1-database-schema-migration","title":"1. Database Schema &amp; Migration","text":"<ul> <li>Schema Change: <code>tasks</code> \u30c6\u30fc\u30d6\u30eb\u306b <code>content_type</code> (TEXT) \u30ab\u30e9\u30e0\u3092\u8ffd\u52a0\u3059\u308b\u3002</li> <li>Migration Strategy: \"Auto-Migration on Startup\" \u3092\u63a1\u7528\u3059\u308b\u3002<ul> <li>Alembic\u7b49\u306f\u5c0e\u5165\u3057\u306a\u3044\uff08\u4f9d\u5b58\u95a2\u4fc2\u306e\u8efd\u91cf\u5316\u3068UX\u7dad\u6301\u306e\u305f\u3081\uff09\u3002</li> <li><code>Project</code> \u521d\u671f\u5316\u6642\uff08<code>_init_db</code>\uff09\u306b <code>PRAGMA table_info</code> \u3067\u30ab\u30e9\u30e0\u306e\u5b58\u5728\u3092\u78ba\u8a8d\u3057\u3001\u4e0d\u8db3\u3057\u3066\u3044\u308c\u3070\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u307f\u3067 <code>ALTER TABLE</code> \u3092\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3002</li> </ul> </li> </ul>"},{"location":"adr/0006-semantic-content-type-support/#2-type-definition","title":"2. Type Definition","text":"<ul> <li><code>src/beautyspot/types.py</code> \u3092\u65b0\u8a2d\u3057\u3001<code>ContentType</code> \u30af\u30e9\u30b9\u3067\u5b9a\u6570\u3092\u7ba1\u7406\u3059\u308b\u3002</li> <li>Graphviz (DOT) \u3068 Mermaid \u3092\u660e\u78ba\u306b\u533a\u5225\u3059\u308b\u3002<ul> <li><code>ContentType.GRAPHVIZ</code> (<code>text/vnd.graphviz</code>)</li> <li><code>ContentType.MERMAID</code> (<code>text/vnd.mermaid</code>)</li> </ul> </li> </ul>"},{"location":"adr/0006-semantic-content-type-support/#3-interface","title":"3. Interface","text":"<ul> <li><code>@project.task</code> \u30c7\u30b3\u30ec\u30fc\u30bf\u306b <code>content_type</code> \u5f15\u6570\u3092\u8ffd\u52a0\u3057\u3001\u958b\u767a\u8005\u304c\u623b\u308a\u5024\u306e\u578b\u3092\u5ba3\u8a00\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002</li> </ul>"},{"location":"adr/0006-semantic-content-type-support/#4-rendering-strategy-dashboard","title":"4. Rendering Strategy (Dashboard)","text":"<ul> <li>Graphviz: Python\u306e <code>graphviz</code> \u30e9\u30a4\u30d6\u30e9\u30ea\u3068 <code>st.graphviz_chart</code> \u3092\u4f7f\u7528\u3059\u308b\u3002</li> <li>Mermaid: Streamlit\u6a19\u6e96\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u306a\u3044\u305f\u3081\u3001<code>st.components.v1.html</code> \u3092\u4f7f\u7528\u3057\u3066 Mermaid.js (CDN) \u3092\u6ce8\u5165\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u3002</li> </ul>"},{"location":"adr/0006-semantic-content-type-support/#5-dependencies","title":"5. Dependencies","text":"<ul> <li><code>pyproject.toml</code> \u306b <code>graphviz&gt;=0.20.1</code> \u3092\u8ffd\u52a0\u3059\u308b\u3002</li> </ul>"},{"location":"adr/0006-semantic-content-type-support/#consequences","title":"Consequences","text":""},{"location":"adr/0006-semantic-content-type-support/#positive","title":"Positive","text":"<ul> <li>\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u3001\u751f\u6210AI\u304c\u51fa\u529b\u3057\u305f\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u56f3\u3084\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8\u3092\u76f4\u611f\u7684\u306b\u95b2\u89a7\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002</li> <li>\u30e6\u30fc\u30b6\u30fc\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u4f5c\u696d\u3092\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\uff08\u81ea\u52d5\u5316\uff09\u3002</li> <li>\u30c7\u30fc\u30bf\u306e\u300c\u4e2d\u8eab\u300d\u3092\u89e3\u6790\u3057\u3066\u8868\u793a\u5f62\u5f0f\u3092\u63a8\u6e2c\u3059\u308b\u4e0d\u5b89\u5b9a\u306a\u30ed\u30b8\u30c3\u30af\u3092\u6392\u9664\u3067\u304d\u308b\u3002</li> </ul>"},{"location":"adr/0006-semantic-content-type-support/#negative-risks","title":"Negative / Risks","text":"<ul> <li>OS\u4f9d\u5b58: Graphviz\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306b\u306f\u3001\u30e6\u30fc\u30b6\u30fc\u74b0\u5883\u306b <code>dot</code> \u30b3\u30de\u30f3\u30c9\uff08OS\u30ec\u30d9\u30eb\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\uff09\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002</li> <li>Client-Side Rendering: Mermaid\u306fCDN\u7d4c\u7531\u306eJS\u5b9f\u884c\u3068\u306a\u308b\u305f\u3081\u3001\u30aa\u30d5\u30e9\u30a4\u30f3\u74b0\u5883\u3067\u306f\u8868\u793a\u3055\u308c\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u3002</li> </ul>"},{"location":"adr/0007-customizable-serialization-with-msgpack/","title":"Customizable Serialization Strategy with Msgpack Default","text":""},{"location":"adr/0007-customizable-serialization-with-msgpack/#context-and-problem-statement","title":"Context and Problem Statement / \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<p>\u73fe\u5728\u3001<code>beautyspot</code> \u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30fc\u30bf\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\uff08\u4fdd\u5b58\uff09\u306b Python \u6a19\u6e96\u306e <code>pickle</code> \u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002 \u3053\u308c\u306b\u306f\u4ee5\u4e0b\u306e\u91cd\u5927\u306a\u8ab2\u984c\u304c\u3042\u308b\uff1a</p> <ol> <li>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ea\u30b9\u30af (RCE): <code>pickle</code> \u306f\u4fe1\u983c\u3067\u304d\u306a\u3044\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u969b\u306b\u4efb\u610f\u306e\u30b3\u30fc\u30c9\u5b9f\u884c\uff08RCE\uff09\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u300c\u5171\u6709\u30ad\u30e3\u30c3\u30b7\u30e5\u300d\u3068\u3057\u3066\u306e\u5229\u7528\u306b\u30ea\u30b9\u30af\u304c\u3042\u308b\u3002</li> <li>\u4e92\u63db\u6027: Python \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5909\u308f\u308b\u3068\u3001\u30af\u30e9\u30b9\u5b9a\u7fa9\u306e\u4e0d\u6574\u5408\u306b\u3088\u308a\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u306b\u5931\u6557\u3057\u3084\u3059\u3044\u3002</li> <li>\u4ee3\u66ff\u6848\u306e\u6b20\u70b9: \u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306e <code>json</code> \u306f\u5b89\u5168\u3060\u304c\u3001\u753b\u50cf\u306a\u3069\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u52b9\u7387\u7684\u306b\u6271\u3048\u305a\uff08Base64\u5316\u3067\u30b5\u30a4\u30ba\u5897\uff09\u3001\u30bf\u30d7\u30eb\u306a\u3069\u306ePython\u56fa\u6709\u578b\u304c\u5931\u308f\u308c\u308b\u3002</li> </ol> <p>v1.0.0 \u30ea\u30ea\u30fc\u30b9\u306b\u3042\u305f\u308a\u3001\u300c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5b89\u5168\uff08Secure by Default\uff09\u300d \u304b\u3064 \u300c\u62e1\u5f35\u6027\uff08Extensibility\uff09\u300d \u306e\u3042\u308b\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u6226\u7565\u304c\u5fc5\u8981\u3067\u3042\u308b\u3002</p>"},{"location":"adr/0007-customizable-serialization-with-msgpack/#decision-drivers","title":"Decision Drivers / \u8981\u6c42","text":"<ul> <li>Security: \u30c7\u30d5\u30a9\u30eb\u30c8\u72b6\u614b\u3067 RCE \u306e\u30ea\u30b9\u30af\u3092\u6392\u9664\u3057\u305f\u3044\u3002</li> <li>Performance: \u753b\u50cf\u3084Numpy\u914d\u5217\u306a\u3069\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u3001\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306a\u304f\u9ad8\u901f\u306b\u6271\u3044\u305f\u3044\u3002</li> <li>Extensibility: \u30e6\u30fc\u30b6\u30fc\u304c\u72ec\u81ea\u306e\u30af\u30e9\u30b9\u3084\u7279\u6b8a\u306a\u578b\uff08\u4f8b: <code>pandas.DataFrame</code>\uff09\u3092\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u5074\u306e\u5909\u66f4\u306a\u3057\u306b\u4fdd\u5b58\u30fb\u5fa9\u5143\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002</li> <li>Developer Experience (DX): \u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u5931\u6557\u6642\u306b\u3001\u300c\u3069\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u539f\u56e0\u304b\u300d\u3068\u300c\u3069\u3046\u3059\u308c\u3070\u89e3\u6c7a\u3067\u304d\u308b\u304b\u300d\u3092\u660e\u78ba\u306b\u793a\u3057\u305f\u3044\u3002</li> </ul>"},{"location":"adr/0007-customizable-serialization-with-msgpack/#considered-options","title":"Considered Options / \u691c\u8a0e","text":"<ul> <li>Option 1: \u73fe\u72b6\u7dad\u6301\uff08<code>pickle</code> \u306e\u307e\u307e\uff09\u3002\u8b66\u544a\u6587\u3067\u8cac\u4efb\u3092\u30e6\u30fc\u30b6\u30fc\u306b\u59d4\u306d\u308b\u3002</li> <li>Option 2: \u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea <code>json</code> \u306b\u4e00\u672c\u5316\u3059\u308b\u3002\u30d0\u30a4\u30ca\u30ea\u306f Base64 \u30a8\u30f3\u30b3\u30fc\u30c9\u3092\u5f37\u5236\u3059\u308b\u3002</li> <li>Option 3: <code>msgpack</code> \u3092\u63a1\u7528\u3057\u3001\u6a19\u6e96\u578b\u306e\u307f\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3002</li> <li>Option 4: <code>msgpack</code> \u3092\u63a1\u7528\u3057\u3001<code>ExtType</code> \u6a5f\u80fd\u3092\u7528\u3044\u305f\u300c\u30ab\u30b9\u30bf\u30e0\u578b\u767b\u9332\u30b7\u30b9\u30c6\u30e0\u300d\u3092\u5b9f\u88c5\u3059\u308b\u3002</li> </ul>"},{"location":"adr/0007-customizable-serialization-with-msgpack/#decision-outcome","title":"Decision Outcome / \u6c7a\u5b9a","text":"<p>Chosen option: Option 4.</p> <p>\u30b7\u30ea\u30a2\u30e9\u30a4\u30b6\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u3057\u3066 <code>msgpack</code> (MessagePack) \u3092\u63a1\u7528\u3057\u3001\u3055\u3089\u306b\u30e6\u30fc\u30b6\u30fc\u304c\u4efb\u610f\u306e\u578b\u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u6ce8\u5165\u3067\u304d\u308b <code>TypeRegistry</code> \u30d1\u30bf\u30fc\u30f3\u3092\u5c0e\u5165\u3059\u308b\u3002</p> <ol> <li>\u4f9d\u5b58\u95a2\u4fc2: <code>msgpack&gt;=1.0.0</code> \u3092 <code>pyproject.toml</code> \u306b\u8ffd\u52a0\u3059\u308b\u3002</li> <li>\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6319\u52d5:<ul> <li><code>pickle</code> \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5ec3\u6b62\uff08\u307e\u305f\u306f\u30aa\u30d7\u30c8\u30a4\u30f3\u5316\uff09\u3059\u308b\u3002</li> <li><code>msgpack</code> \u3092\u4f7f\u7528\u3057\u3001\u5b89\u5168\u306a\u578b\u306e\u307f\u3092\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u3002</li> </ul> </li> <li>\u30ab\u30b9\u30bf\u30e0\u578b\u306e\u767b\u9332:<ul> <li><code>Project</code> \u30af\u30e9\u30b9\u306b <code>register_type(type, code, encoder, decoder)</code> \u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002</li> <li>\u30e6\u30fc\u30b6\u30fc\u306f\u3001\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3067\u304d\u306a\u3044\u578b\uff08\u4f8b: \u30ab\u30b9\u30bf\u30e0\u30af\u30e9\u30b9\uff09\u306b\u5bfe\u3057\u3066\u3001\u4e00\u610f\u306aID (<code>code</code>) \u3068\u5909\u63db\u95a2\u6570\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u3067\u5bfe\u5fdc\u3067\u304d\u308b\u3002</li> </ul> </li> <li>\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0:<ul> <li>\u672a\u767b\u9332\u306e\u578b\u306b\u906d\u9047\u3057\u305f\u5834\u5408\u3001\u6a19\u6e96\u306e <code>TypeError</code> \u3067\u306f\u306a\u304f\u3001\u5177\u4f53\u7684\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u60c5\u5831\u3068 <code>register_type</code> \u306e\u5229\u7528\u3092\u4fc3\u3059\u89aa\u5207\u306a\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8 (<code>SerializationError</code>) \u3092\u9001\u51fa\u3059\u308b\u3002</li> </ul> </li> </ol>"},{"location":"adr/0007-customizable-serialization-with-msgpack/#technical-details","title":"Technical Details / \u6280\u8853\u8a73\u7d30","text":"<p><code>msgpack</code> \u306e <code>default</code> (pack\u6642) \u3068 <code>ext_hook</code> (unpack\u6642) \u3092\u6d3b\u7528\u3057\u3001\u62e1\u5f35\u578b\u3092 <code>msgpack.ExtType</code> \u3068\u3057\u3066\u30e9\u30c3\u30d7\u3059\u308b\u3002</p> <pre><code># Implementation Sketch\n\nclass Project:\n    def __init__(self, ...):\n        # ...\n        self.serializer = MsgpackSerializer()\n\n    def register_type(self, type_: type, code: int, encoder: Callable, decoder: Callable):\n        \"\"\"\n        Register a custom serializer for a specific type.\n\n        Args:\n            type_: The class to handle (e.g. MyClass)\n            code: Unique integer ID (0-127) for this type\n            encoder: Function that converts obj -&gt; bytes\n            decoder: Function that converts bytes -&gt; obj\n        \"\"\"\n        self.serializer.register(type_, code, encoder, decoder)\n\n# --- Internal ---\n\nclass MsgpackSerializer:\n    def dump(self, obj):\n        return msgpack.packb(obj, default=self._default_packer, use_bin_type=True)\n\n    def load(self, data):\n        return msgpack.unpackb(data, ext_hook=self._ext_hook, raw=False)\n\n    def _default_packer(self, obj):\n        # \u767b\u9332\u6e08\u307f\u306e\u578b\u306a\u3089 ExtType \u306b\u5909\u63db\n        if type(obj) in self._encoders:\n            code, encoder = self._encoders[type(obj)]\n            return msgpack.ExtType(code, encoder(obj))\n\n        # \u672a\u767b\u9332\u306a\u3089\u8a73\u7d30\u306a\u30a8\u30e9\u30fc\u3092\u51fa\u3059\n        raise SerializationError(f\"Object of type '{type(obj).__name__}' is not serializable...\")\n</code></pre>"},{"location":"adr/0007-customizable-serialization-with-msgpack/#consequences","title":"Consequences / \u7d50\u679c","text":"<ul> <li>Positive:<ul> <li>\u5b89\u5168\u6027: <code>pickle</code> \u3092\u6392\u9664\u3059\u308b\u3053\u3068\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306e\u8106\u5f31\u6027\u3092\u89e3\u6d88\u3067\u304d\u308b\u3002</li> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: <code>json</code> + Base64 \u3088\u308a\u3082\u9ad8\u901f\u304b\u3064\u7701\u30b5\u30a4\u30ba\u3067\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u6271\u3048\u308b\u3002</li> <li>\u67d4\u8edf\u6027: \u30e6\u30fc\u30b6\u30fc\u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30d5\u30a9\u30fc\u30af\u3059\u308b\u3053\u3068\u306a\u304f\u3001\u5fc5\u8981\u306a\u578b\uff08Numpy, Pandas, Custom Class\uff09\u306e\u5bfe\u5fdc\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3002</li> </ul> </li> <li>Negative:<ul> <li>\u4f9d\u5b58\u95a2\u4fc2: \u65b0\u305f\u306b <code>msgpack</code> \u30d1\u30c3\u30b1\u30fc\u30b8\u3078\u306e\u4f9d\u5b58\u304c\u767a\u751f\u3059\u308b\uff08\u305f\u3060\u3057\u8efd\u91cf\u3067\u3042\u308b\u305f\u3081\u8a31\u5bb9\u7bc4\u56f2\u3068\u3059\u308b\uff09\u3002</li> <li>\u79fb\u884c\u30b3\u30b9\u30c8: \u65e2\u5b58\u306e <code>pickle</code> \u3067\u4fdd\u5b58\u3055\u308c\u305f\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30fc\u30bf (<code>.pkl</code>) \u3068\u306e\u4e92\u63db\u6027\u304c\u306a\u304f\u306a\u308b\u305f\u3081\u3001v1.0.0 \u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6642\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30af\u30ea\u30a2\uff08DB\u30ea\u30bb\u30c3\u30c8\uff09\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002</li> </ul> </li> </ul>"},{"location":"adr/0007-customizable-serialization-with-msgpack/#updates-2025-12-11","title":"Updates (2025-12-11)","text":"<p>See ADR-0009 for further refinements regarding <code>save_blob=False</code> behavior (Msgpack + Base64) and size guardrails.</p>"},{"location":"adr/0008-database-dependency-injection/","title":"Database Dependency Injection and Abstraction","text":""},{"location":"adr/0008-database-dependency-injection/#context-and-problem-statement","title":"Context and Problem Statement / \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<p>\u3053\u308c\u307e\u3067\u306e <code>beautyspot</code> (<code>v0.x</code>) \u306f\u3001<code>Project</code> \u30af\u30e9\u30b9\u5185\u90e8\u3067 <code>TaskDB</code> (SQLite\u5b9f\u88c5) \u3092\u30cf\u30fc\u30c9\u30b3\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u3044\u305f\u3002</p> <pre><code># v0.x implementation\nself.db = TaskDB(self.db_path)\n</code></pre> <p>\u3053\u306e\u8a2d\u8a08\u306b\u306f\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u3042\u308b\uff1a</p> <ol> <li>\u62e1\u5f35\u6027\u306e\u6b20\u5982: SQLite \u4ee5\u5916\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff08PostgreSQL, DuckDB, In-Memory DB\u7b49\uff09\u3092\u4f7f\u3044\u305f\u304f\u3066\u3082\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u63db\u3048\u306a\u3044\u9650\u308a\u4e0d\u53ef\u80fd\u3067\u3042\u308b\u3002</li> <li>\u30c6\u30b9\u30c8\u306e\u5236\u7d04: \u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u6642\u306b\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u4f9d\u5b58\u3057\u306a\u3044\u30e2\u30c3\u30afDB\u3084\u30aa\u30f3\u30e1\u30e2\u30eaDB\u3078\u306e\u5dee\u3057\u66ff\u3048\u304c\u56f0\u96e3\u3067\u3042\u308b\u3002</li> </ol> <p>v1.0.0 \u3067\u306f\u3001\u30e6\u30fc\u30b6\u30fc\u4f53\u9a13\uff08DX\uff09\u3068\u3057\u3066\u306e\u300c\u624b\u8efd\u3055\uff08\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3060\u3051\uff09\u300d\u3092\u7dad\u6301\u3057\u3064\u3064\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30ec\u30d9\u30eb\u3067\u306e\u67d4\u8edf\u6027\u3092\u78ba\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002</p>"},{"location":"adr/0008-database-dependency-injection/#decision-drivers","title":"Decision Drivers / \u8981\u6c42","text":"<ul> <li>Extensibility: \u30e6\u30fc\u30b6\u30fc\u304c\u72ec\u81ea\u306e <code>TaskDB</code> \u5b9f\u88c5\u3092\u6ce8\u5165 (Inject) \u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002</li> <li>Backward Compatibility / DX: \u5f93\u6765\u901a\u308a\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\uff08\u6587\u5b57\u5217\uff09\u3092\u6e21\u3059\u3060\u3051\u306e\u521d\u671f\u5316\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3001\u30e9\u30a4\u30c8\u30e6\u30fc\u30b6\u30fc\u306e\u8ca0\u62c5\u3092\u5897\u3084\u3055\u306a\u3044\u3002</li> <li>Testability: \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5c64\u306e\u30e2\u30c3\u30af\u5316\u3092\u5bb9\u6613\u306b\u3059\u308b\u3002</li> </ul>"},{"location":"adr/0008-database-dependency-injection/#decision-outcome","title":"Decision Outcome / \u6c7a\u5b9a","text":"<p>Chosen option: Dependency Injection with Abstract Base Class.</p> <ol> <li>\u62bd\u8c61\u5316: <code>src/beautyspot/db.py</code> \u306b\u62bd\u8c61\u57fa\u5e95\u30af\u30e9\u30b9 <code>TaskDB</code> \u3092\u5b9a\u7fa9\u3057\u3001\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08<code>save</code>, <code>get</code>, <code>init_schema</code> \u7b49\uff09\u3092\u5f37\u5236\u3059\u308b\u3002</li> <li>\u5177\u8c61\u5316: \u5f93\u6765\u306eSQLite\u5b9f\u88c5\u3092 <code>SQLiteTaskDB</code> \u3068\u3057\u3066\u518d\u5b9a\u7fa9\u3059\u308b\u3002</li> <li>\u6ce8\u5165 (DI): <code>Project</code> \u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u5f15\u6570\u3092 <code>db_path: str</code> \u304b\u3089 <code>db: Union[str, TaskDB]</code> \u306b\u5909\u66f4\u3059\u308b\u3002<ul> <li><code>str</code> \u304c\u6e21\u3055\u308c\u305f\u5834\u5408: \u5185\u90e8\u3067 <code>SQLiteTaskDB(path)</code> \u3092\u751f\u6210\u3059\u308b\uff08Convenience\uff09\u3002</li> <li><code>TaskDB</code> \u304c\u6e21\u3055\u308c\u305f\u5834\u5408: \u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u3059\u308b\uff08Injection\uff09\u3002</li> </ul> </li> </ol>"},{"location":"adr/0008-database-dependency-injection/#consequences","title":"Consequences / \u7d50\u679c","text":"<ul> <li>Positive:<ul> <li>PostgreSQL \u3084 MySQL \u306a\u3069\u306e\u30a2\u30c0\u30d7\u30bf\u3092\u30e6\u30fc\u30b6\u30fc\u5074\u3067\u5b9f\u88c5\u3057\u3001<code>Project(..., db=PostgresDB(...))</code> \u306e\u3088\u3046\u306b\u5229\u7528\u53ef\u80fd\u306b\u306a\u308b\u3002</li> <li>\u30c6\u30b9\u30c8\u6642\u306b <code>MemoryTaskDB</code> \u306a\u3069\u3092\u5dee\u3057\u8fbc\u3080\u3053\u3068\u3067\u3001\u9ad8\u901f\u304b\u3064\u30af\u30ea\u30fc\u30f3\u306a\u30c6\u30b9\u30c8\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002</li> </ul> </li> <li>Negative:<ul> <li><code>db_path</code> \u5f15\u6570\u304c\u5ec3\u6b62\uff08\u307e\u305f\u306f <code>db</code> \u306b\u7d71\u5408\uff09\u3055\u308c\u308b\u305f\u3081\u3001\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u5f15\u6570\u540d\u5909\u66f4\u304c\u5fc5\u8981\u306b\u306a\u308b\uff08v1.0.0 \u3067\u306e\u7834\u58ca\u7684\u5909\u66f4\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0009-msgpack-everywhere-and-guardrails/","title":"Msgpack Everywhere with Native BLOB Support","text":""},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#context-and-problem-statement","title":"Context and Problem Statement","text":"<p>ADR-0007 \u3067 <code>MsgpackSerializer</code> \u3092\u5c0e\u5165\u3057\u305f\u304c\u3001SQLite\u3078\u306e\u4fdd\u5b58\u65b9\u5f0f\u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u6b8b\u3063\u3066\u3044\u305f\u3002</p> <ol> <li>JSON\u306e\u9650\u754c: \u5f93\u6765\u306e <code>TEXT</code> \u30ab\u30e9\u30e0\uff08JSON\uff09\u3067\u306f\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u6271\u3048\u305a\u3001Numpy\u914d\u5217\u306a\u3069\u304c\u4fdd\u5b58\u3067\u304d\u306a\u3044\u3002</li> <li>Base64\u306e\u975e\u52b9\u7387\u6027: <code>TEXT</code> \u30ab\u30e9\u30e0\u306b\u4fdd\u5b58\u3059\u308b\u305f\u3081\u306b Msgpack \u3092 Base64 \u30a8\u30f3\u30b3\u30fc\u30c9\u3059\u308b\u6848\uff08\u65e7ADR-0009\uff09\u304c\u3042\u3063\u305f\u304c\u3001\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u7d0433%\u5897\u52a0\u3057\u3001CPU\u30b3\u30b9\u30c8\u3082\u304b\u304b\u308b\u3002</li> <li>\u4e00\u8cab\u6027: \u753b\u50cf\u3084\u52d5\u753b\u306a\u3069\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3082\u3001\u53ef\u80fd\u306a\u9650\u308a\u5909\u63db\u306a\u3057\u3067\u300c\u305d\u306e\u307e\u307e\u300d\u6271\u3044\u305f\u3044\u3002</li> </ol>"},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#decision-drivers","title":"Decision Drivers","text":"<ul> <li>Performance: \u30b7\u30ea\u30a2\u30e9\u30a4\u30ba/\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\uff08Base64\u7b49\uff09\u3092\u6700\u5c0f\u5316\u3057\u305f\u3044\u3002</li> <li>Efficiency: \u30b9\u30c8\u30ec\u30fc\u30b8\u5bb9\u91cf\u3092\u7121\u99c4\u306b\u6d88\u8cbb\u3057\u305f\u304f\u306a\u3044\u3002</li> <li>Consistency: \u5c0f\u3055\u3044\u30c7\u30fc\u30bf\uff08DB\u5185\uff09\u3082\u5927\u304d\u3044\u30c7\u30fc\u30bf\uff08\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\uff09\u3082\u3001\u540c\u3058 Msgpack \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u7d71\u4e00\u3057\u305f\u3044\u3002</li> </ul>"},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#decision-outcome","title":"Decision Outcome","text":""},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#1-schema-change-add-blob-column","title":"1. Schema Change: Add BLOB Column","text":"<p><code>tasks</code> \u30c6\u30fc\u30d6\u30eb\u306b\u3001\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u305d\u306e\u307e\u307e\u683c\u7d0d\u3059\u308b\u305f\u3081\u306e <code>result_data</code> (BLOB) \u30ab\u30e9\u30e0\u3092\u8ffd\u52a0\u3059\u308b\u3002</p> <ul> <li>\u65e2\u5b58\u306e <code>result_value</code> (TEXT) \u30ab\u30e9\u30e0\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3084\u30ec\u30ac\u30b7\u30fc\u306aJSON\u30c7\u30fc\u30bf\u306e\u4fdd\u6301\u7528\u306b\u7d99\u7d9a\u5229\u7528\u3059\u308b\u3002</li> <li>\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306f <code>Project</code> \u521d\u671f\u5316\u6642\u306b <code>ALTER TABLE</code> \u3067\u81ea\u52d5\u7684\u306b\u884c\u308f\u308c\u308b\u3002</li> </ul>"},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#2-msgpack-everywhere-strategy","title":"2. Msgpack Everywhere Strategy","text":"<p>\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u5148\u306b\u95a2\u308f\u3089\u305a\u3001\u5e38\u306b <code>MsgpackSerializer</code> \u3092\u901a\u904e\u3055\u305b\u308b\u3002</p> <ul> <li><code>save_blob=False</code> (Direct Mode):<ul> <li>Msgpack\u30d0\u30a4\u30ca\u30ea\u3092 <code>result_data</code> (BLOB) \u30ab\u30e9\u30e0 \u306b\u305d\u306e\u307e\u307e\u4fdd\u5b58\u3059\u308b\u3002</li> <li><code>result_type</code> \u306f <code>DIRECT_BLOB</code> \u3068\u3059\u308b\u3002</li> </ul> </li> <li><code>save_blob=True</code> (Blob Mode):<ul> <li>Msgpack\u30d0\u30a4\u30ca\u30ea\u3092\u5916\u90e8\u30d5\u30a1\u30a4\u30eb\uff08<code>.bin</code>\uff09\u3068\u3057\u3066\u4fdd\u5b58\u3002</li> <li>\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092 <code>result_value</code> (TEXT) \u30ab\u30e9\u30e0 \u306b\u4fdd\u5b58\u3059\u308b\u3002</li> <li><code>result_type</code> \u306f <code>FILE</code> \u3068\u3059\u308b\u3002</li> </ul> </li> </ul>"},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#3-size-guardrails-unchanged","title":"3. Size Guardrails (Unchanged)","text":"<p><code>save_blob=False</code> \u3067\u3042\u3063\u3066\u3082\u3001\u95be\u5024\uff08\u30c7\u30d5\u30a9\u30eb\u30c8: 1MB\uff09\u3092\u8d85\u3048\u308b\u30c7\u30fc\u30bf\u304c\u6e21\u3055\u308c\u305f\u5834\u5408\u306f\u3001\u8b66\u544a\u30ed\u30b0 (<code>WARNING</code>) \u3092\u51fa\u529b\u3057\u3066 <code>save_blob=True</code> \u306e\u5229\u7528\u3092\u4fc3\u3059\u3002</p>"},{"location":"adr/0009-msgpack-everywhere-and-guardrails/#consequences","title":"Consequences","text":"<ul> <li>Positive:<ul> <li>\u6700\u9ad8\u52b9\u7387: Base64\u30a8\u30f3\u30b3\u30fc\u30c9\u304c\u4e0d\u8981\u306b\u306a\u308a\u3001\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u3068CPU\u8ca0\u8377\u304c\u6700\u5c0f\u5316\u3055\u308c\u308b\u3002</li> <li>\u4e92\u63db\u6027: \u65e2\u5b58\u306e <code>result_value</code> \u30ab\u30e9\u30e0\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u3001\u65e7\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30fc\u30bf\u3082\u8aad\u307f\u8fbc\u307f\u53ef\u80fd\u3002</li> </ul> </li> <li>Negative:<ul> <li>\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30b9\u30ad\u30fc\u30de\u5909\u66f4\uff08\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\uff09\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002</li> <li><code>sqlite3</code> \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u7b49\u3067 <code>SELECT</code> \u3057\u305f\u969b\u3001\u4e2d\u8eab\u304c\u30d0\u30a4\u30ca\u30ea\u306e\u305f\u3081\u8996\u8a8d\u3067\u304d\u306a\u3044\uff08\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7b49\u306e\u30c4\u30fc\u30eb\u304c\u5fc5\u8981\uff09\u3002</li> </ul> </li> </ul>"},{"location":"adr/0010-canonical-input-serialization/","title":"Canonical Input Serialization with Msgpack and SHA-256","text":""},{"location":"adr/0010-canonical-input-serialization/#context-and-problem-statement","title":"Context and Problem Statement","text":"<p><code>beautyspot</code> \u306f\u3053\u308c\u307e\u3067\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u306e\u751f\u6210\u306b <code>json.dumps(sort_keys=True)</code> \u3068 <code>MD5</code> \u3092\u4f7f\u7528\u3057\u3066\u3044\u305f\u3002 \u3057\u304b\u3057\u3001\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u9855\u5728\u5316\u3057\u3066\u3044\u305f\uff1a</p> <ol> <li>\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306e\u975e\u52b9\u7387\u6027: Numpy\u914d\u5217\u3084\u753b\u50cf\u30c7\u30fc\u30bf\u306a\u3069\u3092JSON\u5316\u3059\u308b\u969b\u3001\u30c6\u30ad\u30b9\u30c8\u5909\u63db\uff08<code>tolist()</code> \u3084 <code>str()</code>\uff09\u306b\u3088\u308b\u5de8\u5927\u306a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3068\u30e1\u30e2\u30ea\u6d88\u8cbb\u304c\u767a\u751f\u3059\u308b\u3002</li> <li>\u30cf\u30c3\u30b7\u30e5\u306e\u885d\u7a81\u30ea\u30b9\u30af: <code>str()</code> \u306b\u4f9d\u5b58\u3057\u305f\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u306f\u3001\u5de8\u5927\u306aNumpy\u914d\u5217\u304c\u7701\u7565\u8868\u793a\uff08<code>...</code>\uff09\u3055\u308c\u305f\u969b\u306b\u30cf\u30c3\u30b7\u30e5\u304c\u885d\u7a81\u3057\u3001\u8aa4\u3063\u305f\u30ad\u30e3\u30c3\u30b7\u30e5\u30d2\u30c3\u30c8\u3092\u5f15\u304d\u8d77\u3053\u3059\u5371\u967a\u6027\u304c\u3042\u308b\u3002</li> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u8001\u673d\u5316: <code>MD5</code> \u306f\u73fe\u4ee3\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u57fa\u6e96\u3067\u306f\u975e\u63a8\u5968\u3068\u3055\u308c\u3066\u304a\u308a\u3001\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u4e0a\u306e\u61f8\u5ff5\u304c\u3042\u308b\u3002</li> </ol>"},{"location":"adr/0010-canonical-input-serialization/#decision-drivers","title":"Decision Drivers","text":"<ul> <li>Accuracy: \u5165\u529b\u30c7\u30fc\u30bf\u304c\u5c11\u3057\u3067\u3082\u7570\u306a\u308c\u3070\u3001\u78ba\u5b9f\u306b\u7570\u306a\u308b\u30ad\u30fc\u3092\u751f\u6210\u3057\u305f\u3044\uff08\u7279\u306bNumpy\u914d\u5217\uff09\u3002</li> <li>Performance: \u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u52b9\u7387\u7684\u306b\u6271\u3044\u305f\u3044\u3002</li> <li>Consistency: \u5165\u529b\uff08\u30ad\u30fc\u751f\u6210\uff09\u3082\u51fa\u529b\uff08\u30c7\u30fc\u30bf\u4fdd\u5b58\uff09\u3082 <code>msgpack</code> \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3067\u7d71\u4e00\u3057\u305f\u3044\u3002</li> </ul>"},{"location":"adr/0010-canonical-input-serialization/#decision-outcome","title":"Decision Outcome","text":"<p>\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u751f\u6210\u30ed\u30b8\u30c3\u30af\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5237\u65b0\u3059\u308b\uff1a</p> <ol> <li>Canonicalization (\u6b63\u898f\u5316):<ul> <li>\u72ec\u81ea\u306e\u6b63\u898f\u5316\u95a2\u6570 <code>canonicalize(obj)</code> \u3092\u5b9f\u88c5\u3059\u308b\u3002</li> <li>Dict: \u30ad\u30fc\u3067\u30bd\u30fc\u30c8\u3055\u308c\u305f\u300c\u30bf\u30d7\u30eb\u306e\u30ea\u30b9\u30c8 <code>[[k, v], ...]</code>\u300d\u306b\u5909\u63db\u3057\u3001\u9806\u5e8f\u3092\u56fa\u5b9a\u3059\u308b\u3002</li> <li>Set: \u30bd\u30fc\u30c8\u3055\u308c\u305f\u30ea\u30b9\u30c8\u306b\u5909\u63db\u3059\u308b\u3002</li> <li>Numpy: <code>numpy</code> \u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u305b\u305a\u3001Duck Typing\uff08<code>shape</code>, <code>dtype</code>, <code>tobytes</code> \u5c5e\u6027\u306e\u78ba\u8a8d\uff09\u306b\u3088\u308a\u691c\u77e5\u3057\u3001\u751f\u306e\u30d0\u30a4\u30c8\u5217\u3092\u542b\u3080\u30bf\u30d7\u30eb\u306b\u5909\u63db\u3059\u308b\u3002\u3053\u308c\u306b\u3088\u308a\u5b8c\u5168\u306a\u4e00\u610f\u6027\u3092\u4fdd\u8a3c\u3059\u308b\u3002</li> </ul> </li> <li>Serialization:<ul> <li>\u6b63\u898f\u5316\u3055\u308c\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092 <code>msgpack</code> \u3067\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u3002</li> </ul> </li> <li>Hashing:<ul> <li>\u30cf\u30c3\u30b7\u30e5\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092 <code>SHA-256</code> \u306b\u5909\u66f4\u3059\u308b\u3002</li> </ul> </li> </ol>"},{"location":"adr/0010-canonical-input-serialization/#consequences","title":"Consequences","text":"<ul> <li>Positive:<ul> <li>Numpy\u914d\u5217\u306a\u3069\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308b\u30cf\u30c3\u30b7\u30e5\u751f\u6210\u304c\u5287\u7684\u306b\u9ad8\u901f\u5316\u30fb\u7701\u30e1\u30e2\u30ea\u5316\u3055\u308c\u308b\u3002</li> <li>\u7701\u7565\u8868\u793a\u306b\u3088\u308b\u30cf\u30c3\u30b7\u30e5\u885d\u7a81\u30d0\u30b0\u304c\u89e3\u6d88\u3055\u308c\u308b\u3002</li> <li><code>pickle</code> \u3092\u4f7f\u7528\u3057\u306a\u3044\u305f\u3081\u3001\u5b89\u5168\u6027\uff08RCE\u30d5\u30ea\u30fc\uff09\u304c\u7dad\u6301\u3055\u308c\u308b\u3002</li> </ul> </li> <li>Negative:<ul> <li>\u7834\u58ca\u7684\u5909\u66f4: \u65e2\u5b58\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\uff08v1.x\uff09\u3068\u306f\u30ad\u30fc\u304c\u4e00\u81f4\u3057\u306a\u304f\u306a\u308b\u305f\u3081\u3001v2.0.0 \u3067\u306e\u30ea\u30ea\u30fc\u30b9\u304c\u5fc5\u8981\u3002</li> <li>\u5de8\u5927\u3067\u6df1\u304f\u30cd\u30b9\u30c8\u3057\u305f\u8f9e\u66f8\u30c7\u30fc\u30bf\u306e\u5834\u5408\u3001Python\u5074\u3067\u306e\u6b63\u898f\u5316\u51e6\u7406\u306b\u3088\u308a\u82e5\u5e72\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u5897\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002</li> </ul> </li> </ul>"},{"location":"adr/0011-imperative-execution-and-workspace/","title":"11. Imperative Execution, Smart Defaults, and Workspace Management","text":"<p>Date: 2026-01-18</p>"},{"location":"adr/0011-imperative-execution-and-workspace/#status","title":"Status","text":"<p>Accepted</p>"},{"location":"adr/0011-imperative-execution-and-workspace/#context","title":"Context","text":"<p>\u3053\u308c\u307e\u3067 <code>beautyspot</code> \u306f\u3001\u95a2\u6570\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5316\u306b\u30c7\u30b3\u30ec\u30fc\u30bf (<code>@project.task</code>) \u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u306e\u307f\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u5b9f\u969b\u306e\u5229\u7528\u30b7\u30ca\u30ea\u30aa\u306b\u304a\u3044\u3066\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u6d6e\u304d\u5f6b\u308a\u306b\u306a\u308a\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u5229\u7528: \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3067\u304d\u306a\u3044\u95a2\u6570\uff08\u4f8b: <code>pandas.read_csv</code>\uff09\u3084\u3001\u5916\u90e8API\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u305f\u3044\u5834\u5408\u3001\u308f\u3056\u308f\u3056\u30e9\u30c3\u30d1\u30fc\u95a2\u6570\u3092\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u8a18\u8ff0\u304c\u5197\u9577\u306b\u306a\u308b\u3002</li> <li>\u30a2\u30c9\u30db\u30c3\u30af\u306a\u89e3\u6790: \u30ce\u30fc\u30c8\u30d6\u30c3\u30af\u74b0\u5883\u3084\u4e00\u6642\u7684\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u8a66\u884c\u932f\u8aa4\u3059\u308b\u969b\u3001\u95a2\u6570\u5b9a\u7fa9\u306e\u624b\u9593\u304c\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3068\u306a\u308a\u3001\u958b\u767a\u4f53\u9a13\uff08DX\uff09\u3092\u640d\u306d\u308b\u3002</li> <li>\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u306e\u66d6\u6627\u3055: <code>Project</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5185\u90e8\u3067\u4fdd\u6301\u3059\u308b <code>ThreadPoolExecutor</code> \u304c\u9069\u5207\u306b\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3055\u308c\u306a\u3044\u5834\u5408\u3001\u30d7\u30ed\u30bb\u30b9\u304c\u30cf\u30f3\u30b0\u3059\u308b\u30ea\u30b9\u30af\u304c\u3042\u308b\u3002</li> <li>\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6c5a\u67d3: \u751f\u6210\u3055\u308c\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb (<code>.db</code>) \u3084Blob\u30c7\u30a3\u30ec\u30af\u30c8\u30ea (<code>blobs/</code>) \u304c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u76f4\u4e0b\u306b\u4f5c\u6210\u3055\u308c\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u304c\u7169\u96d1\u306b\u306a\u308b\u3002</li> <li>\u8a2d\u5b9a\u306e\u91cd\u8907: \u8907\u6570\u306e\u30bf\u30b9\u30af\u3067\u300c\u5e38\u306bBlob\u4fdd\u5b58\u3057\u305f\u3044\u300d\u300c\u7279\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e00\u5f8b\u9069\u7528\u3057\u305f\u3044\u300d\u3068\u3044\u3063\u305f\u5834\u5408\u3001\u90fd\u5ea6\u5f15\u6570\u3092\u6307\u5b9a\u3059\u308b\u306e\u306f DRY (Don't Repeat Yourself) \u539f\u5247\u306b\u53cd\u3059\u308b\u3002</li> <li><code>None</code> \u7d50\u679c\u306e\u30ad\u30e3\u30c3\u30b7\u30e5: <code>time.sleep</code> \u306e\u3088\u3046\u306b\u623b\u308a\u5024\u304c <code>None</code> \u3067\u3042\u308b\u95a2\u6570\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30df\u30b9\u3068\u8aa4\u8a8d\u3055\u308c\u518d\u5b9f\u884c\u3055\u308c\u3066\u3057\u307e\u3046\u30d0\u30b0\u304c\u5b58\u5728\u3057\u305f\u3002</li> </ol>"},{"location":"adr/0011-imperative-execution-and-workspace/#decision","title":"Decision","text":"<p>\u3053\u308c\u3089\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u5305\u62ec\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"adr/0011-imperative-execution-and-workspace/#1-projectrun","title":"1. \u547d\u4ee4\u7684\u5b9f\u884c\u30e1\u30bd\u30c3\u30c9 (<code>project.run</code>) \u306e\u5c0e\u5165","text":"<p>\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u4f7f\u7528\u305b\u305a\u3001\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u5f15\u6570\u3092\u6e21\u3059\u3053\u3068\u3067\u5373\u5ea7\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u4ed8\u304d\u5b9f\u884c\u3092\u884c\u3046 <code>run</code> \u30e1\u30bd\u30c3\u30c9\u3092 <code>Project</code> \u30af\u30e9\u30b9\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <pre><code>result = project.run(func, arg1, arg2, _save_blob=True)\n</code></pre> <ul> <li>\u5f15\u6570\u8a2d\u8a08: \u30ad\u30e3\u30c3\u30b7\u30e5\u5236\u5fa1\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u5f15\u6570\u306f\u3001\u5bfe\u8c61\u95a2\u6570\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570 (<code>kwargs</code>) \u3068\u306e\u885d\u7a81\u3092\u907f\u3051\u308b\u305f\u3081\u3001\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9 <code>_</code> \u3092\u4ed8\u4e0e\u3057\u307e\u3059\uff08\u4f8b: <code>_save_blob</code>, <code>_version</code>, <code>_content_type</code>\uff09\u3002</li> </ul>"},{"location":"adr/0011-imperative-execution-and-workspace/#2","title":"2. \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30de\u30cd\u30fc\u30b8\u30e3\u3068\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406","text":"<p><code>Project</code> \u30af\u30e9\u30b9\u3092\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30de\u30cd\u30fc\u30b8\u30e3\u3068\u3057\u3066\u8a2d\u8a08\u3057\u3001<code>with</code> \u30d6\u30ed\u30c3\u30af\u5185\u3067\u306e\u5229\u7528\u3092\u63a8\u5968\u30d1\u30bf\u30fc\u30f3\u3068\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d6\u30ed\u30c3\u30af\u7d42\u4e86\u6642\u306b\u78ba\u5b9f\u306b <code>shutdown()</code> \u304c\u547c\u3070\u308c\u3001\u30b9\u30ec\u30c3\u30c9\u30d7\u30fc\u30eb\u7b49\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u89e3\u653e\u3055\u308c\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p>"},{"location":"adr/0011-imperative-execution-and-workspace/#3","title":"3. \u8a2d\u5b9a\u306e\u968e\u5c64\u5316\u3068\u30b9\u30de\u30fc\u30c8\u30c7\u30d5\u30a9\u30eb\u30c8","text":"<p><code>Project</code> \u521d\u671f\u5316\u6642\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3092\u53d7\u3051\u5165\u308c\u3001\u500b\u5225\u306e\u5b9f\u884c\u6642\u306b\u305d\u308c\u3092\u7d99\u627f\u30fb\u4e0a\u66f8\u304d\u3067\u304d\u308b\u4ed5\u7d44\u307f\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002</p> <ul> <li>\u512a\u5148\u9806\u4f4d:</li> <li>\u500b\u5225\u306e\u6307\u5b9a (<code>run</code> \u3084 <code>@task</code> \u306e\u5f15\u6570)</li> <li>\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30d5\u30a9\u30eb\u30c8 (<code>Project</code> \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u5f15\u6570)</li> <li> <p>\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30d5\u30a9\u30eb\u30c8</p> </li> <li> <p>\u5b9f\u88c5\u8a73\u7d30: \u3053\u308c\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u3001<code>task</code> \u304a\u3088\u3073 <code>run</code> \u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u56fa\u5b9a\u5024\uff08<code>False</code> \u7b49\uff09\u304b\u3089 <code>None</code> \u306b\u5909\u66f4\u3057\u3001\u672a\u6307\u5b9a\u72b6\u614b\u3092\u691c\u51fa\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p> </li> </ul>"},{"location":"adr/0011-imperative-execution-and-workspace/#4","title":"4. \u30ef\u30fc\u30af\u30b9\u30da\u30fc\u30b9\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3088\u308b\u96c6\u7d04","text":"<p>\u3059\u3079\u3066\u306e\u751f\u6210\u30a2\u30fc\u30c6\u30a3\u30d5\u30a1\u30af\u30c8\uff08DB\u3001Blob\uff09\u3092\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea <code>.beautyspot/</code> \u914d\u4e0b\u306b\u96c6\u7d04\u3057\u307e\u3059\u3002 \u307e\u305f\u3001\u521d\u671f\u5316\u6642\u306b\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b <code>.gitignore</code> \uff08\u5185\u5bb9: <code>*</code>\uff09\u3092\u81ea\u52d5\u751f\u6210\u3057\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30a1\u30a4\u30eb\u304c\u8aa4\u3063\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b\u542b\u307e\u308c\u308b\u306e\u3092\u9632\u304e\u307e\u3059\u3002</p>"},{"location":"adr/0011-imperative-execution-and-workspace/#5","title":"5. \u756a\u5175\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u3088\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u5224\u5b9a","text":"<p>\u30ad\u30e3\u30c3\u30b7\u30e5\u30d2\u30c3\u30c8\u306e\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u306b\u304a\u3044\u3066\u3001<code>None</code> \u3092\u300c\u30c7\u30fc\u30bf\u306a\u3057\u300d\u3068\u898b\u306a\u3059\u306e\u3067\u306f\u306a\u304f\u3001\u5c02\u7528\u306e\u756a\u5175\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 (<code>CACHE_MISS = object()</code>) \u3092\u5c0e\u5165\u3057\u3066\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001<code>None</code> \u3092\u8fd4\u3059\u95a2\u6570\u3082\u6b63\u3057\u304f\u30ad\u30e3\u30c3\u30b7\u30e5\u53ef\u80fd\u3068\u3057\u307e\u3059\u3002</p>"},{"location":"adr/0011-imperative-execution-and-workspace/#consequences","title":"Consequences","text":""},{"location":"adr/0011-imperative-execution-and-workspace/#positive","title":"Positive","text":"<ul> <li>\u9ad8\u3044\u67d4\u8edf\u6027: \u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3084\u30e9\u30a4\u30d6\u30e9\u30ea\u547c\u3073\u51fa\u3057\u306b\u5bfe\u3057\u3066\u3001\u30dc\u30a4\u30e9\u30fc\u30d7\u30ec\u30fc\u30c8\u306a\u3057\u3067\u5373\u5ea7\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u9069\u7528\u53ef\u80fd\u306b\u306a\u3063\u305f\u3002</li> <li>\u5b89\u5168\u306a\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406: <code>with</code> \u6587\u306e\u4f7f\u7528\u306b\u3088\u308a\u3001\u30d7\u30ed\u30bb\u30b9\u30cf\u30f3\u30b0\u306e\u30ea\u30b9\u30af\u304c\u5927\u5e45\u306b\u4f4e\u6e1b\u3057\u305f\u3002</li> <li>\u30af\u30ea\u30fc\u30f3\u306a\u74b0\u5883: \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u304c\u6c5a\u308c\u305a\u3001Git\u7ba1\u7406\u304b\u3089\u306e\u9664\u5916\u3082\u81ea\u52d5\u5316\u3055\u308c\u305f\u305f\u3081\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u8ca0\u62c5\u304c\u6e1b\u3063\u305f\u3002</li> <li>\u6b63\u78ba\u306a\u30ad\u30e3\u30c3\u30b7\u30e5: \u526f\u4f5c\u7528\u306e\u307f\u3092\u76ee\u7684\u3068\u3057\u305f\u95a2\u6570\uff08\u623b\u308a\u5024\u306a\u3057\uff09\u3082\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u3001\u9069\u7528\u7bc4\u56f2\u304c\u5e83\u304c\u3063\u305f\u3002</li> </ul>"},{"location":"adr/0011-imperative-execution-and-workspace/#negative","title":"Negative","text":"<ul> <li>API\u306e\u8907\u96d1\u5316: <code>project.run</code> \u306e\u5f15\u6570\u306b\u7279\u6b8a\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u30eb\u30fc\u30eb\uff08<code>_</code>\uff09\u304c\u5c0e\u5165\u3055\u308c\u305f\u305f\u3081\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306e\u5468\u77e5\u304c\u5fc5\u8981\u3002</li> <li>\u5f8c\u65b9\u4e92\u63db\u6027\u306e\u6ce8\u610f: <code>Project</code> \u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3084 <code>task</code> \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u5f15\u6570\u51e6\u7406\u304c\u5909\u66f4\u3055\u308c\u305f\u305f\u3081\u3001\u5185\u90e8\u5b9f\u88c5\u30ec\u30d9\u30eb\u3067\u306f\u53b3\u5bc6\u306a\u30c1\u30a7\u30c3\u30af\u304c\u5fc5\u8981\uff08\u305f\u3060\u3057\u516c\u958bAPI\u3068\u3057\u3066\u306e\u7834\u58ca\u7684\u5909\u66f4\u306f\u6700\u5c0f\u9650\u306b\u7559\u3081\u3066\u3044\u308b\uff09\u3002</li> </ul>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/","title":"12. Rename Project to Spot and Task to Mark","text":"<p>Date: 2026-01-18 Status: Accepted</p>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#context","title":"Context","text":"<p>\u73fe\u5728\u3001<code>beautyspot</code> \u306e\u30e1\u30a4\u30f3\u30a8\u30f3\u30c8\u30ea\u30fc\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066 <code>Project</code> \u30af\u30e9\u30b9\u304c\u3001\u30bf\u30b9\u30af\u5b9a\u7fa9\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3068\u3057\u3066 <code>@project.task</code> \u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u3089\u306e\u540d\u79f0\u306b\u306f\u4ee5\u4e0b\u306e\u8ab2\u984c\u304c\u3042\u308b\u3002</p> <ol> <li> <p><code>Project</code> \u306e\u66d6\u6627\u3055:     \u30e6\u30fc\u30b6\u30fc\u306b\u3068\u3063\u3066 \"Project\" \u306f\u3001\u81ea\u8eab\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u5168\u4f53\u3084\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6307\u3059\u8a00\u8449\u3067\u3042\u308b\u3053\u3068\u304c\u591a\u3044\u3002\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u7ba1\u7406\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092 <code>Project</code> \u3068\u547c\u3076\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u30e1\u30f3\u30bf\u30eb\u30e2\u30c7\u30eb\u3068\u306e\u885d\u7a81\uff08\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u3042\u308b\uff1f\u300d\uff09\u3092\u62db\u3044\u3066\u3044\u308b\u3002\u307e\u305f\u3001<code>beautyspot</code> \u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u540d\u3068\u306e\u95a2\u9023\u6027\u304c\u8584\u3044\u3002</p> </li> <li> <p><code>task</code> \u306e\u4e0d\u4e00\u81f4: <code>task</code> \u306f\u300c\u4ed5\u4e8b\u30fb\u8ab2\u984c\u300d\u3092\u8868\u3059\u540d\u8a5e\u3060\u304c\u3001\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u5f79\u5272\u306f\u300c\u95a2\u6570\u3092\u6c38\u7d9a\u5316\u5bfe\u8c61\u3068\u3057\u3066\u767b\u9332\u30fb\u8a2d\u5b9a\u3059\u308b\u300d\u3068\u3044\u3046\u52d5\u7684\u306a\u4f5c\u7528\u3067\u3042\u308b\u3002\u540d\u8a5e\u3068\u3057\u3066\u306e\u547d\u540d\u306f\u3001\u5ba3\u8a00\u7684\u306a\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u6027\u8cea\u3068\u5b8c\u5168\u306b\u4e00\u81f4\u3057\u3066\u3044\u306a\u3044\u3002</p> </li> <li> <p>\u30d6\u30e9\u30f3\u30c9\u30fb\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\u306e\u6b20\u5982:     \u73fe\u5728\u306e API \u306f\u6c4e\u7528\u7684\u3059\u304e\u3066\u3001\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u7279\u6709\u306e\u300c\u9ed2\u5b50\uff08\u30a4\u30f3\u30d5\u30e9\u5236\u5fa1\u306e\u96a0\u853d\uff09\u300d\u3084\u300c\u7f8e\u70b9\uff08Beauty Spot\uff09\u300d\u3068\u3044\u3046\u30b3\u30f3\u30bb\u30d7\u30c8\u304c\u30b3\u30fc\u30c9\u4e0a\u3067\u8868\u73fe\u3055\u308c\u3066\u3044\u306a\u3044\u3002</p> </li> </ol>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#decision","title":"Decision","text":"<p>\u79c1\u305f\u3061\u306f\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30b3\u30a2\u3068\u306a\u308b\u7528\u8a9e\u3092\u518d\u5b9a\u7fa9\u3057\u3001\u4ee5\u4e0b\u306e\u30ea\u30cd\u30fc\u30e0\u3092\u884c\u3046\u3053\u3068\u3092\u6c7a\u5b9a\u3057\u305f\u3002\u3053\u308c\u306b\u4f34\u3044\u3001\u6b21\u671f\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u30e1\u30b8\u30e3\u30fc\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\uff08Breaking Change\uff09\u3068\u306a\u308b\u3002</p>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#1-rename-project-class-to-spot","title":"1. Rename <code>Project</code> class to <code>Spot</code>","text":"<p>\u7ba1\u7406\u30af\u30e9\u30b9\u306e\u540d\u524d\u3092 <code>Spot</code> \u306b\u5909\u66f4\u3059\u308b\u3002 \u3053\u308c\u306b\u3088\u308a\u3001\u300c\u30b3\u30fc\u30c9\u4e0a\u306e\u7279\u5b9a\u306e\u5834\u6240\uff08Spot\uff09\u3092\u7ba1\u7406\u3059\u308b\u300d\u3068\u3044\u3046\u30cb\u30e5\u30a2\u30f3\u30b9\u3092\u6301\u305f\u305b\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u540d <code>beautyspot</code> \u3068\u306e\u4e00\u8cab\u6027\u3092\u6301\u305f\u305b\u308b\u3002</p>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#2-rename-task-decorator-to-mark","title":"2. Rename <code>@task</code> decorator to <code>@mark</code>","text":"<p>\u30c7\u30b3\u30ec\u30fc\u30bf\u540d\u3092 <code>@spot.mark</code> \u306b\u5909\u66f4\u3059\u308b\u3002 \u3053\u308c\u306f \"Marking a spot\"\uff08\u5730\u70b9\u3092\u30de\u30fc\u30af\u3059\u308b\uff0f\u5370\u3092\u4ed8\u3051\u308b\uff09\u3068\u3044\u3046\u30a4\u30c7\u30a3\u30aa\u30e0\u306b\u57fa\u3065\u3044\u3066\u304a\u308a\u3001\u300c\u3053\u306e\u95a2\u6570\u3092\u7ba1\u7406\u5bfe\u8c61\u3068\u3057\u3066\u30de\u30fc\u30af\u3059\u308b\u300d\u3068\u3044\u3046\u5ba3\u8a00\u7684\u306a\u610f\u56f3\u3092\u660e\u78ba\u306b\u3059\u308b\u3002</p>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#3-keep-run-method-as-spotrun","title":"3. Keep <code>run</code> method as <code>spot.run</code>","text":"<p>\u547d\u4ee4\u7684\u306a\u5b9f\u884c\u30e1\u30bd\u30c3\u30c9\u3067\u3042\u308b <code>run</code> \u306f\u3001\u540d\u524d\u3092\u5909\u66f4\u305b\u305a\u305d\u306e\u307e\u307e\u7dad\u6301\u3059\u308b\u3002 \u3053\u308c\u306f\u3001\u300c<code>mark</code>\uff08\u5ba3\u8a00\u30fb\u9759\u7684\uff09\u300d\u3068\u300c<code>run</code>\uff08\u5b9f\u884c\u30fb\u52d5\u7684\uff09\u300d\u3068\u3044\u3046\u5f79\u5272\u5206\u62c5\u3092\u660e\u78ba\u306b\u3059\u308b\u305f\u3081\u3067\u3042\u308b\u3002</p>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#detailed-design","title":"Detailed Design","text":""},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#api-comparison","title":"API Comparison","text":""},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#before-v1x","title":"Before (v1.x)","text":"<pre><code>import beautyspot as bs\n\n# \"Project\" \u306f\u5e83\u7fa9\u3059\u304e\u308b\nproject = bs.Project(\"my_experiment\")\n\n# \"task\" \u306f\u540d\u8a5e\u3067\u3042\u308a\u3001\u52d5\u7684\u306a\u4f5c\u7528\u304c\u4f1d\u308f\u308a\u306b\u304f\u3044\n@project.task\ndef heavy_process(data):\n    ...\n</code></pre>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#after-v20","title":"After (v2.0)","text":"<pre><code>import beautyspot as bs\n\n# \"Spot\" = \u3053\u3053\u304c\u7ba1\u7406\u5730\u70b9\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\nspot = bs.Spot(\"my_experiment\")\n\n# \"mark\" = \u3053\u306e\u95a2\u6570\u3092\u30b9\u30dd\u30c3\u30c8\u3068\u3057\u3066\u5370\u4ed8\u3051\u3059\u308b (Declarative)\n@spot.mark\ndef heavy_process(data):\n    ...\n\n# \"run\" = \u30b9\u30dd\u30c3\u30c8\u306e\u8a2d\u5b9a\u306b\u57fa\u3065\u3044\u3066\u5b9f\u884c\u3059\u308b (Imperative)\n# mark \u3068\u5bfe\u6bd4\u3055\u308c\u3001\u52d5\u8a5e\u3068\u3057\u3066\u306e run \u304c\u3088\u308a\u81ea\u7136\u306b\u97ff\u304f\nresult = spot.run(heavy_process, data)\n</code></pre>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#consequences","title":"Consequences","text":""},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#positive","title":"Positive","text":"<ul> <li>\u76f4\u611f\u7684\u306a\u30e1\u30f3\u30bf\u30eb\u30e2\u30c7\u30eb: <code>Spot</code> \u3068 <code>mark</code> \u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u300c\u30b3\u30fc\u30c9\u4e0a\u306e\u91cd\u8981\u306a\u7b87\u6240\u306b\u5370\u3092\u4ed8\u3051\u3066\u7ba1\u7406\u3059\u308b\u300d\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u8a08\u601d\u60f3\u304c\u76f4\u611f\u7684\u306b\u4f1d\u308f\u308b\u3088\u3046\u306b\u306a\u308b\u3002</li> <li>\u540d\u524d\u7a7a\u9593\u306e\u660e\u78ba\u5316: \u5909\u6570\u540d <code>spot</code> \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u305d\u308c\u304c <code>beautyspot</code> \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308b\u3053\u3068\u304c\u4e00\u76ee\u3067\u5206\u304b\u308b\uff08<code>project</code> \u5909\u6570\u306f\u30e6\u30fc\u30b6\u30fc\u306e\u30b3\u30fc\u30c9\u3067\u65e2\u306b\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044\uff09\u3002</li> <li>\u4e00\u8cab\u6027: \u30e9\u30a4\u30d6\u30e9\u30ea\u540d\u3068\u30af\u30e9\u30b9\u540d\u304c\u4e00\u81f4\u3057\u3001\u30d6\u30e9\u30f3\u30c9\u3068\u3057\u3066\u306e\u7d71\u4e00\u611f\u304c\u751f\u307e\u308c\u308b\u3002</li> </ul>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#negative","title":"Negative","text":"<ul> <li>\u7834\u58ca\u7684\u5909\u66f4: \u65e2\u5b58\u306e v1.x \u7cfb\u30b3\u30fc\u30c9\u3068\u306f\u4e92\u63db\u6027\u304c\u306a\u304f\u306a\u308b\u3002</li> <li>\u79fb\u884c\u30b3\u30b9\u30c8: \u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\u306f\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u63db\u3048\u304c\u5fc5\u8981\u3068\u306a\u308b\u3002\u307e\u305f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3001Docstring \u306e\u5168\u9762\u7684\u306a\u66f4\u65b0\u304c\u5fc5\u8981\u3068\u306a\u308b\u3002</li> </ul>"},{"location":"adr/0012-rename-project-to-spot-and-task-to-mark/#migration-strategy","title":"Migration Strategy","text":"<p>\u65e2\u5b58\u30e6\u30fc\u30b6\u30fc\u5411\u3051\u306b\u3001\u4ee5\u4e0b\u306e\u79fb\u884c\u30ac\u30a4\u30c9\u3092\u63d0\u4f9b\u3059\u308b\u3002</p> <ol> <li>\u30af\u30e9\u30b9\u540d\u306e\u7f6e\u63db: <code>Project</code> -&gt; <code>Spot</code></li> <li>\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7f6e\u63db: <code>.task</code> -&gt; <code>.mark</code></li> <li>\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e92\u63db\u6027: DB\u30b9\u30ad\u30fc\u30de\u81ea\u4f53\u306b\u5909\u66f4\u306f\u306a\u3044\u305f\u3081\u3001\u65e2\u5b58\u306e <code>.db</code> \u30d5\u30a1\u30a4\u30eb\u306f\u305d\u306e\u307e\u307e\u5229\u7528\u53ef\u80fd\uff08\u305f\u3060\u3057\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u4e0a\u306e\u6574\u5408\u6027\u30c1\u30a7\u30c3\u30af\u306f\u5fc5\u8981\uff09\u3002</li> </ol> <pre><code># Example text replacement\nsed -i 's/Project/Spot/g' **/*.py\nsed -i 's/@project.task/@spot.mark/g' **/*.py\n</code></pre>"},{"location":"adr/0013-decorator-based-type-registration/","title":"Decorator-based Type Registration with Late Binding","text":""},{"location":"adr/0013-decorator-based-type-registration/#context-and-problem-statement","title":"Context and Problem Statement","text":"<p>\u3053\u308c\u307e\u3067\u306e <code>spot.register_type()</code> \u306f\u547d\u4ee4\u7684\u3067\u3042\u308a\u3001\u30af\u30e9\u30b9\u5b9a\u7fa9\u3068\u767b\u9332\u30ed\u30b8\u30c3\u30af\u304c\u5206\u96e2\u3057\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u51dd\u96c6\u5ea6\u304c\u4f4e\u3044\u3068\u3044\u3046\u8ab2\u984c\u304c\u3042\u3063\u305f\u3002 \u307e\u305f\u3001Pydantic \u30e2\u30c7\u30eb\u306e\u3088\u3046\u306a\u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\uff08\u4f8b: <code>cls.model_validate_json</code>\uff09\u3092\u30c7\u30b3\u30fc\u30c0\u3068\u3057\u3066\u767b\u9332\u3057\u305f\u3044\u5834\u5408\u3001\u30c7\u30b3\u30ec\u30fc\u30bf\u8a55\u4fa1\u6642\u306b\u306f\u307e\u3060\u30af\u30e9\u30b9\u304c\u672a\u5b9a\u7fa9\uff08NameError\uff09\u3067\u3042\u308b\u305f\u3081\u3001\u7dba\u9e97\u306b\u8a18\u8ff0\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u6280\u8853\u7684\u306a\u5236\u7d04\u304c\u3042\u3063\u305f\u3002</p>"},{"location":"adr/0013-decorator-based-type-registration/#decision-drivers","title":"Decision Drivers","text":"<ul> <li>Developer Experience (DX): \u30af\u30e9\u30b9\u5b9a\u7fa9\u306e\u76f4\u4e0a\u306b\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u305f\u3044\uff08Co-location\uff09\u3002</li> <li>Support for Modern Libraries: Pydantic \u306a\u3069\u3001\u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\u3092\u30d5\u30a1\u30af\u30c8\u30ea\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3092\u5bb9\u6613\u306b\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u3044\u3002</li> <li>Safety: \u5faa\u74b0\u53c2\u7167\u3084\u672a\u5b9a\u7fa9\u30a8\u30e9\u30fc\u3092\u56de\u907f\u3057\u3064\u3064\u3001\u578b\u5b89\u5168\u306b\u767b\u9332\u3092\u884c\u3044\u305f\u3044\u3002</li> </ul>"},{"location":"adr/0013-decorator-based-type-registration/#decision-outcome","title":"Decision Outcome","text":"<p><code>Spot</code> \u30af\u30e9\u30b9\u306b <code>register</code> \u30c7\u30b3\u30ec\u30fc\u30bf\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u3001<code>decoder_factory</code> \u306b\u3088\u308b\u9045\u5ef6\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0 \u3092\u5c0e\u5165\u3059\u308b\u3002</p>"},{"location":"adr/0013-decorator-based-type-registration/#technical-details","title":"Technical Details","text":"<pre><code>@spot.register(\n    code=10,\n    encoder=lambda obj: ...,\n    decoder_factory=lambda cls: cls.deserialize  # Class is passed here after definition\n)\nclass MyModel:\n    ...\n</code></pre> <ol> <li><code>register</code> \u30c7\u30b3\u30ec\u30fc\u30bf\u306f\u3001\u5bfe\u8c61\u30af\u30e9\u30b9\u306e\u5b9a\u7fa9\u5b8c\u4e86\u5f8c\uff08\u30c7\u30b3\u30ec\u30fc\u30c8\u6642\uff09\u306b\u5b9f\u884c\u3055\u308c\u308b\u3002</li> <li><code>decoder_factory</code> \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u751f\u6210\u3055\u308c\u305f <code>cls</code> \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u5f15\u6570\u3068\u3057\u3066\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5b9f\u884c\u3057\u3001\u5b9f\u969b\u306e <code>decoder</code> \u95a2\u6570\u3092\u53d6\u5f97\u3059\u308b\u3002</li> <li>\u53d6\u5f97\u3057\u305f <code>decoder</code> \u3092\u7528\u3044\u3066\u3001\u65e2\u5b58\u306e <code>register_type</code> \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u767b\u9332\u3059\u308b\u3002</li> </ol>"},{"location":"adr/0013-decorator-based-type-registration/#consequences","title":"Consequences","text":"<ul> <li>Positive:</li> <li>\u30e6\u30fc\u30b6\u30fc\u306f\u30af\u30e9\u30b9\u5b9a\u7fa9\u3068\u767b\u9332\u30921\u7b87\u6240\u306b\u307e\u3068\u3081\u3089\u308c\u308b\u3002</li> <li> <p>\u81ea\u5df1\u53c2\u7167\u3092\u542b\u3080\u30af\u30e9\u30b9\uff08\u81ea\u5206\u81ea\u8eab\u3092\u8fd4\u3059\u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\u306a\u3069\uff09\u306e\u767b\u9332\u304c\u5bb9\u6613\u306b\u306a\u308b\u3002</p> </li> <li> <p>Negative:</p> </li> <li><code>decoder</code> \u3068 <code>decoder_factory</code> \u3068\u3044\u30462\u3064\u306e\u5f15\u6570\u304c\u5897\u3048\u3001API\u304c\u5c11\u3057\u8907\u96d1\u306b\u306a\u308b\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306e\u88dc\u5b8c\u304c\u5fc5\u8981\uff09\u3002</li> </ul>"},{"location":"chat_logs/chat/","title":"Chat","text":""},{"location":"chat_logs/chat/#me","title":"Me","text":"<p>Context: - \udb80\udca5 src/beautyspot/dashboard.py - \udb80\udca5 src/beautyspot/db.py</p>"},{"location":"chat_logs/chat/#bufferdashboardpy","title":"{buffer:dashboard.py}","text":""},{"location":"chat_logs/chat/#bufferdbpy","title":"{buffer:db.py}","text":""},{"location":"chat_logs/chat/#dashboardpy","title":"dashboard.py\u3067\u3001\u30ec\u30b3\u30fc\u30c9\u306e\u524a\u9664\u6a5f\u80fd\u3092\u5b9f\u88c5\u3057\u305f\u3044\u3002","text":"<p>\u5fc5\u8981\u306a\u306e\u306f\u3001</p> <ol> <li>\u624b\u52d5\u3067\u884c\u3092\u9078\u629e\u3067\u304d\u308b\u6a5f\u80fd\uff08\u5b9f\u88c5\u6e08\u307f\uff09</li> <li>\u6761\u4ef6\u6307\u5b9a\u3092\u3057\u3066\u5f53\u3066\u306f\u307e\u308b\u884c\u3092\u9078\u629e\u3059\u308b\u6a5f\u80fd</li> <li>\u9078\u629e\u72b6\u614b\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u524a\u9664\u3059\u308b\u6a5f\u80fd</li> </ol> <p>2\u306e\u6761\u4ef6\u6307\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001\u3059\u3067\u306b\u4e00\u90e8\u3001\u30ec\u30b3\u30fc\u30c9\u306e\u7d5e\u308a\u8fbc\u307f\u6a5f\u80fd\u304c\u3042\u308b\u3002 \u3053\u308c\u306b\u3001\u6642\u9593\u6307\u5b9a\u3057\u3066\u3001\u3053\u306e\u6642\u9593\u3088\u308a\u904e\u53bb\u3001\u3084\u3001\u3044\u3064\u304b\u3089\u3044\u3064\u306e\u9593\u3001\u306e\u3088\u3046\u306a\u6307\u5b9a\u3067\u30ec\u30b3\u30fc\u30c9\u3092\u7d5e\u3063\u305f\u5f8c\u3001\u5168\u4ef6\u9078\u629e\u3067\u304d\u308b\u3068\u3082\u601d\u3063\u3066\u3044\u308b\u3002</p> <p>\u307e\u305a\u306f\u8a2d\u8a08\u3092\u8003\u3048\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"chat_logs/chat/#codecompanion-openai","title":"CodeCompanion (OpenAI)","text":"<p>Here is a compact design for implementing record deletion in the dashboard.</p> <p>Goals - Keep manual row selection (already implemented). - Add condition-based selection (including time range). - Delete the currently selected set (either manually selected rows or the filtered set) with explicit confirmation and optional blob cleanup.</p> <p>Data layer (src/beautyspot/db.py) - Add focused, safe APIs that operate by cache_key. This avoids duplicating UI filter logic in SQL and sidesteps the current 1000-row limit pitfalls unless we explicitly support DB-side range deletion.</p> <ul> <li> <p>delete_by_keys(keys: list[str]) -&gt; int</p> <ul> <li>DELETE FROM tasks WHERE cache_key IN (...)</li> <li>Returns number of rows deleted.</li> <li>Use a single transaction and chunk the keys if the list is large.</li> </ul> </li> <li> <p>get_records(keys: list[str]) -&gt; list[dict]</p> <ul> <li>SELECT result_type, result_value, cache_key FROM tasks WHERE cache_key IN (...)</li> <li>Used to determine which rows are FILE and prepare optional blob deletion.</li> </ul> </li> </ul> <p>Optional (for power users deleting beyond the loaded limit):   - delete_by_time_range(start: Optional[datetime], end: Optional[datetime]) -&gt; int     - Executes SQL WHERE updated_at BETWEEN ... with proper bounds.     - Flag this as \u201cdangerous\u201d in UI and guard with a dedicated confirmation.</p> <p>UI/interaction (src/beautyspot/dashboard.py) - Filters   - Sidebar additions:     - Time filter toggle.     - Start datetime, End datetime (both optional).     - Quick presets (e.g., last 24h/7d) optional.   - Implementation detail:     - Convert df[\"updated_at\"] = pd.to_datetime(df[\"updated_at\"], utc=False, errors=\"coerce\")     - Apply start/end filters if provided.</p> <ul> <li>Selection modes</li> <li>Change table to selection_mode=\"multi-row\".</li> <li>Manual selection stays as-is; collect selected_keys from event.selection.rows mapped to the currently displayed (filtered, sorted) df.</li> <li> <p>Add a toggle/checkbox \u201cUse filtered rows as selection\u201d. When on, the \u201cselection\u201d equals all rows in the currently filtered df (no need to programmatically highlight the table).</p> </li> <li> <p>Deletion workflow</p> </li> <li>Show a \u201cDelete selected\u201d button with the count of selected items (manual or filtered).</li> <li> <p>On click:</p> <ul> <li>If no keys selected, show warning.</li> <li>Otherwise open a modal dialog:</li> <li>Show number of records to delete.</li> <li>Inspect selected records via get_records to compute how many are FILE and summarize local paths vs. s3://.</li> <li>Checkbox: \u201cAlso delete blobs (FILE)\u201d.</li> <li>Secondary checkbox for \u201cForce delete even if blobs cannot be removed\u201d (so DB doesn\u2019t get blocked by file errors).</li> <li>Require explicit confirmation (e.g., type DELETE).</li> <li>On confirm:</li> <li>If blob deletion checked:<ul> <li>Try removing local files (os.remove), skip missing, collect errors.</li> <li>For s3:// consider skipping initially or implement best-effort delete if S3Storage has delete; report skipped/not supported items.</li> </ul> </li> <li>Call delete_by_keys(keys) in a transaction.</li> <li>Clear cache and rerun (st.cache_data.clear(); st.rerun()).</li> </ul> </li> <li> <p>Visibility and limits</p> </li> <li>The current get_history(limit=1000) means you cannot delete items older than the fetched window via \u201cfiltered rows as selection\u201d.</li> <li>Add a control to increase limit (e.g., 1000/5000/All) or provide a separate \u201cDanger Zone: delete by time range (DB-side)\u201d that does not rely on the loaded df.</li> </ul> <p>Safety and UX - Always show counts and a preview of what will be deleted. - Require explicit confirmation text to proceed. - Keep a log in the app (success/fail counts, file errors). - Do not auto-delete blobs in S3 by default; present as an advanced option. - Consider a dry-run mode (show counts only) before the actual deletion.</p> <p>Test plan - Unit-test delete_by_keys with:   - Empty key list, non-existent keys, mixed existing keys. - UI manual selection:   - Select single/multiple; delete; verify count decreases; refresh works. - Time filter selection:   - Filter to a narrow window; \u201cUse filtered rows as selection\u201d; delete; verify. - Blob deletion:   - Local files present/missing; ensure DB deletion proceeds depending on the chosen option and errors are reported, not crash. - Large selection:   - Ensure chunked IN clauses or use temporary table to avoid parameter limits.</p> <p>Open questions - Do you want DB-side delete_by_time_range now (for deletions beyond the loaded limit), or should we first implement key-based deletion only? - Should we support S3 blob deletion in the first iteration?</p> <p>If you want, I can draft the code changes next: first for db.delete_by_keys/get_records and then the dashboard UI (multi-row selection, time filter, confirmation modal, and deletion flow).</p>"},{"location":"guides/caching/","title":"Caching Strategies","text":"<p><code>beautyspot</code> \u306e\u5f37\u529b\u306a\u6a5f\u80fd\u306e\u4e00\u3064\u306f\u3001\u95a2\u6570\u306e\u5f15\u6570\u306b\u57fa\u3065\u3044\u3066\u67d4\u8edf\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u3092\u751f\u6210\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3059\u3079\u3066\u306e\u5f15\u6570\u3092\u5b89\u5168\u306b\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u307e\u3059\u304c\u3001\u5b9f\u4e16\u754c\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u5408\u308f\u305b\u3066\u3001\u3088\u308a\u5ba3\u8a00\u7684\u304b\u3064\u9ad8\u5ea6\u306a\u5236\u5fa1\u304c\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"guides/caching/#_1","title":"\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6319\u52d5","text":"<p><code>Spot.mark</code> \u3067\u30c7\u30b3\u30ec\u30fc\u30c8\u3055\u308c\u305f\u95a2\u6570\u306f\u3001\u5f15\u6570 (<code>args</code>, <code>kwargs</code>) \u306e\u5185\u5bb9\u304c\u5c11\u3057\u3067\u3082\u5909\u308f\u308b\u3068\u300c\u5225\u306e\u30bf\u30b9\u30af\u300d\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002 <code>beautyspot</code> \u306f\u5f15\u6570\u306e\u69cb\u9020\uff08\u8f9e\u66f8\u3001\u30ea\u30b9\u30c8\u3001Numpy\u914d\u5217\u3001Pydantic\u30e2\u30c7\u30eb\u306a\u3069\uff09\u3092\u518d\u5e30\u7684\u306b \u6b63\u898f\u5316 (Canonicalize) \u3057\u3001\u9806\u5e8f\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5b89\u5b9a\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u3092\u751f\u6210\u3057\u307e\u3059\u3002</p> <pre><code>@spot.mark\ndef process(data):\n    # data \u306e\u5185\u5bb9\uff08dict\u306e\u9806\u5e8f\u306a\u3069\u304c\u9055\u3063\u3066\u3082\u4e2d\u8eab\u304c\u540c\u3058\u306a\u3089\uff09\u306b\u57fa\u3065\u3044\u3066\n    # \u540c\u4e00\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n    ...\n</code></pre>"},{"location":"guides/caching/#keygen-policy","title":"\u9ad8\u5ea6\u306a\u5236\u5fa1: KeyGen Policy","text":"<p>v2.0 \u4ee5\u964d\u3001<code>KeyGen</code> \u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3057\u3066\u3001\u5f15\u6570\u3054\u3068\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u6226\u7565\u3092\u5ba3\u8a00\u7684\u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002</p>"},{"location":"guides/caching/#1-keygenignore","title":"1. \u7279\u5b9a\u306e\u5f15\u6570\u3092\u7121\u8996\u3059\u308b (<code>KeyGen.ignore</code>)","text":"<p>\u30ed\u30b0\u51fa\u529b\u30d5\u30e9\u30b0\u3001\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3001\u3042\u308b\u3044\u306f\u30ed\u30ac\u30fc\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u3069\u3001\u8a08\u7b97\u7d50\u679c\uff08\uff1d\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u3079\u304d\u5024\uff09\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u306a\u3044\u5f15\u6570 \u306f\u3001\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u304b\u3089\u9664\u5916\u3059\u3079\u304d\u3067\u3059\u3002\u3053\u308c\u3089\u304c\u5909\u308f\u308b\u305f\u3073\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30df\u30b9\u304c\u767a\u751f\u3059\u308b\u306e\u3092\u9632\u304e\u307e\u3059\u3002</p> <pre><code>from beautyspot.cachekey import KeyGen\n\n# verbose \u3084 logger \u304c\u5909\u308f\u3063\u3066\u3082\u3001data \u304c\u540c\u3058\u306a\u3089\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u30d2\u30c3\u30c8\u3057\u307e\u3059\n@spot.mark(input_key_fn=KeyGen.ignore(\"verbose\", \"logger\"))\ndef heavy_task(data, verbose=False, logger=None):\n    if verbose:\n        print(\"Processing...\")\n    return data * 2\n</code></pre>"},{"location":"guides/caching/#2","title":"2. \u30d5\u30a1\u30a4\u30eb\u30d9\u30fc\u30b9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5","text":"<p>\u5f15\u6570\u3068\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u53d7\u3051\u53d6\u308b\u5834\u5408\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u300c\u30d1\u30b9\u306e\u6587\u5b57\u5217\u300d\u3060\u3051\u304c\u30cf\u30c3\u30b7\u30e5\u5316\u3055\u308c\u307e\u3059\u3002 \u30d5\u30a1\u30a4\u30eb\u540d\u304c\u540c\u3058\u3067\u3082\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u300d\u304c\u5909\u308f\u3063\u305f\u6642\u306b\u518d\u8a08\u7b97\u3055\u305b\u305f\u3044\uff08\u3042\u308b\u3044\u306f\u305d\u306e\u9006\uff09\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u6226\u7565\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> \u6226\u7565 \u30e1\u30bd\u30c3\u30c9 \u8aac\u660e \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9 Strict <code>KeyGen.file_content</code> \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u3092\u5168\u8aad\u307f\u8fbc\u307f\u3057\u3066\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u307e\u3059\u3002 \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3001\u5c0f\u3055\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 Fast <code>KeyGen.path_stat</code> \u30b5\u30a4\u30ba\u3068\u66f4\u65b0\u65e5\u6642(mtime)\u306e\u307f\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u9ad8\u901f\u3067\u3059\u3002 \u5de8\u5927\u306a\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3001\u6620\u50cf\u30c7\u30fc\u30bf"},{"location":"guides/caching/#3-keygenmap","title":"3. \u6226\u7565\u306e\u7d44\u307f\u5408\u308f\u305b (<code>KeyGen.map</code>)","text":"<p><code>KeyGen.map</code> \u3092\u4f7f\u3046\u3068\u3001\u5f15\u6570\u3054\u3068\u306b\u7570\u306a\u308b\u6226\u7565\u3092\u8a73\u7d30\u306b\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u304c\u6700\u3082\u67d4\u8edf\u306a\u65b9\u6cd5\u3067\u3059\u3002</p> <pre><code>@spot.mark(input_key_fn=KeyGen.map(\n    # data_path \u306f\u30e1\u30bf\u30c7\u30fc\u30bf(\u30b5\u30a4\u30ba+\u65e5\u4ed8)\u3067\u30c1\u30a7\u30c3\u30af\uff08\u9ad8\u901f\u5316\uff09\n    data_path=KeyGen.PATH_STAT,\n\n    # config_path \u306f\u4e2d\u8eab\u3092\u53b3\u5bc6\u306b\u30c1\u30a7\u30c3\u30af\uff08\u78ba\u5b9f\u6027\uff09\n    config_path=KeyGen.FILE_CONTENT,\n\n    # debug_mode \u306f\u8a08\u7b97\u7d50\u679c\u306b\u95a2\u4fc2\u306a\u3044\u306e\u3067\u7121\u8996\n    debug_mode=KeyGen.IGNORE\n))\ndef analyze(data_path, config_path, debug_mode=False):\n    # ... \u91cd\u3044\u5206\u6790\u51e6\u7406 ...\n    pass\n</code></pre> <p>Note</p> <p><code>KeyGen</code> \u30dd\u30ea\u30b7\u30fc\u306f\u3001\u95a2\u6570\u304c\u3069\u306e\u3088\u3046\u306b\u547c\u3073\u51fa\u3055\u308c\u305f\u304b\uff08\u4f4d\u7f6e\u5f15\u6570\u304b\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570\u304b\uff09\u306b\u95a2\u308f\u3089\u305a\u3001\u5f15\u6570\u540d\u306b\u57fa\u3065\u3044\u3066\u6b63\u3057\u304f\u9069\u7528\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"guides/caching/#advanced","title":"\u30ab\u30b9\u30bf\u30e0\u30ad\u30fc\u751f\u6210\uff08Advanced\uff09","text":"<p>\u4e0a\u8a18\u306e\u30dd\u30ea\u30b7\u30fc\u3067\u30ab\u30d0\u30fc\u3067\u304d\u306a\u3044\u7279\u6b8a\u306a\u30b1\u30fc\u30b9\u3067\u306f\u3001\u72ec\u81ea\u306e\u95a2\u6570\u3092 <code>input_key_fn</code> \u306b\u6e21\u3059\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002</p> <pre><code>def custom_key_generator(*args, **kwargs):\n    # \u72ec\u81ea\u306e\u30ed\u30b8\u30c3\u30af\u3067\u6587\u5b57\u5217\u3092\u8fd4\u3059\n    return f\"custom-{args[0].id}\"\n\n@spot.mark(input_key_fn=custom_key_generator)\ndef my_func(obj):\n    ...\n</code></pre>"},{"location":"guides/cli/","title":"CLI &amp; Dashboard Guide","text":"<p><code>beautyspot</code> \u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e\u95b2\u89a7\u3084\u3001\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"guides/cli/#dashboard-ui","title":"Dashboard (UI)","text":"<p>\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u30bf\u30b9\u30af\u306e\u5b9f\u884c\u5c65\u6b74\u3001\u7d50\u679c\u3001\u4f9d\u5b58\u95a2\u4fc2\u306a\u3069\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u8996\u899a\u7684\u306b\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"guides/cli/#basic-usage","title":"Basic Usage","text":"<pre><code>beautyspot ui &lt;path_to_db&gt;\n</code></pre> <ul> <li><code>&lt;path_to_db&gt;</code>: Spot\u3092\u4f5c\u6210\u3057\u305f\u969b\u306b\u6307\u5b9a\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f <code>.beautyspot/project_name.db</code> \u306a\u3069\uff09\u3002</li> </ul>"},{"location":"guides/cli/#features","title":"Features","text":"<ul> <li>Task History: \u5b9f\u884c\u3055\u308c\u305f\u95a2\u6570\u306e\u5c65\u6b74\u3092\u6642\u7cfb\u5217\u3067\u8868\u793a\u3057\u307e\u3059\u3002</li> <li>Result Viewer: \u623b\u308a\u5024\u3092\u305d\u306e <code>content_type</code> \u306b\u5fdc\u3058\u3066\uff08JSON, \u753b\u50cf, Markdown, Mermaid\u56f3\u306a\u3069\uff09\u9069\u5207\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002</li> <li>Filtering: \u95a2\u6570\u540d\u3084Result Type\u3067\u5c65\u6b74\u3092\u7d5e\u308a\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</li> </ul>"},{"location":"guides/cli/#maintenance-tools","title":"Maintenance Tools","text":"<p>\u9577\u671f\u9593 <code>beautyspot</code> \u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3068\u3001\u4e0d\u8981\u306b\u306a\u3063\u305fBlob\u30d5\u30a1\u30a4\u30eb\uff08\u753b\u50cf\u3084\u5de8\u5927\u306a\u30c7\u30fc\u30bf\uff09\u304c\u30c7\u30a3\u30b9\u30af\u306b\u6b8b\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002 \u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u3092\u89e3\u653e\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"guides/cli/#clean-garbage-collection","title":"<code>clean</code> (Garbage Collection)","text":"<p>\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e0a\u306b\u8a18\u9332\u304c\u5b58\u5728\u3057\u306a\u3044\u300c\u5b64\u7acb\u3057\u305fBlob\u30d5\u30a1\u30a4\u30eb\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u3002 \u958b\u767a\u4e2d\u306bDB\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3057\u305f\u304c\u3001<code>blobs/</code> \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u6b8b\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u306a\u3069\u306b\u6709\u52b9\u3067\u3059\u3002</p> <pre><code># Dry-run (\u524a\u9664\u5bfe\u8c61\u3092\u8868\u793a\u3059\u308b\u3060\u3051)\nbeautyspot clean --storage-path .beautyspot/blobs --db-path .beautyspot/my_spot.db --dry-run\n\n# Execute (\u5b9f\u969b\u306b\u524a\u9664)\nbeautyspot clean --storage-path .beautyspot/blobs --db-path .beautyspot/my_spot.db\n</code></pre>"},{"location":"guides/cli/#prune-delete-old-tasks","title":"<code>prune</code> (Delete Old Tasks)","text":"<p>\u6307\u5b9a\u3057\u305f\u671f\u9593\u3088\u308a\u53e4\u3044\u30bf\u30b9\u30af\u30c7\u30fc\u30bf\u3092\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068Blob\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u4e21\u65b9\u304b\u3089\u524a\u9664\u3057\u307e\u3059\u3002</p> <pre><code># 30\u65e5\u4ee5\u4e0a\u524d\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664 (Dry-run)\nbeautyspot prune --days 30 --db-path .beautyspot/my_spot.db --dry-run\n\n# \u5b9f\u884c (\u78ba\u8a8d\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059)\nbeautyspot prune --days 30 --db-path .beautyspot/my_spot.db\n</code></pre> <p>\u6ce8\u610f</p> <p><code>prune</code> \u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30ec\u30b3\u30fc\u30c9\u3082\u524a\u9664\u3059\u308b\u305f\u3081\u3001\u4e00\u5ea6\u524a\u9664\u3059\u308b\u3068\u5fa9\u5143\u3067\u304d\u307e\u305b\u3093\u3002 \u672c\u756a\u74b0\u5883\u306e\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3059\u308b\u5834\u5408\u306f\u5341\u5206\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"guides/custom_backend/","title":"\ud83d\udee0\ufe0f Custom Database Backend Guide","text":"<p><code>beautyspot</code> \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 SQLite \u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001\u5927\u898f\u6a21\u306a\u5206\u6563\u51e6\u7406\u3084\u3001\u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\u306a\u74b0\u5883\uff08Kubernetes\u306a\u3069\uff09\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u3001PostgreSQL \u3084 MySQL\u3001\u3042\u308b\u3044\u306f DynamoDB \u3068\u3044\u3063\u305f\u5916\u90e8\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u5229\u7528\u3057\u305f\u304f\u306a\u308b\u3067\u3057\u3087\u3046\u3002</p> <p>v1.0.0 \u304b\u3089\u5c0e\u5165\u3055\u308c\u305f Dependency Injection (DI) \u6a5f\u69cb\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306a\u304f\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u81ea\u7531\u306b\u5dee\u3057\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"guides/custom_backend/#1-the-interface-taskdb","title":"1. The Interface: <code>TaskDB</code>","text":"<p>\u30ab\u30b9\u30bf\u30e0\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001<code>beautyspot.db.TaskDB</code> \u62bd\u8c61\u57fa\u5e95\u30af\u30e9\u30b9\uff08Abstract Base Class\uff09\u3092\u7d99\u627f\u3057\u3001\u4ee5\u4e0b\u306e4\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>               Bases: <code>ABC</code></p> <p>Abstract interface for task metadata storage. Implement this class to support other databases (e.g., PostgreSQL, DuckDB).</p> Source code in <code>src/beautyspot/db.py</code> <pre><code>class TaskDB(ABC):\n    \"\"\"\n    Abstract interface for task metadata storage.\n    Implement this class to support other databases (e.g., PostgreSQL, DuckDB).\n    \"\"\"\n\n    @abstractmethod\n    def init_schema(self):\n        \"\"\"Initialize database schema (create tables, migrations).\"\"\"\n        pass\n\n    @abstractmethod\n    def get(self, cache_key: str) -&gt; Optional[Dict[str, Any]]:\n        \"\"\"Retrieve a task result by cache key.\"\"\"\n        pass\n\n    @abstractmethod\n    def save(\n        self,\n        cache_key: str,\n        func_name: str,\n        input_id: str,\n        version: Optional[str],\n        result_type: str,\n        content_type: Optional[str],\n        result_value: Optional[str] = None,\n        result_data: Optional[bytes] = None,\n    ):\n        \"\"\"\n        Upsert a task result.\n\n        Args:\n            cache_key: Unique hash key.\n            func_name: Function name.\n            input_id: Input identifier.\n            version: Task version.\n            result_type: 'DIRECT_BLOB' or 'FILE'.\n            content_type: MIME type of the result (e.g. 'image/png').\n            result_value: Path/URI string (Only used when result_type='FILE').\n            result_data: Serialized binary data (Only used when result_type='DIRECT_BLOB').\n        \"\"\"\n        pass\n\n    @abstractmethod\n    def get_history(self, limit: int = 1000) -&gt; \"pd.DataFrame\":\n        \"\"\"Fetch task history for analysis/dashboard.\"\"\"\n        pass\n</code></pre>"},{"location":"guides/custom_backend/#beautyspot.db.TaskDB.get","title":"<code>get(cache_key)</code>  <code>abstractmethod</code>","text":"<p>Retrieve a task result by cache key.</p> Source code in <code>src/beautyspot/db.py</code> <pre><code>@abstractmethod\ndef get(self, cache_key: str) -&gt; Optional[Dict[str, Any]]:\n    \"\"\"Retrieve a task result by cache key.\"\"\"\n    pass\n</code></pre>"},{"location":"guides/custom_backend/#beautyspot.db.TaskDB.get_history","title":"<code>get_history(limit=1000)</code>  <code>abstractmethod</code>","text":"<p>Fetch task history for analysis/dashboard.</p> Source code in <code>src/beautyspot/db.py</code> <pre><code>@abstractmethod\ndef get_history(self, limit: int = 1000) -&gt; \"pd.DataFrame\":\n    \"\"\"Fetch task history for analysis/dashboard.\"\"\"\n    pass\n</code></pre>"},{"location":"guides/custom_backend/#beautyspot.db.TaskDB.init_schema","title":"<code>init_schema()</code>  <code>abstractmethod</code>","text":"<p>Initialize database schema (create tables, migrations).</p> Source code in <code>src/beautyspot/db.py</code> <pre><code>@abstractmethod\ndef init_schema(self):\n    \"\"\"Initialize database schema (create tables, migrations).\"\"\"\n    pass\n</code></pre>"},{"location":"guides/custom_backend/#beautyspot.db.TaskDB.save","title":"<code>save(cache_key, func_name, input_id, version, result_type, content_type, result_value=None, result_data=None)</code>  <code>abstractmethod</code>","text":"<p>Upsert a task result.</p> <p>Parameters:</p> Name Type Description Default <code>cache_key</code> <code>str</code> <p>Unique hash key.</p> required <code>func_name</code> <code>str</code> <p>Function name.</p> required <code>input_id</code> <code>str</code> <p>Input identifier.</p> required <code>version</code> <code>Optional[str]</code> <p>Task version.</p> required <code>result_type</code> <code>str</code> <p>'DIRECT_BLOB' or 'FILE'.</p> required <code>content_type</code> <code>Optional[str]</code> <p>MIME type of the result (e.g. 'image/png').</p> required <code>result_value</code> <code>Optional[str]</code> <p>Path/URI string (Only used when result_type='FILE').</p> <code>None</code> <code>result_data</code> <code>Optional[bytes]</code> <p>Serialized binary data (Only used when result_type='DIRECT_BLOB').</p> <code>None</code> Source code in <code>src/beautyspot/db.py</code> <pre><code>@abstractmethod\ndef save(\n    self,\n    cache_key: str,\n    func_name: str,\n    input_id: str,\n    version: Optional[str],\n    result_type: str,\n    content_type: Optional[str],\n    result_value: Optional[str] = None,\n    result_data: Optional[bytes] = None,\n):\n    \"\"\"\n    Upsert a task result.\n\n    Args:\n        cache_key: Unique hash key.\n        func_name: Function name.\n        input_id: Input identifier.\n        version: Task version.\n        result_type: 'DIRECT_BLOB' or 'FILE'.\n        content_type: MIME type of the result (e.g. 'image/png').\n        result_value: Path/URI string (Only used when result_type='FILE').\n        result_data: Serialized binary data (Only used when result_type='DIRECT_BLOB').\n    \"\"\"\n    pass\n</code></pre>"},{"location":"guides/custom_backend/#contract","title":"\u5b9f\u88c5\u306e\u8981\u4ef6 (Contract)","text":"<ul> <li>Thread Safety: <code>Spot</code> \u306f\u30de\u30eb\u30c1\u30b9\u30ec\u30c3\u30c9\u3067\u52d5\u4f5c\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u306f\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>Schema Initialization: <code>init_schema()</code> \u306f <code>Spot</code> \u521d\u671f\u5316\u6642\u306b\u6bce\u56de\u547c\u3070\u308c\u307e\u3059\u3002\u300c\u30c6\u30fc\u30d6\u30eb\u304c\u306a\u3051\u308c\u3070\u4f5c\u6210\u3059\u308b\uff08IF NOT EXISTS\uff09\u300d\u3088\u3046\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\u3002</li> <li>Idempotency: <code>save()</code> \u306f\u540c\u3058\u30ad\u30fc\u3067\u4f55\u5ea6\u3082\u547c\u3070\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002<code>INSERT OR REPLACE</code> (Upsert) \u306e\u6319\u52d5\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\u3002</li> </ul>"},{"location":"guides/custom_backend/#2-implementation-example","title":"2. Implementation Example","text":"<p>\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u3001\u958b\u767a\u3084\u30c6\u30b9\u30c8\u306b\u4fbf\u5229\u306a\u300c\u30a4\u30f3\u30e1\u30e2\u30ea\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff08\u8f9e\u66f8\u30d9\u30fc\u30b9\uff09\u300d\u306e\u5b9f\u88c5\u3092\u793a\u3057\u307e\u3059\u3002 \u672c\u756a\u74b0\u5883\u3067 PostgreSQL \u7b49\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3082\u3001\u57fa\u672c\u7684\u306a\u69cb\u9020\u306f\u540c\u3058\u3067\u3059\u3002</p> <pre><code>from typing import Any, Dict, Optional\nimport pandas as pd\nfrom beautyspot.db import TaskDB\n\nclass MemoryTaskDB(TaskDB):\n    \"\"\"\n    \u30aa\u30f3\u30e1\u30e2\u30ea\u3067\u52d5\u4f5c\u3059\u308b\u63ee\u767a\u6027\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3002\n    \u30c6\u30b9\u30c8\u3084\u3001\u6c38\u7d9a\u5316\u304c\u4e0d\u8981\u306a\u4e00\u6642\u7684\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u6700\u9069\u3067\u3059\u3002\n    \"\"\"\n    def __init__(self):\n        self._storage: Dict[str, Dict[str, Any]] = {}\n\n    def init_schema(self):\n        # \u30e1\u30e2\u30ea\u4e0a\u306e\u8f9e\u66f8\u306a\u306e\u3067\u30b9\u30ad\u30fc\u30de\u4f5c\u6210\u306f\u4e0d\u8981\n        pass\n\n    def get(self, cache_key: str) -&gt; Optional[Dict[str, Any]]:\n        return self._storage.get(cache_key)\n\n    def save(\n        self, \n        cache_key: str, \n        func_name: str, \n        input_id: str, \n        version: Optional[str], \n        result_type: str, \n        content_type: Optional[str], \n        result_value: str\n    ):\n        # \u8f9e\u66f8\u306b\u4fdd\u5b58\uff08Upsert\uff09\n        self._storage[cache_key] = {\n            \"func_name\": func_name,\n            \"input_id\": input_id,\n            \"version\": version,\n            \"result_type\": result_type,\n            \"content_type\": content_type,\n            \"result_value\": result_value,\n            \"updated_at\": pd.Timestamp.now() # \u5c65\u6b74\u7528\n        }\n\n    def get_history(self, limit: int = 1000) -&gt; pd.DataFrame:\n        if not self._storage:\n            return pd.DataFrame()\n\n        # \u8f9e\u66f8\u304b\u3089DataFrame\u3092\u4f5c\u6210\n        df = pd.DataFrame(list(self._storage.values()))\n        df[\"cache_key\"] = list(self._storage.keys())\n        return df.sort_values(\"updated_at\", ascending=False).head(limit)\n</code></pre>"},{"location":"guides/custom_backend/#3-injection-how-to-use","title":"3. Injection (How to use)","text":"<p>\u4f5c\u6210\u3057\u305f\u30ab\u30b9\u30bf\u30e0\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u3001<code>Spot</code> \u306e <code>db</code> \u5f15\u6570\u306b\u6e21\u3059\u3060\u3051\u3067\u3059\u3002</p> <pre><code>import beautyspot as bs\n\n# 1. \u30ab\u30b9\u30bf\u30e0DB\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\nmy_memory_db = MemoryTaskDB()\n\n# 2. Spot\u306b\u6ce8\u5165 (\u30d1\u30b9\u6587\u5b57\u5217\u3067\u306f\u306a\u304f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6e21\u3059)\nspot = bs.Spot(\"memory_app\", db=my_memory_db)\n\n@spot.mark\ndef calc(x):\n    return x * 2\n\n# \u3053\u306e\u7d50\u679c\u306f SQLite \u30d5\u30a1\u30a4\u30eb\u3067\u306f\u306a\u304f\u3001\u30e1\u30e2\u30ea\u4e0a\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\nprint(calc(10)) \n</code></pre>"},{"location":"guides/custom_backend/#4-advanced-using-postgresql-mysql","title":"4. Advanced: Using PostgreSQL / MySQL","text":"<p>RDBMS \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001<code>sqlalchemy</code> \u3084 <code>psycopg2</code> \u3092\u4f7f\u7528\u3057\u3066 <code>TaskDB</code> \u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002 <code>src/beautyspot/db.py</code> \u5185\u306e <code>SQLiteTaskDB</code> \u306e\u5b9f\u88c5\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u7279\u306b\u4ee5\u4e0b\u306e\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\uff1a</p> <ul> <li>\u63a5\u7d9a\u7ba1\u7406: <code>save</code> \u3084 <code>get</code> \u306e\u305f\u3073\u306b\u63a5\u7d9a\u3092\u958b\u304f\u304b\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308b\u304b\u3092\u9069\u5207\u306b\u8a2d\u8a08\u3057\u3066\u304f\u3060\u3055\u3044\u3002</li> <li>JSON\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba: <code>beautyspot</code> \u306f\u7d50\u679c\u3092 JSON \u6587\u5b57\u5217\u3068\u3057\u3066\u6e21\u3057\u307e\u3059\u3002DB\u5074\u306b\u306f <code>TEXT</code> \u578b\u307e\u305f\u306f <code>JSONB</code> \u578b\u306e\u30ab\u30e9\u30e0\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002</li> </ul>"},{"location":"guides/rete_limiting/","title":"Rete limiting","text":""},{"location":"guides/rete_limiting/#rate-limiting-gcra","title":"Rate Limiting (GCRA)","text":"<p><code>beautyspot</code> \u306f\u3001API\u306e\u30ec\u30fc\u30c8\u5236\u9650\uff08Rate Limit\uff09\u3092\u9075\u5b88\u3059\u308b\u305f\u3081\u306e\u9ad8\u6027\u80fd\u306a\u30ea\u30df\u30c3\u30bf\u30fc\u3092\u5185\u8535\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u5358\u7d14\u306a time.sleep \u3068\u306f\u7570\u306a\u308a\u3001GCRA (Generic Cell Rate Algorithm) \u3092\u63a1\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30d0\u30fc\u30b9\u30c8\uff08\u4e00\u6642\u7684\u306a\u96c6\u4e2d\u30a2\u30af\u30bb\u30b9\uff09\u3092\u8a31\u5bb9\u3057\u3064\u3064\u3001\u9577\u671f\u7684\u306b\u306f\u6307\u5b9a\u3055\u308c\u305f\u30ec\u30fc\u30c8\u3092\u5b88\u308b\u3068\u3044\u3046\u3001\u6ed1\u3089\u304b\u306a\u5236\u5fa1\u304c\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"guides/rete_limiting/#_1","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":""},{"location":"guides/rete_limiting/#1-spot","title":"1. Spot \u3067\u30ec\u30fc\u30c8\u3092\u5b9a\u7fa9\u3059\u308b","text":"<p>Spot \u306e\u521d\u671f\u5316\u6642\u306b tpm (Tokens Per Minute) \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \u3053\u308c\u304c\u300c1\u5206\u9593\u306b\u8a31\u53ef\u3055\u308c\u308b\u6700\u5927\u30b3\u30b9\u30c8\u300d\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code># 1\u5206\u9593\u306b 60 \u30c8\u30fc\u30af\u30f3\u307e\u3067\u8a31\u53ef\uff08\u2252 1\u79d2\u306b1\u56de\uff09\nspot = bs.Spot(\"api_client\", tpm=60)\n</code></pre>"},{"location":"guides/rete_limiting/#2","title":"2. \u95a2\u6570\u306b\u30b3\u30b9\u30c8\u3092\u8a2d\u5b9a\u3059\u308b","text":"<p><code>@spot.limiter</code>  \u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u305d\u306e\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u306e\u306b\u5fc5\u8981\u306a\u300c\u30b3\u30b9\u30c8\uff08\u30c8\u30fc\u30af\u30f3\u6d88\u8cbb\u91cf\uff09\u300d\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>@spot.mark\n@spot.limiter(cost=1)  # 1\u56de\u306e\u5b9f\u884c\u30671\u30c8\u30fc\u30af\u30f3\u6d88\u8cbb\ndef call_api_endpoint_a():\n    ...\n\n@spot.mark\n@spot.limiter(cost=5)  # \u91cd\u3044\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f5\u30c8\u30fc\u30af\u30f3\u6d88\u8cbb\ndef call_heavy_endpoint():\n    ...\n</code></pre> <p>\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001 <code>call_api_endpoint_a</code> \u306a\u3089\u6bce\u520660\u56de\u5b9f\u884c\u3067\u304d\u307e\u3059\u304c\u3001 <code>call_heavy_endpoint</code> \u306f\u6bce\u520612\u56de\u3057\u304b\u5b9f\u884c\u3067\u304d\u307e\u305b\u3093\u3002</p> <p>\u5236\u9650\u3092\u8d85\u3048\u305f\u5834\u5408\u3001\u95a2\u6570\u306f\u81ea\u52d5\u7684\u306b\u30b9\u30ea\u30fc\u30d7\uff08\u30d6\u30ed\u30c3\u30af\uff09\u3057\u3066\u3001\u30c8\u30fc\u30af\u30f3\u304c\u88dc\u5145\u3055\u308c\u308b\u306e\u3092\u5f85\u3061\u307e\u3059\u3002</p>"},{"location":"guides/rete_limiting/#_2","title":"\u52d5\u7684\u306a\u30b3\u30b9\u30c8\u8a2d\u5b9a","text":"<p>\u5f15\u6570\u306b\u5fdc\u3058\u3066\u6d88\u8cbb\u30b3\u30b9\u30c8\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u3001cost \u5f15\u6570\u306b\u95a2\u6570\u3092\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>def calculate_cost(text_list):\n    # \u30c6\u30ad\u30b9\u30c81\u3064\u306b\u3064\u304d1\u30b3\u30b9\u30c8\u6d88\u8cbb\n    return len(text_list)\n\n@spot.mark\n@spot.limiter(cost=calculate_cost)\ndef batch_process(text_list):\n    ...\n</code></pre>"},{"location":"guides/rete_limiting/#async","title":"\u975e\u540c\u671f\u51e6\u7406 (Async)","text":"<p><code>async</code> \u95a2\u6570\u306b\u5bfe\u3057\u3066\u3082\u3001\u540c\u69d8\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u5834\u5408\u3001\u30b9\u30ec\u30c3\u30c9\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u975e\u540c\u671f\u306b <code>await asyncio.sleep(...)</code> \u3057\u307e\u3059\u3002</p> <pre><code>@spot.mark\n@spot.limiter(cost=1)\nasync def fetch_data():\n    # \u30ec\u30fc\u30c8\u5236\u9650\u306b\u304b\u304b\u3063\u305f\u5834\u5408\u3001\u3053\u3053\u3067\u975e\u540c\u671f\u306b\u5f85\u6a5f\u3057\u307e\u3059\n    await client.get(...)\n</code></pre>"},{"location":"guides/rete_limiting/#gcra","title":"\u7406\u8ad6\u7684\u80cc\u666f: GCRA","text":"<p><code>beautyspot</code> \u306e\u30ea\u30df\u30c3\u30bf\u30fc\u306f\u300c\u30ea\u30fc\u30ad\u30fc\u30d0\u30b1\u30c4\uff08Leaky Bucket\uff09\u300d\u306e\u4e00\u7a2e\u3067\u3042\u308b GCRA \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002</p> <ul> <li>\u30e1\u30e2\u30ea\u52b9\u7387: \u30ab\u30a6\u30f3\u30bf\u3092\u4fdd\u6301\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u3001\u5230\u7740\u4e88\u5b9a\u6642\u523b\uff08TAT\uff09\u3068\u3044\u3046\u5358\u4e00\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u307f\u3067\u7ba1\u7406\u3059\u308b\u305f\u3081\u975e\u5e38\u306b\u8efd\u91cf\u3067\u3059\u3002</li> <li>\u516c\u5e73\u6027: \u5168\u3066\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u516c\u5e73\u306b\u9045\u5ef6\u3092\u5206\u914d\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"guides/serialization/","title":"Data Serialization &amp; Registry","text":"<p><code>beautyspot</code> \u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u306e\u5909\u63db\u51e6\u7406\u306b\u306f\u3001\u660e\u78ba\u306b\u7570\u306a\u308b2\u3064\u306e\u5f79\u5272\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3092\u6df7\u540c\u3057\u306a\u3044\u3053\u3068\u304c\u3001\u6b63\u3057\u304f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3044\u3053\u306a\u3059\u30b3\u30c4\u3067\u3059\u3002</p> <ol> <li>Cache Key Generation (Input): \u95a2\u6570\u306e\u300c\u5f15\u6570\u300d\u3092\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306e ID (Key) \u3092\u6c7a\u3081\u308b\u3002</li> <li>Result Serialization (Output): \u95a2\u6570\u306e\u300c\u623b\u308a\u5024\u300d\u3092\u30d0\u30a4\u30ca\u30ea\u5316\u3057\u3001DB\u3084\u30b9\u30c8\u30ec\u30fc\u30b8\u306b \u4fdd\u5b58 (Persist) \u3059\u308b\u3002</li> </ol> <p>\u3053\u306e\u30da\u30fc\u30b8\u3067\u306f\u3001\u5f8c\u8005\u306e\u300c\u623b\u308a\u5024\u306e\u4fdd\u5b58\u300d\u306b\u3064\u3044\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002</p>"},{"location":"guides/serialization/#input-vs-output","title":"Input vs Output \u306e\u9055\u3044","text":"\u6a5f\u80fd \u5bfe\u8c61 \u5f79\u5272 \u8a2d\u5b9a\u65b9\u6cd5 KeyGen \u5f15\u6570 (Inputs) \u300c\u524d\u56de\u3068\u540c\u3058\u5165\u529b\u304b\uff1f\u300d\u3092\u5224\u5b9a\u3059\u308b <code>input_key_fn=...</code>  (\u30ed\u30fc\u30ab\u30eb\u8a2d\u5b9a) Registry \u623b\u308a\u5024 (Outputs) \u30c7\u30fc\u30bf\u3092\u30c7\u30a3\u30b9\u30af\u306b\u4fdd\u5b58\u30fb\u5fa9\u5143\u3059\u308b <code>spot.register(...)</code>  (\u30b0\u30ed\u30fc\u30d0\u30eb\u8a2d\u5b9a) <pre><code>graph LR\n    subgraph \"Input Flow (KeyGen)\"\n    A[Arguments] --&gt; B{Canonicalize}\n    B --&gt; C[SHA-256 Hash]\n    C --&gt; D[Cache Key]\n    end\n\n    subgraph \"Output Flow (Registry)\"\n    E[Return Value] --&gt; F{Serializer}\n    F --&gt; G[Msgpack Bytes]\n    G --&gt; H[Storage / DB]\n    end\n</code></pre>"},{"location":"guides/serialization/#msgpack","title":"\u6a19\u6e96\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba (Msgpack)","text":"<p><code>beautyspot</code> \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 Msgpack \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u578b\u306f\u8a2d\u5b9a\u306a\u3057\u3067\u4fdd\u5b58\u30fb\u5fa9\u5143\u304c\u53ef\u80fd\u3067\u3059\u3002</p> <ul> <li>Python \u30d7\u30ea\u30df\u30c6\u30a3\u30d6 (<code>int</code>, <code>float</code>, <code>str</code>, <code>bool</code>, <code>bytes</code>, <code>None</code>)</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3 (<code>dict</code>, <code>list</code>, <code>tuple</code>)</li> </ul>"},{"location":"guides/serialization/#spotregister","title":"\u30ab\u30b9\u30bf\u30e0\u578b\u306e\u767b\u9332 (<code>spot.register</code>)","text":"<p>\u72ec\u81ea\u306e\u30af\u30e9\u30b9\u3084\u3001\u6a19\u6e96\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u578b\uff08\u4f8b: Pandas DataFrame, PyTorch Tensor\u306a\u3069\uff09\u3092\u95a2\u6570\u306e \u623b\u308a\u5024 \u3068\u3057\u3066\u8fd4\u3057\u305f\u3044\u5834\u5408\u3001<code>register</code> \u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u65b9\u6cd5\u3092\u6559\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"guides/serialization/#_1","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<p>\u30af\u30e9\u30b9\u5b9a\u7fa9\u306b\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u6dfb\u3048\u308b\u3060\u3051\u3067\u3059\u3002</p> <pre><code>import msgpack\n\n@spot.register(\n    code=10,  # 0-127 \u306e\u9593\u3067\u30e6\u30cb\u30fc\u30af\u306aID\u3092\u6307\u5b9a\n    encoder=lambda obj: obj.to_bytes(),        # Object -&gt; bytes\n    decoder=lambda data: MyClass.from_bytes(data) # bytes -&gt; Object\n)\nclass MyClass:\n    def __init__(self, x, y):\n        self.x = x\n        self.y = y\n\n    def to_bytes(self):\n        return msgpack.packb([self.x, self.y])\n\n    @staticmethod\n    def from_bytes(data):\n        x, y = msgpack.unpackb(data)\n        return MyClass(x, y)\n</code></pre>"},{"location":"guides/serialization/#_2","title":"\u65e2\u5b58\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u578b\u3092\u767b\u9332\u3059\u308b","text":"<p>\u81ea\u5206\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u306a\u3044\u30af\u30e9\u30b9\uff08\u4f8b: <code>numpy.ndarray</code>\uff09\u3092\u767b\u9332\u3059\u308b\u5834\u5408\u306f\u3001<code>spot.register_type</code> \u95a2\u6570\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>import numpy as np\nimport io\n\ndef encode_numpy(arr):\n    # \u30e1\u30e2\u30ea\u4e0a\u306e\u30d0\u30a4\u30ca\u30ea\u3068\u3057\u3066\u66f8\u304d\u51fa\u3057\n    with io.BytesIO() as f:\n        np.save(f, arr)\n        return f.getvalue()\n\ndef decode_numpy(data):\n    with io.BytesIO(data) as f:\n        return np.load(f)\n\n# \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8d77\u52d5\u6642\u306b\u767b\u9332\nspot.register_type(\n    type_=np.ndarray,\n    code=20,\n    encoder=encode_numpy,\n    decoder=decode_numpy\n)\n</code></pre>"},{"location":"guides/serialization/#_3","title":"\u3088\u304f\u3042\u308b\u9593\u9055\u3044","text":"<p>\u5f15\u6570\u306b\u30ab\u30b9\u30bf\u30e0\u578b\u3092\u6e21\u3059\u5834\u5408</p> <p>\u95a2\u6570\u306e \u5f15\u6570 \u3068\u3057\u3066\u30ab\u30b9\u30bf\u30e0\u578b\u3092\u6e21\u3059\u3060\u3051\u3067\u3042\u308c\u3070\u3001<code>register</code> \u306f \u4e0d\u8981 \u3067\u3059\u3002 <code>KeyGen</code> \u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5185\u90e8\u69cb\u9020\uff08<code>__dict__</code>\u306a\u3069\uff09\u3092\u81ea\u52d5\u7684\u306b\u691c\u67fb\u3057\u3066\u30cf\u30c3\u30b7\u30e5\u3092\u4f5c\u308b\u304b\u3089\u3067\u3059\u3002</p> <p><code>register</code> \u304c\u5fc5\u8981\u306a\u306e\u306f\u3001\u3042\u304f\u307e\u3067\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092 \u300c\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3057\u3066\u4fdd\u5b58\uff08\u6c38\u7d9a\u5316\uff09\u300d \u3057\u305f\u3044\u5834\u5408\u306e\u307f\u3067\u3059\u3002</p>"},{"location":"guides/usage_patterns/","title":"Usage Patterns","text":"<p><code>beautyspot</code> \u306f\u3001\u95a2\u6570\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u5316\u3092\u300c\u3044\u3064\u300d\u884c\u3044\u305f\u3044\u304b\u306b\u5fdc\u3058\u3066\u3001\u4e3b\u306b2\u3064\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p>"},{"location":"guides/usage_patterns/#1-definition-time-spotmark","title":"1. Definition Time (<code>@spot.mark</code>)","text":"<p>\u300c\u3053\u306e\u95a2\u6570\u306f\u5e38\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3079\u304d\u3067\u3042\u308b\u300d \u3068\u3044\u3046\u8a2d\u8a08\u306e\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002 \u4e3b\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30a2\u30ed\u30b8\u30c3\u30af\u3084\u3001\u30c7\u30fc\u30bf\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9a\u7fa9\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code>import beautyspot as bs\n\n# 1. Spot\uff08\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff09\u3092\u5b9a\u7fa9\nspot = bs.Spot(\"my_app\")\n\n# 2. \u95a2\u6570\u5b9a\u7fa9\u6642\u306b\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u4ed8\u4e0e\n@spot.mark\ndef heavy_analysis(data):\n    # ... \u91cd\u3044\u8a08\u7b97 ...\n    return result\n\n# 3. \u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd\u304c\u50cd\u304f\nresult = heavy_analysis(input_data)\n</code></pre>"},{"location":"guides/usage_patterns/#_1","title":"\u7279\u5fb4","text":"<ul> <li>Persistent: \u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u9593\u3001\u5e38\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u69cb\u304c\u6709\u52b9\u306b\u306a\u308a\u307e\u3059\u3002</li> <li>Simple: \u547c\u3073\u51fa\u3057\u5074\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u305b\u3093\u3002</li> </ul>"},{"location":"guides/usage_patterns/#2-execution-time-with-spotcached_run","title":"2. Execution Time (<code>with spot.cached_run</code>)","text":"<p>\u65e2\u5b58\u306e\u95a2\u6570\u3084\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u88fd\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u95a2\u6570\u3092\u3001\u7279\u5b9a\u306e\u30b9\u30b3\u30fc\u30d7\u5185\u3067\u306e\u307f\u30ad\u30e3\u30c3\u30b7\u30e5\u5316\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002 v2.0 \u304b\u3089\u63a8\u5968\u3055\u308c\u308b\u3001\u67d4\u8edf\u304b\u3064\u30e2\u30c0\u30f3\u306a\u5b9f\u884c\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p>"},{"location":"guides/usage_patterns/#single-function","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9 (Single Function)","text":"<p><code>with</code> \u30d6\u30ed\u30c3\u30af\u5185\u3067\u306e\u307f\u3001\u6e21\u3057\u305f\u95a2\u6570\u304c\u300c\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd\u4ed8\u304d\u300d\u306e\u30e9\u30c3\u30d1\u30fc\u306b\u7f6e\u304d\u63db\u308f\u308a\u307e\u3059\u3002</p> <pre><code>from external_lib import simulation\nimport beautyspot as bs\n\nspot = bs.Spot(\"experiment\")\n\n# \u5358\u4e00\u306e\u95a2\u6570\u3092\u6e21\u3059\u3068\u3001\u305d\u306e\u307e\u307e\u30e9\u30c3\u30d1\u30fc\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\n# version=\"v1\" \u306a\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u3053\u306e\u30d6\u30ed\u30c3\u30af\u5185\u3067\u306e\u5b9f\u884c\u306b\u306e\u307f\u9069\u7528\u3055\u308c\u307e\u3059\nwith spot.cached_run(simulation, version=\"test-v1\") as sim:\n\n    # \u3053\u3053\u3067\u306f sim(arg) \u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd\u4ed8\u304d\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\n    # IDE\u306e\u578b\u88dc\u5b8c\u3084\u9759\u7684\u89e3\u6790\u3082\uff08\u5143\u306e\u95a2\u6570\u306e\u30b7\u30b0\u30cd\u30c1\u30e3\u306b\u5f93\u3044\uff09\u6a5f\u80fd\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\n    results = [sim(x) for x in range(10)]\n\n# \u30d6\u30ed\u30c3\u30af\u3092\u629c\u3051\u308b\u3068\u3001sim \u306e\u52b9\u529b\u306f\u6d88\u3048\u307e\u3059\u304c\u3001\n# spot \u81ea\u4f53\uff08DB\u63a5\u7d9a\u3084Executor\uff09\u306f\u751f\u304d\u305f\u307e\u307e\u3067\u3001\u518d\u5229\u7528\u53ef\u80fd\u3067\u3059\n</code></pre>"},{"location":"guides/usage_patterns/#multiple-functions","title":"\u8907\u6570\u306e\u95a2\u6570\u3092\u307e\u3068\u3081\u3066\u30ad\u30e3\u30c3\u30b7\u30e5 (Multiple Functions)","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u6e21\u3059\u3068\u3001\u30bf\u30d7\u30eb\u3068\u3057\u3066\u53d7\u3051\u53d6\u308c\u307e\u3059\u3002\u6307\u5b9a\u3057\u305f\u30aa\u30d7\u30b7\u30e7\u30f3\uff08<code>version</code> \u306a\u3069\uff09\u306f\u3001\u6e21\u3057\u305f\u3059\u3079\u3066\u306e\u95a2\u6570\u306b\u4e00\u5f8b\u3067\u9069\u7528\u3055\u308c\u307e\u3059\u3002</p> <pre><code>def task_a(x): ...\ndef task_b(x): ...\n\nwith spot.cached_run(task_a, task_b, save_blob=True) as (run_a, run_b):\n    run_a(data)\n    run_b(data)\n</code></pre> <p>Smart Return Policy</p> <p><code>cached_run</code> \u306e\u623b\u308a\u5024\u306f\u3001\u6e21\u3055\u308c\u305f\u95a2\u6570\u306e\u6570\u306b\u3088\u3063\u3066\u5909\u5316\u3057\u307e\u3059\uff1a</p> <pre><code>* **\u5f15\u6570\u304c1\u3064\u306e\u5834\u5408:** `Wrapper` \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u5358\u4f53\u3067\u8fd4\u3057\u307e\u3059\u3002\uff08\u30a2\u30f3\u30d1\u30c3\u30af\u4e0d\u8981\uff09\n* **\u5f15\u6570\u304c\u8907\u6570\u306e\u5834\u5408:** `(Wrapper, Wrapper, ...)` \u306e\u30bf\u30d7\u30eb\u3092\u8fd4\u3057\u307e\u3059\u3002\n</code></pre>"},{"location":"guides/usage_patterns/#3-imperative-execution-deprecated","title":"3. Imperative Execution (Deprecated)","text":"<p>Deprecated: <code>spot.run</code></p> <p>v1.x \u304a\u3088\u3073 v2.0\u521d\u671f\u306b\u3042\u3063\u305f <code>spot.run(func, *args)</code> \u306f\u3001\u578b\u5b89\u5168\u6027\u306e\u554f\u984c\u306b\u3088\u308a \u975e\u63a8\u5968 (Deprecated) \u3068\u306a\u308a\u307e\u3057\u305f\u3002 \u5c06\u6765\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u524a\u9664\u3055\u308c\u308b\u4e88\u5b9a\u3067\u3059\u3002\u4eca\u5f8c\u306f <code>cached_run</code> \u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"guides/usage_patterns/#migration-guide","title":"Migration Guide","text":"<p>Before (<code>spot.run</code>): \u5f15\u6570\u306e\u578b\u30c1\u30a7\u30c3\u30af\u304c\u52b9\u304b\u305a\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u6307\u5b9a\u306e\u305f\u3081\u306b <code>_</code> \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u4ed8\u304d\u306e\u7279\u6b8a\u306a\u30ad\u30fc\u30ef\u30fc\u30c9\u5f15\u6570\u304c\u5fc5\u8981\u3067\u3057\u305f\u3002</p> <pre><code># \u975e\u63a8\u5968\nresult = spot.run(my_func, arg1, _version=\"v1\")\n</code></pre> <p>After (<code>cached_run</code>): \u6a19\u6e96\u7684\u306a\u95a2\u6570\u547c\u3073\u51fa\u3057\u304c\u53ef\u80fd\u306b\u306a\u308a\u3001\u30b3\u30fc\u30c9\u306e\u610f\u56f3\u3082\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code># \u63a8\u5968\nwith spot.cached_run(my_func, version=\"v1\") as task:\n    result = task(arg1)\n</code></pre>"},{"location":"reference/architecture/","title":"Architecture &amp; Design","text":""},{"location":"reference/architecture/#architecture-design-overview","title":"\ud83c\udfd7\ufe0f Architecture &amp; Design Overview","text":"<p><code>beautyspot</code> \u306f\u3001\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u901a\u3058\u3066\u300c\u5b9f\u884c\u5236\u5fa1\uff08Caching, Rate Limiting, Persistence\uff09\u300d\u3092\u65e2\u5b58\u306e\u30ed\u30b8\u30c3\u30af\u306b\u6ce8\u5165\u3059\u308b\u3001\u975e\u4fb5\u5165\u578b\uff08Non-intrusive\uff09 \u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002</p>"},{"location":"reference/architecture/#1-core-philosophy-the-kuroko-pattern","title":"1. Core Philosophy: \"The Kuroko (\u9ed2\u5b50) Pattern\"","text":"<p>\u30e6\u30fc\u30b6\u30fc\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u95a2\u6570\uff09\u3092\u6c5a\u67d3\u305b\u305a\u3001\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u8907\u96d1\u6027\u3092\u96a0\u853d\u3059\u308b\u3053\u3068\u3092\u8a2d\u8a08\u306e\u4e3b\u773c\u3068\u3057\u3066\u3044\u307e\u3059\u3002</p> <ul> <li>No Inheritance: \u30e6\u30fc\u30b6\u30fc\u306f\u7279\u5b9a\u306e\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u3002</li> <li>No Global State: <code>Spot</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3054\u3068\u306b\u72ec\u7acb\u3057\u305f\u72b6\u614b\uff08DB, TokenBucket\uff09\u3092\u6301\u3064\u3002</li> <li>Fail-Safe: \u30e9\u30a4\u30d6\u30e9\u30ea\u5185\u90e8\u306e\u6574\u5408\u6027\u30a8\u30e9\u30fc\u304c\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30af\u30e9\u30c3\u30b7\u30e5\u3055\u305b\u3066\u306f\u306a\u3089\u306a\u3044\u3002</li> </ul>"},{"location":"reference/architecture/#2-system-components-code-mapping","title":"2. System Components &amp; Code Mapping","text":"<p>\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u3001\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u4e0a\u306e\u3069\u306e\u30af\u30e9\u30b9\u30fb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u5bfe\u5fdc\u3059\u308b\u304b\u3092\u660e\u8a18\u3057\u305f\u30b7\u30b9\u30c6\u30e0\u56f3\u3067\u3059\u3002</p> <pre><code>graph TD\n    UserFunc[User Function] --&gt;|Decorated by| MarkWrapper\n\n    subgraph \"Spot Context (src/beautyspot/core.py)\"\n        MarkWrapper[\"Mark Wrapper&lt;br/&gt;&lt;code&gt;@Spot.mark&lt;/code&gt;\"]\n\n        MarkWrapper --&gt;|Check/Save Cache| SQLite[\"Metadata Store&lt;br/&gt;&lt;code&gt;sqlite3 (tasks table)&lt;/code&gt;\"]\n        MarkWrapper --&gt;|Rate Limit| Limiter[\"Rate Limiter&lt;br/&gt;&lt;code&gt;limiter.TokenBucket&lt;/code&gt;\"]\n        MarkWrapper --&gt;|Execute| Executor[\"Async/Thread Executor&lt;br/&gt;&lt;code&gt;concurrent.futures.Executor&lt;/code&gt;\"]\n\n        MarkWrapper --&gt;|Save Large Data| StorageInt[\"Storage Interface&lt;br/&gt;&lt;code&gt;storage.BlobStorageBase&lt;/code&gt;\"]\n    end\n\n    subgraph \"Storage Backends (src/beautyspot/storage.py)\"\n        StorageInt -.-&gt;|Inheritance| LocalStore[\"&lt;code&gt;class LocalStorage&lt;/code&gt;\"]\n        StorageInt -.-&gt;|Inheritance| S3Store[\"&lt;code&gt;class S3Storage&lt;/code&gt;\"]\n    end\n\n    LocalStore --&gt;|File I/O| LocalDisk[(\"Local Disk\")]\n    S3Store --&gt;|boto3| S3Bucket[(\"AWS S3 / MinIO\")]\n</code></pre>"},{"location":"reference/architecture/#21-metadata-store-sqlite","title":"2.1. Metadata Store (SQLite)","text":"<p>\u30bf\u30b9\u30af\u306e\u5b9f\u884c\u5c65\u6b74\u3068\u300c\u30c7\u30fc\u30bf\u306e\u5728\u308a\u51e6\uff08\u30dd\u30a4\u30f3\u30bf\uff09\u300d\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002 WAL (Write-Ahead Logging) \u30e2\u30fc\u30c9\u3092\u63a1\u7528\u3057\u3001\u4e26\u884c\u8aad\u307f\u66f8\u304d\u6027\u80fd\u3092\u78ba\u4fdd\u3057\u3066\u3044\u307e\u3059\u3002 v2.0 \u4ee5\u964d\u3082\u4e92\u63db\u6027\u7dad\u6301\u306e\u305f\u3081\u3001\u5185\u90e8\u30c6\u30fc\u30d6\u30eb\u540d\u306f <code>tasks</code> \u306e\u307e\u307e\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"reference/architecture/#22-blob-storage-storage-strategy","title":"2.2. Blob Storage (Storage Strategy)","text":"<p>\u753b\u50cf\u3001\u97f3\u58f0\u3001\u9577\u6587\u30c6\u30ad\u30b9\u30c8\u306a\u3069\u306e\u5de8\u5927\u306a\u30c7\u30fc\u30bf\u3092DB\u304b\u3089\u5206\u96e2\u3059\u308b \"Claim Check Pattern\" \u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002 \u62bd\u8c61\u57fa\u5e95\u30af\u30e9\u30b9 <code>BlobStorageBase</code> \u306b\u3088\u308a\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u5dee\u3057\u66ff\u3048\u304c\u53ef\u80fd\u3067\u3059\u3002</p> <p>Note on Multi-modal Support: \u73fe\u5728\u306f <code>LocalStorage</code> \u3068 <code>S3Storage</code> \u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002 \u8a2d\u8a08\u4e0a\u306f\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u900f\u904e\u7684\u306b\u6271\u3046\u305f\u3081\u3001\u5c06\u6765\u7684\u306a Audio (WAV/MP3) \u3084 Video (MP4) \u306a\u3069\u306e\u30de\u30eb\u30c1\u30e1\u30c7\u30a3\u30a2\u30c7\u30fc\u30bf\u3001\u304a\u3088\u3073\u305d\u308c\u3089\u306b\u7279\u5316\u3057\u305f\u30b9\u30c8\u30ec\u30fc\u30b8\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u62e1\u5f35\u3092\u898b\u636e\u3048\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"reference/architecture/#23-rate-limiter-gcra","title":"2.3. Rate Limiter (GCRA)","text":"<p>GCRA (Generic Cell Rate Algorithm) \u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002 \u901a\u5e38\u306e\u30c8\u30fc\u30af\u30f3\u30d0\u30b1\u30c3\u30c8\u3068\u7570\u306a\u308a\u3001\"Theoretical Arrival Time (TAT)\" \u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u3067\u3001\u9577\u6642\u9593\u30a2\u30a4\u30c9\u30eb\u5f8c\u306e\u30d0\u30fc\u30b9\u30c8\uff08\u96c6\u4e2d\u30a2\u30af\u30bb\u30b9\uff09\u3092\u7269\u7406\u7684\u306b\u9632\u304e\u307e\u3059\u3002</p>"},{"location":"reference/architecture/#3-class-diagram","title":"3. Class Diagram","text":"<p>\u4e3b\u8981\u30af\u30e9\u30b9\u306e\u4f9d\u5b58\u95a2\u4fc2\u3068\u8cac\u52d9\u306e\u69cb\u9020\u3067\u3059\u3002<code>Spot</code> \u30af\u30e9\u30b9\u304c <code>Facade</code> \u3068\u3057\u3066\u6a5f\u80fd\u3057\u3001\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u7d71\u62ec\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code>classDiagram\n    class Spot {\n        +str name\n        +str db_path\n        +TokenBucket bucket\n        +BlobStorageBase storage\n        +Executor executor\n        -Finalizer _finalizer\n        __init__(...)\n        +mark(...)\n        +cached_run(...)\n        +limiter(...)\n        +shutdown(wait)\n        -_init_db()\n        -_check_cache_sync(key)\n        -_save_result_sync(key, ...)\n        -_shutdown_executor(executor)$\n    }\n\n    class TokenBucket {\n        +float rate\n        +int max_cost\n        +float tat\n        +consume(cost)\n        +consume_async(cost)\n        -_consume_reservation(cost)\n    }\n\n    class BlobStorageBase {\n        &lt;&lt;Abstract&gt;&gt;\n        +save(key, data)\n        +load(location)\n    }\n\n    class LocalStorage {\n        +str base_dir\n        +save(...)\n        +load(...)\n    }\n\n    class S3Storage {\n        +str bucket_name\n        +str prefix\n        +save(...)\n        +load(...)\n    }\n\n    class KeyGen {\n        &lt;&lt;Utility&gt;&gt;\n        +default(args, kwargs)\n        +from_path_stat(path)\n        +from_file_content(path)\n        -_stable_serialize_default(obj)\n    }\n\n    Spot *-- TokenBucket : owns\n    Spot o-- BlobStorageBase : uses (DI)\n    Spot o-- concurrent.futures.Executor : uses / manages\n    BlobStorageBase &lt;|-- LocalStorage\n    BlobStorageBase &lt;|-- S3Storage\n    Spot ..&gt; KeyGen : uses internal\n</code></pre>"},{"location":"reference/architecture/#4-database-schema-er-diagram","title":"4. Database Schema (ER Diagram)","text":"<p>SQLite\u5185\u90e8\u306e <code>tasks</code> \u30c6\u30fc\u30d6\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3067\u3059\u3002 \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306f <code>Spot</code> \u521d\u671f\u5316\u6642\u306b\u52d5\u7684\u30c1\u30a7\u30c3\u30af\uff08Auto-Migration\uff09\u306b\u3088\u3063\u3066\u884c\u308f\u308c\u307e\u3059\u3002</p> <pre><code>erDiagram\n    tasks {\n        TEXT cache_key PK \"MD5 Hash of (func_name + input_args + version)\"\n        TEXT func_name \"Name of the decorated function\"\n        TEXT input_id \"User-defined ID or Argument Hash\"\n        TEXT version \"Schema version of the task logic\"\n        TEXT result_type \"Storage mode: 'DIRECT_BLOB' or 'FILE'\"\n        TEXT content_type \"MIME type for Dashboard rendering (e.g., 'image/png')\"\n        TEXT result_value \"Path/URI (only for FILE)\"\n        BLOB result_data \"Msgpack bytes (only for DIRECT_BLOB)\"\n        TIMESTAMP updated_at \"Last execution timestamp\"\n    }\n\n</code></pre> <ul> <li><code>result_type</code>:</li> <li><code>DIRECT_BLOB</code>: \u5c0f\u3055\u3044\u30c7\u30fc\u30bf\u3002<code>result_data</code> \u30ab\u30e9\u30e0\u306b Msgpack \u30d0\u30a4\u30ca\u30ea\u3068\u3057\u3066\u76f4\u63a5\u683c\u7d0d\u3002</li> <li> <p><code>FILE</code>: \u5927\u304d\u3044\u30c7\u30fc\u30bf (<code>save_blob=True</code>)\u3002<code>result_value</code> \u306b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u307e\u305f\u306f S3 URI \u3092\u683c\u7d0d\u3002</p> </li> <li> <p><code>content_type</code>:</p> </li> <li>\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u306e\u53ef\u8996\u5316\u306b\u4f7f\u7528\uff08\u4f8b: <code>text/vnd.mermaid</code>, <code>image/png</code>\uff09\u3002</li> </ul>"},{"location":"reference/architecture/#5-execution-flow-mark-decorator","title":"5. Execution Flow (<code>@mark</code> Decorator)","text":"<ol> <li>Hash Generation: \u5f15\u6570 (<code>args</code>, <code>kwargs</code>) \u3068 <code>version</code> \u304b\u3089\u4e00\u610f\u306a <code>cache_key</code> \u3092\u751f\u6210\u3002</li> <li>Cache Check: SQLite\u3092\u53c2\u7167\u3002</li> <li>Hit -&gt; <code>result_type</code> \u306b\u5fdc\u3058\u3066\u30c7\u30fc\u30bf\u3092\u5fa9\u5143\uff08<code>msgpack.unpack</code>\uff09\u3057\u3066\u5373\u5ea7\u306b return\u3002</li> <li> <p>Miss -&gt; \u6b21\u3078\u9032\u3080\u3002</p> </li> <li> <p>Execution: \u30e6\u30fc\u30b6\u30fc\u95a2\u6570\u3092\u5b9f\u884c\u3002</p> </li> <li> <p>Exception: \u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u884c\u308f\u305a \u305d\u306e\u307e\u307e\u4f8b\u5916\u3092\u4e0a\u4f4d\u3078\u4f1d\u64ad\u3055\u305b\u308b\uff08\u30d0\u30b0\u306e\u6c38\u7d9a\u5316\u9632\u6b62\uff09\u3002</p> </li> <li> <p>Persistence:</p> </li> <li>Small Data -&gt; <code>DIRECT_BLOB</code> \u30e2\u30fc\u30c9\u3067SQLite\u306b\u30d0\u30a4\u30ca\u30ea\u4fdd\u5b58\u3002</li> <li>Large Data (<code>save_blob=True</code>) -&gt; <code>FILE</code> \u30e2\u30fc\u30c9\u3067Storage\u306b\u4fdd\u5b58\u3057\u3001\u30d1\u30b9\u306e\u307f\u3092SQLite\u306b\u8a18\u9332\u3002</li> </ol>"},{"location":"reference/architecture/#6-key-technical-decisions-adr-summary","title":"6. Key Technical Decisions (ADR Summary)","text":"<p>\u3053\u306e\u8a2d\u8a08\u306b\u81f3\u3063\u305f\u91cd\u8981\u306a\u610f\u601d\u6c7a\u5b9a\u306e\u5c65\u6b74\u3067\u3059\u3002</p> <ul> <li>ADR-0001: Stable Hashing</li> <li> <p><code>json</code> \u30d9\u30fc\u30b9\u306e\u6b63\u898f\u5316\u3092\u63a1\u7528\u3057\u3001\u7570\u306a\u308b\u74b0\u5883\u9593\u3067\u306e\u30ad\u30fc\u306e\u4e00\u81f4\u7387\u3092\u5411\u4e0a\u3055\u305b\u305f\u3002</p> </li> <li> <p>ADR-0002: GCRA Rate Limiter</p> </li> <li> <p>\u5358\u7d14\u306a\u30c8\u30fc\u30af\u30f3\u30d0\u30b1\u30c3\u30c8\u306e\u300c\u30d0\u30fc\u30b9\u30c8\u554f\u984c\u300d\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b\u3001TAT\u30d9\u30fc\u30b9\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u63a1\u7528\u3057\u305f\u3002</p> </li> <li> <p>ADR-0007: Msgpack Serialization (v2.0)</p> </li> <li> <p><code>pickle</code> \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30ea\u30b9\u30af\uff08RCE\uff09\u3092\u6392\u9664\u3059\u308b\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30b6\u3092 <code>msgpack</code> \u306b\u5909\u66f4\u3057\u305f\u3002</p> </li> <li> <p>ADR-0011: Rename Project to Spot (v2.0)</p> </li> <li>\u30e9\u30a4\u30d6\u30e9\u30ea\u540d\u304a\u3088\u3073 \"Beauty Spot\"\uff08\u307b\u304f\u308d\uff09\u3068\u3044\u3046\u30b3\u30f3\u30bb\u30d7\u30c8\u3068\u306e\u6574\u5408\u6027\u3092\u9ad8\u3081\u308b\u305f\u3081\u3001\u7ba1\u7406\u30af\u30e9\u30b9\u3092 <code>Spot</code>\u3001\u30c7\u30b3\u30ec\u30fc\u30bf\u3092 <code>mark</code> \u306b\u5909\u66f4\u3057\u305f\u3002</li> </ul>"},{"location":"reference/cachekey/","title":"Utils","text":""},{"location":"reference/cachekey/#beautyspot.cachekey","title":"<code>beautyspot.cachekey</code>","text":""},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen","title":"<code>KeyGen</code>","text":"<p>Generates stable cache keys (SHA-256) for function inputs (Identity Layer).</p> Note on Separation of Concerns <ul> <li>This class focuses on 'Input Identity' (checking if inputs are effectively the same).</li> <li>It does NOT handle 'Output Serialization' (saving results to DB).   For custom output serialization, use <code>spot.register()</code>.</li> </ul> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>class KeyGen:\n    \"\"\"\n    Generates stable cache keys (SHA-256) for function inputs (Identity Layer).\n\n    Note on Separation of Concerns:\n      - This class focuses on 'Input Identity' (checking if inputs are effectively the same).\n      - It does NOT handle 'Output Serialization' (saving results to DB).\n        For custom output serialization, use `spot.register()`.\n    \"\"\"\n\n    # Constants for convenience usage in KeyGen.map()\n    HASH = Strategy.DEFAULT\n    IGNORE = Strategy.IGNORE\n    FILE_CONTENT = Strategy.FILE_CONTENT\n    PATH_STAT = Strategy.PATH_STAT\n\n    @staticmethod\n    def from_path_stat(filepath: str) -&gt; str:\n        \"\"\"Fast: path + size + mtime (SHA-256)\"\"\"\n        if not os.path.exists(filepath):\n            return f\"MISSING_{filepath}\"\n        stat = os.stat(filepath)\n        identifier = f\"{filepath}_{stat.st_size}_{stat.st_mtime}\"\n        return hashlib.sha256(identifier.encode()).hexdigest()\n\n    @staticmethod\n    def from_file_content(filepath: str) -&gt; str:\n        \"\"\"Strict: file content hash (SHA-256)\"\"\"\n        if not os.path.exists(filepath):\n            return f\"MISSING_{filepath}\"\n\n        hasher = hashlib.sha256()\n        # Include extension to distinguish format changes\n        hasher.update(os.path.splitext(filepath)[1].lower().encode())\n\n        try:\n            with open(filepath, \"rb\") as f:\n                while chunk := f.read(65536):\n                    hasher.update(chunk)\n        except OSError:\n            return f\"ERROR_{filepath}\"\n        return hasher.hexdigest()\n\n    @staticmethod\n    def default(args: tuple, kwargs: dict) -&gt; str:\n        \"\"\"\n        Generates a stable SHA-256 hash from function arguments using recursive canonicalization.\n        This is the default legacy behavior sensitive to args/kwargs structure.\n        \"\"\"\n        try:\n            # 1. Normalize structure\n            normalized = [\n                canonicalize(args),\n                canonicalize(kwargs)\n            ]\n\n            # 2. Serialize to bytes\n            packed = msgpack.packb(normalized)\n\n            if packed is None:\n                raise ValueError(\"msgpack.packb returned None\")\n\n            # 3. Hash (SHA-256)\n            return hashlib.sha256(packed).hexdigest()\n\n        except Exception:\n            # Fallback\n            return hashlib.sha256(str((args, kwargs)).encode()).hexdigest()\n\n    @staticmethod\n    def hash_items(items: list) -&gt; str:\n        \"\"\"Helper to hash a list of canonicalized items.\"\"\"\n        packed = msgpack.packb(items)\n        if packed is None:\n            raise ValueError(\"msgpack.packb returned None\")\n        return hashlib.sha256(packed).hexdigest()\n\n    # --- Factory Methods for Policies ---\n\n    @classmethod\n    def ignore(cls, *arg_names: str) -&gt; KeyGenPolicy:\n        \"\"\"\n        Creates a policy that ignores specific arguments (e.g., 'verbose', 'logger').\n        \"\"\"\n        strategies = {name: Strategy.IGNORE for name in arg_names}\n        return KeyGenPolicy(strategies, default_strategy=Strategy.DEFAULT)\n\n    @classmethod\n    def map(cls, **arg_strategies: Strategy) -&gt; KeyGenPolicy:\n        \"\"\"\n        Creates a policy with explicit strategies for specific arguments.\n        Example: KeyGen.map(data=KeyGen.HASH, config=KeyGen.FILE_CONTENT)\n        \"\"\"\n        return KeyGenPolicy(arg_strategies, default_strategy=Strategy.DEFAULT)\n\n    @classmethod\n    def file_content(cls, *arg_names: str) -&gt; KeyGenPolicy:\n        \"\"\"\n        Creates a policy that treats specified arguments as file paths and hashes their content.\n        \"\"\"\n        strategies = {name: Strategy.FILE_CONTENT for name in arg_names}\n        return KeyGenPolicy(strategies, default_strategy=Strategy.DEFAULT)\n\n    @classmethod\n    def path_stat(cls, *arg_names: str) -&gt; KeyGenPolicy:\n        \"\"\"\n        Creates a policy that treats specified arguments as file paths and hashes their metadata (stat).\n        \"\"\"\n        strategies = {name: Strategy.PATH_STAT for name in arg_names}\n        return KeyGenPolicy(strategies, default_strategy=Strategy.DEFAULT)\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.default","title":"<code>default(args, kwargs)</code>  <code>staticmethod</code>","text":"<p>Generates a stable SHA-256 hash from function arguments using recursive canonicalization. This is the default legacy behavior sensitive to args/kwargs structure.</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@staticmethod\ndef default(args: tuple, kwargs: dict) -&gt; str:\n    \"\"\"\n    Generates a stable SHA-256 hash from function arguments using recursive canonicalization.\n    This is the default legacy behavior sensitive to args/kwargs structure.\n    \"\"\"\n    try:\n        # 1. Normalize structure\n        normalized = [\n            canonicalize(args),\n            canonicalize(kwargs)\n        ]\n\n        # 2. Serialize to bytes\n        packed = msgpack.packb(normalized)\n\n        if packed is None:\n            raise ValueError(\"msgpack.packb returned None\")\n\n        # 3. Hash (SHA-256)\n        return hashlib.sha256(packed).hexdigest()\n\n    except Exception:\n        # Fallback\n        return hashlib.sha256(str((args, kwargs)).encode()).hexdigest()\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.file_content","title":"<code>file_content(*arg_names)</code>  <code>classmethod</code>","text":"<p>Creates a policy that treats specified arguments as file paths and hashes their content.</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@classmethod\ndef file_content(cls, *arg_names: str) -&gt; KeyGenPolicy:\n    \"\"\"\n    Creates a policy that treats specified arguments as file paths and hashes their content.\n    \"\"\"\n    strategies = {name: Strategy.FILE_CONTENT for name in arg_names}\n    return KeyGenPolicy(strategies, default_strategy=Strategy.DEFAULT)\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.from_file_content","title":"<code>from_file_content(filepath)</code>  <code>staticmethod</code>","text":"<p>Strict: file content hash (SHA-256)</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@staticmethod\ndef from_file_content(filepath: str) -&gt; str:\n    \"\"\"Strict: file content hash (SHA-256)\"\"\"\n    if not os.path.exists(filepath):\n        return f\"MISSING_{filepath}\"\n\n    hasher = hashlib.sha256()\n    # Include extension to distinguish format changes\n    hasher.update(os.path.splitext(filepath)[1].lower().encode())\n\n    try:\n        with open(filepath, \"rb\") as f:\n            while chunk := f.read(65536):\n                hasher.update(chunk)\n    except OSError:\n        return f\"ERROR_{filepath}\"\n    return hasher.hexdigest()\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.from_path_stat","title":"<code>from_path_stat(filepath)</code>  <code>staticmethod</code>","text":"<p>Fast: path + size + mtime (SHA-256)</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@staticmethod\ndef from_path_stat(filepath: str) -&gt; str:\n    \"\"\"Fast: path + size + mtime (SHA-256)\"\"\"\n    if not os.path.exists(filepath):\n        return f\"MISSING_{filepath}\"\n    stat = os.stat(filepath)\n    identifier = f\"{filepath}_{stat.st_size}_{stat.st_mtime}\"\n    return hashlib.sha256(identifier.encode()).hexdigest()\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.hash_items","title":"<code>hash_items(items)</code>  <code>staticmethod</code>","text":"<p>Helper to hash a list of canonicalized items.</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@staticmethod\ndef hash_items(items: list) -&gt; str:\n    \"\"\"Helper to hash a list of canonicalized items.\"\"\"\n    packed = msgpack.packb(items)\n    if packed is None:\n        raise ValueError(\"msgpack.packb returned None\")\n    return hashlib.sha256(packed).hexdigest()\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.ignore","title":"<code>ignore(*arg_names)</code>  <code>classmethod</code>","text":"<p>Creates a policy that ignores specific arguments (e.g., 'verbose', 'logger').</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@classmethod\ndef ignore(cls, *arg_names: str) -&gt; KeyGenPolicy:\n    \"\"\"\n    Creates a policy that ignores specific arguments (e.g., 'verbose', 'logger').\n    \"\"\"\n    strategies = {name: Strategy.IGNORE for name in arg_names}\n    return KeyGenPolicy(strategies, default_strategy=Strategy.DEFAULT)\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.map","title":"<code>map(**arg_strategies)</code>  <code>classmethod</code>","text":"<p>Creates a policy with explicit strategies for specific arguments. Example: KeyGen.map(data=KeyGen.HASH, config=KeyGen.FILE_CONTENT)</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@classmethod\ndef map(cls, **arg_strategies: Strategy) -&gt; KeyGenPolicy:\n    \"\"\"\n    Creates a policy with explicit strategies for specific arguments.\n    Example: KeyGen.map(data=KeyGen.HASH, config=KeyGen.FILE_CONTENT)\n    \"\"\"\n    return KeyGenPolicy(arg_strategies, default_strategy=Strategy.DEFAULT)\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGen.path_stat","title":"<code>path_stat(*arg_names)</code>  <code>classmethod</code>","text":"<p>Creates a policy that treats specified arguments as file paths and hashes their metadata (stat).</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>@classmethod\ndef path_stat(cls, *arg_names: str) -&gt; KeyGenPolicy:\n    \"\"\"\n    Creates a policy that treats specified arguments as file paths and hashes their metadata (stat).\n    \"\"\"\n    strategies = {name: Strategy.PATH_STAT for name in arg_names}\n    return KeyGenPolicy(strategies, default_strategy=Strategy.DEFAULT)\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGenPolicy","title":"<code>KeyGenPolicy</code>","text":"<p>A policy object that binds to a function signature to generate cache keys based on argument-specific strategies.</p> <p>This acts as a bridge between the flexible <code>*args, **kwargs</code> interface of the decorator and the structured <code>KeyGen</code> logic.</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>class KeyGenPolicy:\n    \"\"\"\n    A policy object that binds to a function signature to generate cache keys\n    based on argument-specific strategies.\n\n    This acts as a bridge between the flexible `*args, **kwargs` interface of\n    the decorator and the structured `KeyGen` logic.\n    \"\"\"\n    def __init__(self, strategies: Dict[str, Strategy], default_strategy: Strategy = Strategy.DEFAULT):\n        self.strategies = strategies\n        self.default_strategy = default_strategy\n\n    def bind(self, func: Callable) -&gt; Callable[..., str]:\n        \"\"\"\n        Creates a key generation function bound to the specific signature of `func`.\n\n        This uses `inspect.signature` to map positional arguments to their names,\n        allowing strategies to be applied consistently regardless of how the function is called.\n        \"\"\"\n        sig = inspect.signature(func)\n\n        def _bound_keygen(*args, **kwargs) -&gt; str:\n            # Bind arguments to names, applying defaults\n            bound = sig.bind(*args, **kwargs)\n            bound.apply_defaults()\n\n            items_to_hash = []\n\n            # Iterate over arguments in definition order\n            for name, val in bound.arguments.items():\n                strategy = self.strategies.get(name, self.default_strategy)\n\n                if strategy == Strategy.IGNORE:\n                    continue\n\n                elif strategy == Strategy.FILE_CONTENT:\n                    # Expecting val to be a path-like string\n                    items_to_hash.append(KeyGen.from_file_content(str(val)))\n\n                elif strategy == Strategy.PATH_STAT:\n                    items_to_hash.append(KeyGen.from_path_stat(str(val)))\n\n                else: # DEFAULT\n                    items_to_hash.append(canonicalize(val))\n\n            # Hash the accumulated list of canonical items\n            return KeyGen.hash_items(items_to_hash)\n\n        return _bound_keygen\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.KeyGenPolicy.bind","title":"<code>bind(func)</code>","text":"<p>Creates a key generation function bound to the specific signature of <code>func</code>.</p> <p>This uses <code>inspect.signature</code> to map positional arguments to their names, allowing strategies to be applied consistently regardless of how the function is called.</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>def bind(self, func: Callable) -&gt; Callable[..., str]:\n    \"\"\"\n    Creates a key generation function bound to the specific signature of `func`.\n\n    This uses `inspect.signature` to map positional arguments to their names,\n    allowing strategies to be applied consistently regardless of how the function is called.\n    \"\"\"\n    sig = inspect.signature(func)\n\n    def _bound_keygen(*args, **kwargs) -&gt; str:\n        # Bind arguments to names, applying defaults\n        bound = sig.bind(*args, **kwargs)\n        bound.apply_defaults()\n\n        items_to_hash = []\n\n        # Iterate over arguments in definition order\n        for name, val in bound.arguments.items():\n            strategy = self.strategies.get(name, self.default_strategy)\n\n            if strategy == Strategy.IGNORE:\n                continue\n\n            elif strategy == Strategy.FILE_CONTENT:\n                # Expecting val to be a path-like string\n                items_to_hash.append(KeyGen.from_file_content(str(val)))\n\n            elif strategy == Strategy.PATH_STAT:\n                items_to_hash.append(KeyGen.from_path_stat(str(val)))\n\n            else: # DEFAULT\n                items_to_hash.append(canonicalize(val))\n\n        # Hash the accumulated list of canonical items\n        return KeyGen.hash_items(items_to_hash)\n\n    return _bound_keygen\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.Strategy","title":"<code>Strategy</code>","text":"<p>               Bases: <code>Enum</code></p> <p>Defines the strategy for hashing a specific argument.</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>class Strategy(Enum):\n    \"\"\"\n    Defines the strategy for hashing a specific argument.\n    \"\"\"\n    DEFAULT = auto()      # Recursively canonicalize and hash (Default behavior)\n    IGNORE = auto()       # Exclude from hash calculation completely\n    FILE_CONTENT = auto() # Treat as file path and hash its content (Strict)\n    PATH_STAT = auto()    # Treat as file path and hash its metadata (Fast: path+size+mtime)\n</code></pre>"},{"location":"reference/cachekey/#beautyspot.cachekey.canonicalize","title":"<code>canonicalize(obj)</code>","text":"<p>Recursively converts an object into a canonical form suitable for stable Msgpack serialization.</p> <p>Strategies: 1. Dict -&gt; Sorted List of entries (fixes order). 2. Set -&gt; Sorted List (fixes order). 3. Numpy-like -&gt; Tuple with raw bytes (efficient &amp; exact). 4. Type (Class) -&gt; Schema hash (Pydantic) or Structure hash (Generic). 5. Object (Instance) -&gt; Dict via dict or slots (avoids memory address).</p> Source code in <code>src/beautyspot/cachekey.py</code> <pre><code>def canonicalize(obj: Any) -&gt; Any:\n    \"\"\"\n    Recursively converts an object into a canonical form suitable for stable Msgpack serialization.\n\n    Strategies:\n    1. Dict -&gt; Sorted List of entries (fixes order).\n    2. Set -&gt; Sorted List (fixes order).\n    3. Numpy-like -&gt; Tuple with raw bytes (efficient &amp; exact).\n    4. Type (Class) -&gt; Schema hash (Pydantic) or Structure hash (Generic).\n    5. Object (Instance) -&gt; Dict via __dict__ or __slots__ (avoids memory address).\n    \"\"\"\n    # 1. Primitives (No change needed)\n    if obj is None or isinstance(obj, (int, float, bool, str, bytes)):\n        return obj\n\n    # 2. Dict -&gt; List of [k, v], sorted by key\n    if isinstance(obj, dict):\n        return [\n            [canonicalize(k), canonicalize(v)]\n            for k, v in sorted(obj.items(), key=lambda i: _safe_sort_key(i[0]))\n        ]\n\n    # 3. List/Tuple -&gt; Recursive canonicalization\n    if isinstance(obj, (list, tuple)):\n        return [canonicalize(x) for x in obj]\n\n    # 4. Set -&gt; Sorted List\n    if isinstance(obj, (set, frozenset)):\n        normalized_items = [canonicalize(x) for x in obj]\n        return sorted(normalized_items, key=_safe_sort_key)\n\n    # 5. Numpy Array Handling (Duck Typing)\n    if hasattr(obj, \"shape\") and hasattr(obj, \"dtype\") and hasattr(obj, \"tobytes\"):\n        try:\n            return (\"__numpy__\", obj.shape, str(obj.dtype), obj.tobytes())\n        except Exception:\n            pass\n\n    # 6. Type/Class Handling (Structure Awareness)\n    if isinstance(obj, type):\n        # Strategy A: Pydantic Model (Schema-based)\n        if hasattr(obj, \"model_json_schema\"): # Pydantic v2\n             try:\n                 return (\"__pydantic_v2__\", canonicalize(obj.model_json_schema()))\n             except Exception:\n                 pass\n        if hasattr(obj, \"schema\"): # Pydantic v1\n             try:\n                 return (\"__pydantic_v1__\", canonicalize(obj.schema()))\n             except Exception:\n                 pass\n\n        # Strategy B: Generic Class (Structure-based)\n        class_attrs = {}\n        try:\n            for k, v in obj.__dict__.items():\n                if k.startswith(\"__\") and k != \"__annotations__\":\n                    continue\n                if callable(v): \n                    continue\n                class_attrs[k] = v\n        except AttributeError:\n            pass\n\n        return (\"__class__\", obj.__module__, obj.__qualname__, canonicalize(class_attrs))\n\n    # 7. Custom Objects (Instance)\n    if hasattr(obj, \"__dict__\"):\n        return canonicalize(obj.__dict__)\n\n    if hasattr(obj, \"__slots__\"):\n        return [\n            [k, canonicalize(getattr(obj, k))]\n            for k in sorted(obj.__slots__)\n            if hasattr(obj, k)\n        ]\n\n    # 8. Last Resort: String representation\n    return str(obj)\n</code></pre>"},{"location":"reference/core/","title":"Spot (Core)","text":""},{"location":"reference/core/#beautyspot.core","title":"<code>beautyspot.core</code>","text":""},{"location":"reference/core/#beautyspot.core.ScopedMark","title":"<code>ScopedMark</code>","text":"<p>Helper context manager for 'with spot.cached_run(...):'. Handles wrapping functions and managing the scope.</p> Source code in <code>src/beautyspot/core.py</code> <pre><code>class ScopedMark:\n    \"\"\"\n    Helper context manager for 'with spot.cached_run(...):'.\n    Handles wrapping functions and managing the scope.\n    \"\"\"\n    def __init__(self, spot: \"Spot\", funcs: tuple[Callable, ...], **options):\n        self.spot = spot\n        self.funcs = funcs\n        self.options = options\n\n    def __enter__(self):\n        # 1. Apply mark() to all functions with the given options\n        wrappers = [\n            self.spot.mark(f, **self.options) \n            for f in self.funcs\n        ]\n\n        # 2. Smart Return Policy:\n        # If single function, return it directly (no tuple unpacking needed).\n        # If multiple, return as tuple.\n        if len(wrappers) == 1:\n            return wrappers[0]\n\n        return tuple(wrappers)\n\n    def __exit__(self, exc_type, exc_val, exc_tb):\n        # We do NOT shutdown the spot here. \n        # The spot's lifecycle is independent of this cached_run scope.\n        pass\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot","title":"<code>Spot</code>","text":"<p>Spot class that handles task management, serialization, and resource management for marked functions including caching and storage.</p> Source code in <code>src/beautyspot/core.py</code> <pre><code>class Spot:\n    \"\"\"\n    Spot class that handles task management, serialization, and\n    resource management for marked functions including caching and storage.\n    \"\"\"\n\n    def __init__(\n        self,\n        name: str,\n        db: str | TaskDB | None = None,\n        storage_path: str | None = None,  # Changed default to None\n        s3_opts: dict | None = None,\n        tpm: int = 10000,\n        io_workers: int = 4,\n        blob_warning_threshold: int = 1024 * 1024,\n        executor: Optional[Executor] = None,\n        storage: Optional[BlobStorageBase] = None,\n        # --- Default Task Settings ---\n        default_save_blob: bool = False,\n        default_version: str | None = None,\n        default_content_type: str | None = None,\n    ):\n        \"\"\"\n        Initialize a Spot instance.\n\n        Args:\n            name: Name of the spot/workspace.\n            db: Database for tasks, can be a filepath or TaskDB instance.\n            storage_path: Path for storing blobs locally.\n            s3_opts: Options for S3 storage.\n            tpm: Tokens per minute for rate limiting.\n            io_workers: Number of IO workers for executor.\n            blob_warning_threshold: Threshold size (bytes) to warn when saving large data to SQLite.\n            executor: Optional pre-created executor.\n            storage: Optional pre-created storage instance.\n            default_save_blob: Default value for save_blob in mark/run.\n            default_version: Default version string for mark/run.\n            default_content_type: Default content_type for mark/run.\n        \"\"\"\n        self.name = name\n        self.blob_warning_threshold = blob_warning_threshold\n\n        # Store defaults\n        self.default_save_blob = default_save_blob\n        self.default_version = default_version\n        self.default_content_type = default_content_type\n\n        # --- Workspace Setup ---\n        # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u7528\u306e\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\n        self.workspace_dir = Path(\".beautyspot\")\n        self._setup_workspace()\n\n        # --- \u30ad\u30e3\u30c3\u30b7\u30e5\u7ba1\u7406\u7528 \u30c6\u30fc\u30d6\u30eb\u78ba\u8a8d\u3068\u521d\u671f\u5316 ---\n        if db is None:\n            # \u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306eDB\u30d5\u30a1\u30a4\u30eb\n            self.db = SQLiteTaskDB(str(self.workspace_dir / f\"{name}.db\"))\n        elif isinstance(db, str):\n            self.db = SQLiteTaskDB(db)\n        elif isinstance(db, TaskDB):\n            self.db = db\n        else:\n            raise TypeError(\n                \"Argument 'db' must be a string (path) or a TaskDB instance.\"\n            )\n        self.db.init_schema()\n\n        # --- Rate Limiter ---\n        self.bucket = TokenBucket(tpm)\n\n        # --- Serializer Setup ---\n        self.serializer = MsgpackSerializer()\n\n        # --- Storage \u521d\u671f\u5316 ---\n        if storage is not None:\n            self.storage = storage\n        else:\n            # storage_path\u304c\u672a\u6307\u5b9a\u306a\u3089\u3001\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306eblobs\u3092\u4f7f\u3046\n            if storage_path is None:\n                final_storage_path = str(self.workspace_dir / \"blobs\")\n            else:\n                final_storage_path = storage_path\n\n            self.storage = create_storage(final_storage_path, s3_opts)\n\n        # -- Executor Management ---\n        if executor is not None:\n            self.executor = executor\n            self._own_executor = False\n        else:\n            self.executor = ThreadPoolExecutor(max_workers=io_workers)\n            self._own_executor = True\n\n            # \u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u306e\u767b\u9332\n            # self\u3078\u306e\u5f37\u3044\u53c2\u7167\u3092\u6301\u305f\u305b\u306a\u3044\u3088\u3046\u3001executor\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3051\u3092\u6b8b\u3059\u3053\u3068\n            self._finalizer = weakref.finalize(\n                self, Spot._shutdown_executor, self.executor,\n            )\n\n    def _setup_workspace(self):\n        \"\"\"Ensure the workspace directory and .gitignore exist.\"\"\"\n        if not self.workspace_dir.exists():\n            self.workspace_dir.mkdir(parents=True, exist_ok=True)\n\n        # Add a .gitignore to ignore everything in this directory\n        gitignore_path = self.workspace_dir / \".gitignore\"\n        if not gitignore_path.exists():\n            with open(gitignore_path, \"w\") as f:\n                f.write(\"*\\n\")\n\n    @staticmethod\n    def _shutdown_executor(executor: Executor):\n        \"\"\"\n        Clean-up function for internal Executor.\n        ! This method must be a staticmethod to avoid circuler reference in weakrf.finalize() in self.__init__().\n\n        Args:\n            executor: The executor to be shut down.\n        \"\"\"\n        executor.shutdown(wait=True)\n\n    def shutdown(self, wait: bool = True):\n        \"\"\"\n        Manually release resources.\n\n        Args:\n            wait: Whether to wait for the executor to be shut down.\n        \"\"\"\n        if self._own_executor and self._finalizer.alive:\n            self._finalizer()\n\n    def __enter__(self) -&gt; \"Spot\":\n        \"\"\"\n        Enter the runtime context related to this object.\n\n        Returns:\n            self: The Spot instance itself.\n        \"\"\"\n        return self\n\n    def __exit__(self, exc_type, exc_value, traceback):\n        \"\"\"\n        Exit the runtime context and clean up resources.\n\n        Args:\n            exc_type: Exception type.\n            exc_value: Exception value.\n            traceback: Traceback object.\n        \"\"\"\n        self.shutdown()\n\n\n    def register(\n        self,\n        code: int,\n        encoder: Callable[[Any], bytes],\n        decoder: Optional[Callable[[bytes], Any]] = None,\n        decoder_factory: Optional[Callable[[Type], Callable[[bytes], Any]]] = None,\n    ) -&gt; Callable[[Type], Type]:\n        \"\"\"\n        Decorator to register a custom type for serialization.\n        \"\"\"\n        if decoder is None and decoder_factory is None:\n            raise ValueError(\"Must provide either `decoder` or `decoder_factory`.\")\n\n        def decorator(cls: Type) -&gt; Type:\n            actual_decoder = decoder\n            # \u30af\u30e9\u30b9\u751f\u6210\u5f8c\u306b\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5b9f\u884c\u3057\u3066\u30c7\u30b3\u30fc\u30c0\u3092\u53d6\u5f97\n            if decoder_factory:\n                actual_decoder = decoder_factory(cls)\n\n            # --- \u4ee5\u4e0b\u306e\u30c1\u30a7\u30c3\u30af\u304c\u30c6\u30b9\u30c8\u901a\u904e\u306b\u5fc5\u9808\u3067\u3059 ---\n            if actual_decoder is None:\n                 raise ValueError(\"Decoder resolution failed.\")\n            # ----------------------------------------\n\n            self.register_type(cls, code, encoder, actual_decoder)\n            return cls\n\n        return decorator\n\n    def register_type(\n        self, type_: Type, code: int, encoder: Callable, decoder: Callable\n    ):\n        \"\"\"\n        Register a custom type for serialization (Msgpack Extension Type).\n\n        Args:\n            type_: The class to handle (e.g. MyClass)\n            code: Unique integer ID (0-127) for this type\n            encoder: Function that converts obj -&gt; bytes\n            decoder: Function that converts bytes -&gt; obj\n        \"\"\"\n        self.serializer.register(type_, code, encoder, decoder)\n\n    # --- Core Logic (Sync) ---\n\n    def _resolve_settings(\n        self,\n        save_blob: bool | None,\n        version: str | None,\n        content_type: str | None\n    ) -&gt; tuple[bool, str | None, str | None]:\n        \"\"\"\n        Resolve settings based on arguments and spot defaults.\n        Priority: Argument &gt; Spot Default\n        \"\"\"\n        final_save_blob = save_blob if save_blob is not None else self.default_save_blob\n        final_version = version if version is not None else self.default_version\n        final_content_type = content_type if content_type is not None else self.default_content_type\n        return final_save_blob, final_version, final_content_type\n\n    def _make_cache_key(\n        self,\n        func_name: str,\n        args: tuple,\n        kwargs: dict,\n        input_key_fn: Optional[Callable],\n        version: str | None\n    ) -&gt; tuple[str, str]:\n        \"\"\"Generate input_id and cache_key.\"\"\"\n        iid = (\n            input_key_fn(*args, **kwargs)\n            if input_key_fn\n            else KeyGen.default(args, kwargs)\n        )\n\n        key_source = f\"{func_name}:{iid}\"\n        if version:\n            key_source += f\":{version}\"\n\n        ck = hashlib.md5(key_source.encode()).hexdigest()\n        return iid, ck\n\n    def _execute_sync(\n        self,\n        func: Callable,\n        args: tuple,\n        kwargs: dict,\n        save_blob: bool | None,\n        input_key_fn: Optional[Union[Callable, KeyGenPolicy]],\n        version: str | None,\n        content_type: Optional[str],\n    ) -&gt; Any:\n        \"\"\"Internal synchronous execution logic.\"\"\"\n        # Resolve Defaults\n        s_blob, s_ver, s_ct = self._resolve_settings(save_blob, version, content_type)\n\n        # --- Policy Binding Check (ADDED) ---\n        # If input_key_fn is a Policy object (has 'bind'), bind it to the function now.\n        effective_key_fn: Optional[Callable] = None\n\n        if isinstance(input_key_fn, KeyGenPolicy):\n            effective_key_fn = input_key_fn.bind(func)\n        else:\n            effective_key_fn = input_key_fn\n\n        # ------------------------------------\n\n        iid, ck = self._make_cache_key(func.__name__, args, kwargs, effective_key_fn, s_ver)\n\n        # 1. Check Cache\n        cached = self._check_cache_sync(ck)\n        if cached is not CACHE_MISS:\n            return cached\n\n        # 2. Execute\n        res = func(*args, **kwargs)\n\n        # 3. Save\n        self._save_result_sync(\n            ck, func.__name__, str(iid), s_ver, res, s_ct, s_blob\n        )\n        return res\n\n    async def _execute_async(\n        self,\n        func: Callable,\n        args: tuple,\n        kwargs: dict,\n        save_blob: bool | None,\n        input_key_fn: Optional[Union[Callable, KeyGenPolicy]],\n        version: str | None,\n        content_type: Optional[str],\n    ) -&gt; Any:\n        \"\"\"Internal asynchronous execution logic.\"\"\"\n        # Resolve Defaults\n        s_blob, s_ver, s_ct = self._resolve_settings(save_blob, version, content_type)\n\n        effective_key_fn: Optional[Callable] = None\n\n        if isinstance(input_key_fn, KeyGenPolicy):\n            effective_key_fn = input_key_fn.bind(func)\n        else:\n            effective_key_fn = input_key_fn\n\n        iid, ck = self._make_cache_key(func.__name__, args, kwargs, effective_key_fn, s_ver)\n        loop = asyncio.get_running_loop()\n\n        # 1. Check Cache (Offload IO)\n        cached = await loop.run_in_executor(\n            self.executor, self._check_cache_sync, ck\n        )\n        if cached is not CACHE_MISS:\n            return cached\n\n        # 2. Execute (Async)\n        res = await func(*args, **kwargs)\n\n        # 3. Save (Offload IO)\n        await loop.run_in_executor(\n            self.executor,\n            self._save_result_sync,\n            ck,\n            func.__name__,\n            str(iid),\n            s_ver,\n            res,\n            s_ct,\n            s_blob,\n        )\n        return res\n\n    # --- Core Logic (Sync) ---\n    def _check_cache_sync(self, cache_key: str) -&gt; Any:\n        entry = self.db.get(cache_key)\n\n        if entry:\n            r_type = entry[\"result_type\"]\n            r_val = entry[\"result_value\"] # Path (str)\n            r_data = entry.get(\"result_data\")  # Content (bytes)\n\n            # Case 1: Native SQLite BLOB (Standard for small data)\n            if r_type == \"DIRECT_BLOB\":\n                if r_data is None:\n                    return CACHE_MISS  # \u30c7\u30fc\u30bf\u7834\u640d\u6642\u3082MISS\u6271\u3044\n                    return None\n                try:\n                    return self.serializer.loads(r_data)\n                except Exception as e:\n                    logger.error(\n                        f\"Failed to deserialize DIRECT_BLOB for `{cache_key}`: {e}\"\n                    )\n                    return CACHE_MISS\n\n            # Case 2: External Blob (Standard for large data)\n            elif r_type == \"FILE\":\n                try:\n                    # result_value is treated strictly as a Path/URI\n                    data_bytes = self.storage.load(r_val)\n                    return self.serializer.loads(data_bytes)\n                except Exception:\n                    return CACHE_MISS\n\n        return CACHE_MISS  # \u30a8\u30f3\u30c8\u30ea\u304c\u306a\u3044\u5834\u5408\u306fMISS\n\n    # ... (\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u306f\u5909\u66f4\u306a\u3057) ...\n    def _save_result_sync(self, cache_key, func_name, input_id, version, result, content_type, save_blob):\n        try:\n            data_bytes = self.serializer.dumps(result)\n        except SerializationError as e:\n            # Fail fast if the type is not registered.\n            raise e\n\n        r_val = None\n        r_blob = None\n        r_type = \"DIRECT_BLOB\"\n\n        if save_blob:\n            # Explicit Blob Storage\n            r_val = self.storage.save(cache_key, data_bytes)\n            r_type = \"FILE\"\n        else:\n            # SQLite BLOB Storage\n            data_size = len(data_bytes)\n\n            # Guardrail: Warning for unintentional large data\n            if data_size &gt; self.blob_warning_threshold:\n                logger.warning(\n                    f\"\u26a0\ufe0f Large data detected ({data_size / 1024:.1f} KB) for task '{func_name}'. \"\n                    f\"This is saved to SQLite directly, which may bloat the database file. \"\n                    f\"Consider adding `@spot.mark(save_blob=True)` to improve performance and file size.\"\n                )\n\n            # Save raw bytes\n            r_blob = data_bytes\n            r_type = \"DIRECT_BLOB\"\n\n        self.db.save(\n            cache_key=cache_key,\n            func_name=func_name,\n            input_id=input_id,\n            version=version,\n            result_type=r_type,\n            content_type=content_type,\n            result_value=r_val,\n            result_data=r_blob,\n        )\n\n    # --- Decorators ---\n\n    def limiter(self, cost: Union[int, Callable] = 1):\n        \"\"\"\n        Rate Limiting Decorator.\n\n        Args:\n            cost: Cost associated with the function, can be an int or a callable that returns an int.\n        \"\"\"\n\n        def decorator(func):\n            is_async = inspect.iscoroutinefunction(func)\n\n            @functools.wraps(func)\n            def sync_wrapper(*args, **kwargs):\n                c = cost(*args, **kwargs) if callable(cost) else cost\n                self.bucket.consume(c)\n                return func(*args, **kwargs)\n\n            @functools.wraps(func)\n            async def async_wrapper(*args, **kwargs):\n                c = cost(*args, **kwargs) if callable(cost) else cost\n                await self.bucket.consume_async(c)\n                return await func(*args, **kwargs)\n\n            return async_wrapper if is_async else sync_wrapper\n\n        return decorator\n\n    # ----------------------------------------------------------------\n    # Overload 1: @spot.mark \u3068\u3057\u3066\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u5834\u5408\n    # ----------------------------------------------------------------\n    @overload\n    def mark(self, _func: Callable[P, R]) -&gt; Callable[P, R]:\n        ...\n\n    # ----------------------------------------------------------------\n    # Overload 2: @spot.mark(save_blob=True) \u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5834\u5408\n    # ----------------------------------------------------------------\n    @overload\n    def mark(\n        self,\n        *,\n        save_blob: Optional[bool] = None,\n        input_key_fn: Optional[Callable] = None,\n        version: str | None = None,\n        content_type: Optional[str] = None,\n    ) -&gt; Callable[[Callable[P, R]], Callable[P, R]]:\n        ...\n\n    # ----------------------------------------------------------------\n    # \u5b9f\u88c5 (Implementation)\n    # ----------------------------------------------------------------\n    def mark(\n        self,\n        _func: Optional[Callable] = None,\n        *,\n        save_blob: Optional[bool] = None,\n        input_key_fn: Optional[Union[Callable, KeyGenPolicy]] = None,\n        version: str | None = None,\n        content_type: Optional[str] = None,\n    ) -&gt; Any:\n        \"\"\"\n        Mark a function as a managed spot (Resumable Task Decorator).\n        \"\"\"\n        if save_blob is None:\n            save_blob = self.default_save_blob\n\n        def decorator(func):\n            is_async = inspect.iscoroutinefunction(func)\n\n            # --- Policy Binding Setup (ADDED) ---\n            # If a Policy is provided, bind it to the decorated function immediately.\n            effective_key_fn: Optional[Callable] = None\n\n            if isinstance(input_key_fn, KeyGenPolicy):\n                effective_key_fn = input_key_fn.bind(func)\n            else:\n                effective_key_fn = input_key_fn\n\n            # Key Gen Helper\n            def make_key(args, kwargs):\n                from .cachekey import KeyGen\n\n                iid = (\n                    effective_key_fn(*args, **kwargs)\n                    if effective_key_fn\n                    else KeyGen.default(args, kwargs)\n                )\n\n                key_source = f\"{func.__name__}:{iid}\"\n                if version:\n                    key_source += f\":{version}\"\n\n                ck = hashlib.md5(key_source.encode()).hexdigest()\n                return iid, ck\n\n            @functools.wraps(func)\n            def sync_wrapper(*args, **kwargs):\n                iid, ck = make_key(args, kwargs)\n\n                cached = self._check_cache_sync(ck)\n                if cached is not CACHE_MISS:\n                    return cached\n\n                res = func(*args, **kwargs)\n\n                self._save_result_sync(\n                    ck, func.__name__, str(iid), version, res, content_type, save_blob\n                )\n                return res\n\n            @functools.wraps(func)\n            async def async_wrapper(*args, **kwargs):\n                iid, ck = make_key(args, kwargs)\n                loop = asyncio.get_running_loop()\n\n                cached = await loop.run_in_executor(\n                    self.executor, self._check_cache_sync, ck\n                )\n                if cached is not CACHE_MISS:\n                    return cached\n\n                res = await func(*args, **kwargs)\n\n                await loop.run_in_executor(\n                    self.executor,\n                    self._save_result_sync,\n                    ck,\n                    func.__name__,\n                    str(iid),\n                    version,\n                    res,\n                    content_type,\n                    save_blob,\n                )\n                return res\n\n            return async_wrapper if is_async else sync_wrapper\n\n        if _func is not None and callable(_func):\n            return decorator(_func)\n\n        return decorator\n\n    def cached_run(\n        self,\n        *funcs: Callable,\n        save_blob: Optional[bool] = None,\n        input_key_fn: Optional[Callable] = None,\n        version: str | None = None,\n        content_type: Optional[str] = None,\n    ):\n        \"\"\"\n        Create a temporary context for executing function(s) with caching.\n\n        This is the recommended way to use beautyspot for imperative execution,\n        replacing the deprecated `spot.run()`.\n\n        Args:\n            *funcs: One or more functions to wrap.\n            save_blob: Override save_blob setting.\n            input_key_fn: Custom key generator.\n            version: Cache version string.\n            content_type: Content type string.\n\n        Usage:\n            # Single function\n            with spot.cached_run(func) as task:\n                task(data)\n\n            # Multiple functions (unpacked)\n            with spot.cached_run(f1, f2, version=\"v2\") as (t1, t2):\n                t1(data)\n                t2(data)\n        \"\"\"\n        if not funcs:\n            raise ValueError(\"At least one function must be provided to cached_run.\")\n\n        return ScopedMark(\n            self,\n            funcs,\n            save_blob=save_blob,\n            input_key_fn=input_key_fn,\n            version=version,\n            content_type=content_type\n        )\n\n    # --- Imperative Execution ---\n\n    def run(\n        self,\n        func: Callable,\n        *args,\n        _save_blob: Optional[bool] = None,\n        _input_key_fn: Optional[Callable] = None,\n        _version: str | None = None,\n        _content_type: Optional[str] = None,\n        **kwargs,\n    ) -&gt; Any:\n        \"\"\"\n        Execute a function with caching enabled.\n\n        .. deprecated:: 2.0\n            Use `with spot.cached_run(func) as task: task(*args)` instead.\n        \"\"\"\n        warnings.warn(\n            \"`spot.run()` is deprecated and will be removed in v3.0. \"\n            \"Please use `with spot.cached_run(func) as task: task(...)` instead \"\n            \"for better type safety and cleaner API.\",\n            DeprecationWarning,\n            stacklevel=2\n        )\n\n        if inspect.iscoroutinefunction(func):\n            return self._execute_async(\n                func, args, kwargs, _save_blob, _input_key_fn, _version, _content_type\n            )\n        else:\n            return self._execute_sync(\n                func, args, kwargs, _save_blob, _input_key_fn, _version, _content_type\n            )\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.__enter__","title":"<code>__enter__()</code>","text":"<p>Enter the runtime context related to this object.</p> <p>Returns:</p> Name Type Description <code>self</code> <code>Spot</code> <p>The Spot instance itself.</p> Source code in <code>src/beautyspot/core.py</code> <pre><code>def __enter__(self) -&gt; \"Spot\":\n    \"\"\"\n    Enter the runtime context related to this object.\n\n    Returns:\n        self: The Spot instance itself.\n    \"\"\"\n    return self\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.__exit__","title":"<code>__exit__(exc_type, exc_value, traceback)</code>","text":"<p>Exit the runtime context and clean up resources.</p> <p>Parameters:</p> Name Type Description Default <code>exc_type</code> <p>Exception type.</p> required <code>exc_value</code> <p>Exception value.</p> required <code>traceback</code> <p>Traceback object.</p> required Source code in <code>src/beautyspot/core.py</code> <pre><code>def __exit__(self, exc_type, exc_value, traceback):\n    \"\"\"\n    Exit the runtime context and clean up resources.\n\n    Args:\n        exc_type: Exception type.\n        exc_value: Exception value.\n        traceback: Traceback object.\n    \"\"\"\n    self.shutdown()\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.__init__","title":"<code>__init__(name, db=None, storage_path=None, s3_opts=None, tpm=10000, io_workers=4, blob_warning_threshold=1024 * 1024, executor=None, storage=None, default_save_blob=False, default_version=None, default_content_type=None)</code>","text":"<p>Initialize a Spot instance.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Name of the spot/workspace.</p> required <code>db</code> <code>str | TaskDB | None</code> <p>Database for tasks, can be a filepath or TaskDB instance.</p> <code>None</code> <code>storage_path</code> <code>str | None</code> <p>Path for storing blobs locally.</p> <code>None</code> <code>s3_opts</code> <code>dict | None</code> <p>Options for S3 storage.</p> <code>None</code> <code>tpm</code> <code>int</code> <p>Tokens per minute for rate limiting.</p> <code>10000</code> <code>io_workers</code> <code>int</code> <p>Number of IO workers for executor.</p> <code>4</code> <code>blob_warning_threshold</code> <code>int</code> <p>Threshold size (bytes) to warn when saving large data to SQLite.</p> <code>1024 * 1024</code> <code>executor</code> <code>Optional[Executor]</code> <p>Optional pre-created executor.</p> <code>None</code> <code>storage</code> <code>Optional[BlobStorageBase]</code> <p>Optional pre-created storage instance.</p> <code>None</code> <code>default_save_blob</code> <code>bool</code> <p>Default value for save_blob in mark/run.</p> <code>False</code> <code>default_version</code> <code>str | None</code> <p>Default version string for mark/run.</p> <code>None</code> <code>default_content_type</code> <code>str | None</code> <p>Default content_type for mark/run.</p> <code>None</code> Source code in <code>src/beautyspot/core.py</code> <pre><code>def __init__(\n    self,\n    name: str,\n    db: str | TaskDB | None = None,\n    storage_path: str | None = None,  # Changed default to None\n    s3_opts: dict | None = None,\n    tpm: int = 10000,\n    io_workers: int = 4,\n    blob_warning_threshold: int = 1024 * 1024,\n    executor: Optional[Executor] = None,\n    storage: Optional[BlobStorageBase] = None,\n    # --- Default Task Settings ---\n    default_save_blob: bool = False,\n    default_version: str | None = None,\n    default_content_type: str | None = None,\n):\n    \"\"\"\n    Initialize a Spot instance.\n\n    Args:\n        name: Name of the spot/workspace.\n        db: Database for tasks, can be a filepath or TaskDB instance.\n        storage_path: Path for storing blobs locally.\n        s3_opts: Options for S3 storage.\n        tpm: Tokens per minute for rate limiting.\n        io_workers: Number of IO workers for executor.\n        blob_warning_threshold: Threshold size (bytes) to warn when saving large data to SQLite.\n        executor: Optional pre-created executor.\n        storage: Optional pre-created storage instance.\n        default_save_blob: Default value for save_blob in mark/run.\n        default_version: Default version string for mark/run.\n        default_content_type: Default content_type for mark/run.\n    \"\"\"\n    self.name = name\n    self.blob_warning_threshold = blob_warning_threshold\n\n    # Store defaults\n    self.default_save_blob = default_save_blob\n    self.default_version = default_version\n    self.default_content_type = default_content_type\n\n    # --- Workspace Setup ---\n    # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u7528\u306e\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\n    self.workspace_dir = Path(\".beautyspot\")\n    self._setup_workspace()\n\n    # --- \u30ad\u30e3\u30c3\u30b7\u30e5\u7ba1\u7406\u7528 \u30c6\u30fc\u30d6\u30eb\u78ba\u8a8d\u3068\u521d\u671f\u5316 ---\n    if db is None:\n        # \u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306eDB\u30d5\u30a1\u30a4\u30eb\n        self.db = SQLiteTaskDB(str(self.workspace_dir / f\"{name}.db\"))\n    elif isinstance(db, str):\n        self.db = SQLiteTaskDB(db)\n    elif isinstance(db, TaskDB):\n        self.db = db\n    else:\n        raise TypeError(\n            \"Argument 'db' must be a string (path) or a TaskDB instance.\"\n        )\n    self.db.init_schema()\n\n    # --- Rate Limiter ---\n    self.bucket = TokenBucket(tpm)\n\n    # --- Serializer Setup ---\n    self.serializer = MsgpackSerializer()\n\n    # --- Storage \u521d\u671f\u5316 ---\n    if storage is not None:\n        self.storage = storage\n    else:\n        # storage_path\u304c\u672a\u6307\u5b9a\u306a\u3089\u3001\u96a0\u3057\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306eblobs\u3092\u4f7f\u3046\n        if storage_path is None:\n            final_storage_path = str(self.workspace_dir / \"blobs\")\n        else:\n            final_storage_path = storage_path\n\n        self.storage = create_storage(final_storage_path, s3_opts)\n\n    # -- Executor Management ---\n    if executor is not None:\n        self.executor = executor\n        self._own_executor = False\n    else:\n        self.executor = ThreadPoolExecutor(max_workers=io_workers)\n        self._own_executor = True\n\n        # \u81ea\u52d5\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u306e\u767b\u9332\n        # self\u3078\u306e\u5f37\u3044\u53c2\u7167\u3092\u6301\u305f\u305b\u306a\u3044\u3088\u3046\u3001executor\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3051\u3092\u6b8b\u3059\u3053\u3068\n        self._finalizer = weakref.finalize(\n            self, Spot._shutdown_executor, self.executor,\n        )\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.cached_run","title":"<code>cached_run(*funcs, save_blob=None, input_key_fn=None, version=None, content_type=None)</code>","text":"<p>Create a temporary context for executing function(s) with caching.</p> <p>This is the recommended way to use beautyspot for imperative execution, replacing the deprecated <code>spot.run()</code>.</p> <p>Parameters:</p> Name Type Description Default <code>*funcs</code> <code>Callable</code> <p>One or more functions to wrap.</p> <code>()</code> <code>save_blob</code> <code>Optional[bool]</code> <p>Override save_blob setting.</p> <code>None</code> <code>input_key_fn</code> <code>Optional[Callable]</code> <p>Custom key generator.</p> <code>None</code> <code>version</code> <code>str | None</code> <p>Cache version string.</p> <code>None</code> <code>content_type</code> <code>Optional[str]</code> <p>Content type string.</p> <code>None</code> Usage Source code in <code>src/beautyspot/core.py</code> <pre><code>def cached_run(\n    self,\n    *funcs: Callable,\n    save_blob: Optional[bool] = None,\n    input_key_fn: Optional[Callable] = None,\n    version: str | None = None,\n    content_type: Optional[str] = None,\n):\n    \"\"\"\n    Create a temporary context for executing function(s) with caching.\n\n    This is the recommended way to use beautyspot for imperative execution,\n    replacing the deprecated `spot.run()`.\n\n    Args:\n        *funcs: One or more functions to wrap.\n        save_blob: Override save_blob setting.\n        input_key_fn: Custom key generator.\n        version: Cache version string.\n        content_type: Content type string.\n\n    Usage:\n        # Single function\n        with spot.cached_run(func) as task:\n            task(data)\n\n        # Multiple functions (unpacked)\n        with spot.cached_run(f1, f2, version=\"v2\") as (t1, t2):\n            t1(data)\n            t2(data)\n    \"\"\"\n    if not funcs:\n        raise ValueError(\"At least one function must be provided to cached_run.\")\n\n    return ScopedMark(\n        self,\n        funcs,\n        save_blob=save_blob,\n        input_key_fn=input_key_fn,\n        version=version,\n        content_type=content_type\n    )\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.cached_run--single-function","title":"Single function","text":"<p>with spot.cached_run(func) as task:     task(data)</p>"},{"location":"reference/core/#beautyspot.core.Spot.cached_run--multiple-functions-unpacked","title":"Multiple functions (unpacked)","text":"<p>with spot.cached_run(f1, f2, version=\"v2\") as (t1, t2):     t1(data)     t2(data)</p>"},{"location":"reference/core/#beautyspot.core.Spot.limiter","title":"<code>limiter(cost=1)</code>","text":"<p>Rate Limiting Decorator.</p> <p>Parameters:</p> Name Type Description Default <code>cost</code> <code>Union[int, Callable]</code> <p>Cost associated with the function, can be an int or a callable that returns an int.</p> <code>1</code> Source code in <code>src/beautyspot/core.py</code> <pre><code>def limiter(self, cost: Union[int, Callable] = 1):\n    \"\"\"\n    Rate Limiting Decorator.\n\n    Args:\n        cost: Cost associated with the function, can be an int or a callable that returns an int.\n    \"\"\"\n\n    def decorator(func):\n        is_async = inspect.iscoroutinefunction(func)\n\n        @functools.wraps(func)\n        def sync_wrapper(*args, **kwargs):\n            c = cost(*args, **kwargs) if callable(cost) else cost\n            self.bucket.consume(c)\n            return func(*args, **kwargs)\n\n        @functools.wraps(func)\n        async def async_wrapper(*args, **kwargs):\n            c = cost(*args, **kwargs) if callable(cost) else cost\n            await self.bucket.consume_async(c)\n            return await func(*args, **kwargs)\n\n        return async_wrapper if is_async else sync_wrapper\n\n    return decorator\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.mark","title":"<code>mark(_func=None, *, save_blob=None, input_key_fn=None, version=None, content_type=None)</code>","text":"<pre><code>mark(_func: Callable[P, R]) -&gt; Callable[P, R]\n</code></pre><pre><code>mark(*, save_blob: Optional[bool] = None, input_key_fn: Optional[Callable] = None, version: str | None = None, content_type: Optional[str] = None) -&gt; Callable[[Callable[P, R]], Callable[P, R]]\n</code></pre> <p>Mark a function as a managed spot (Resumable Task Decorator).</p> Source code in <code>src/beautyspot/core.py</code> <pre><code>def mark(\n    self,\n    _func: Optional[Callable] = None,\n    *,\n    save_blob: Optional[bool] = None,\n    input_key_fn: Optional[Union[Callable, KeyGenPolicy]] = None,\n    version: str | None = None,\n    content_type: Optional[str] = None,\n) -&gt; Any:\n    \"\"\"\n    Mark a function as a managed spot (Resumable Task Decorator).\n    \"\"\"\n    if save_blob is None:\n        save_blob = self.default_save_blob\n\n    def decorator(func):\n        is_async = inspect.iscoroutinefunction(func)\n\n        # --- Policy Binding Setup (ADDED) ---\n        # If a Policy is provided, bind it to the decorated function immediately.\n        effective_key_fn: Optional[Callable] = None\n\n        if isinstance(input_key_fn, KeyGenPolicy):\n            effective_key_fn = input_key_fn.bind(func)\n        else:\n            effective_key_fn = input_key_fn\n\n        # Key Gen Helper\n        def make_key(args, kwargs):\n            from .cachekey import KeyGen\n\n            iid = (\n                effective_key_fn(*args, **kwargs)\n                if effective_key_fn\n                else KeyGen.default(args, kwargs)\n            )\n\n            key_source = f\"{func.__name__}:{iid}\"\n            if version:\n                key_source += f\":{version}\"\n\n            ck = hashlib.md5(key_source.encode()).hexdigest()\n            return iid, ck\n\n        @functools.wraps(func)\n        def sync_wrapper(*args, **kwargs):\n            iid, ck = make_key(args, kwargs)\n\n            cached = self._check_cache_sync(ck)\n            if cached is not CACHE_MISS:\n                return cached\n\n            res = func(*args, **kwargs)\n\n            self._save_result_sync(\n                ck, func.__name__, str(iid), version, res, content_type, save_blob\n            )\n            return res\n\n        @functools.wraps(func)\n        async def async_wrapper(*args, **kwargs):\n            iid, ck = make_key(args, kwargs)\n            loop = asyncio.get_running_loop()\n\n            cached = await loop.run_in_executor(\n                self.executor, self._check_cache_sync, ck\n            )\n            if cached is not CACHE_MISS:\n                return cached\n\n            res = await func(*args, **kwargs)\n\n            await loop.run_in_executor(\n                self.executor,\n                self._save_result_sync,\n                ck,\n                func.__name__,\n                str(iid),\n                version,\n                res,\n                content_type,\n                save_blob,\n            )\n            return res\n\n        return async_wrapper if is_async else sync_wrapper\n\n    if _func is not None and callable(_func):\n        return decorator(_func)\n\n    return decorator\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.register","title":"<code>register(code, encoder, decoder=None, decoder_factory=None)</code>","text":"<p>Decorator to register a custom type for serialization.</p> Source code in <code>src/beautyspot/core.py</code> <pre><code>def register(\n    self,\n    code: int,\n    encoder: Callable[[Any], bytes],\n    decoder: Optional[Callable[[bytes], Any]] = None,\n    decoder_factory: Optional[Callable[[Type], Callable[[bytes], Any]]] = None,\n) -&gt; Callable[[Type], Type]:\n    \"\"\"\n    Decorator to register a custom type for serialization.\n    \"\"\"\n    if decoder is None and decoder_factory is None:\n        raise ValueError(\"Must provide either `decoder` or `decoder_factory`.\")\n\n    def decorator(cls: Type) -&gt; Type:\n        actual_decoder = decoder\n        # \u30af\u30e9\u30b9\u751f\u6210\u5f8c\u306b\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5b9f\u884c\u3057\u3066\u30c7\u30b3\u30fc\u30c0\u3092\u53d6\u5f97\n        if decoder_factory:\n            actual_decoder = decoder_factory(cls)\n\n        # --- \u4ee5\u4e0b\u306e\u30c1\u30a7\u30c3\u30af\u304c\u30c6\u30b9\u30c8\u901a\u904e\u306b\u5fc5\u9808\u3067\u3059 ---\n        if actual_decoder is None:\n             raise ValueError(\"Decoder resolution failed.\")\n        # ----------------------------------------\n\n        self.register_type(cls, code, encoder, actual_decoder)\n        return cls\n\n    return decorator\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.register_type","title":"<code>register_type(type_, code, encoder, decoder)</code>","text":"<p>Register a custom type for serialization (Msgpack Extension Type).</p> <p>Parameters:</p> Name Type Description Default <code>type_</code> <code>Type</code> <p>The class to handle (e.g. MyClass)</p> required <code>code</code> <code>int</code> <p>Unique integer ID (0-127) for this type</p> required <code>encoder</code> <code>Callable</code> <p>Function that converts obj -&gt; bytes</p> required <code>decoder</code> <code>Callable</code> <p>Function that converts bytes -&gt; obj</p> required Source code in <code>src/beautyspot/core.py</code> <pre><code>def register_type(\n    self, type_: Type, code: int, encoder: Callable, decoder: Callable\n):\n    \"\"\"\n    Register a custom type for serialization (Msgpack Extension Type).\n\n    Args:\n        type_: The class to handle (e.g. MyClass)\n        code: Unique integer ID (0-127) for this type\n        encoder: Function that converts obj -&gt; bytes\n        decoder: Function that converts bytes -&gt; obj\n    \"\"\"\n    self.serializer.register(type_, code, encoder, decoder)\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.run","title":"<code>run(func, *args, _save_blob=None, _input_key_fn=None, _version=None, _content_type=None, **kwargs)</code>","text":"<p>Execute a function with caching enabled.</p> <p>.. deprecated:: 2.0     Use <code>with spot.cached_run(func) as task: task(*args)</code> instead.</p> Source code in <code>src/beautyspot/core.py</code> <pre><code>def run(\n    self,\n    func: Callable,\n    *args,\n    _save_blob: Optional[bool] = None,\n    _input_key_fn: Optional[Callable] = None,\n    _version: str | None = None,\n    _content_type: Optional[str] = None,\n    **kwargs,\n) -&gt; Any:\n    \"\"\"\n    Execute a function with caching enabled.\n\n    .. deprecated:: 2.0\n        Use `with spot.cached_run(func) as task: task(*args)` instead.\n    \"\"\"\n    warnings.warn(\n        \"`spot.run()` is deprecated and will be removed in v3.0. \"\n        \"Please use `with spot.cached_run(func) as task: task(...)` instead \"\n        \"for better type safety and cleaner API.\",\n        DeprecationWarning,\n        stacklevel=2\n    )\n\n    if inspect.iscoroutinefunction(func):\n        return self._execute_async(\n            func, args, kwargs, _save_blob, _input_key_fn, _version, _content_type\n        )\n    else:\n        return self._execute_sync(\n            func, args, kwargs, _save_blob, _input_key_fn, _version, _content_type\n        )\n</code></pre>"},{"location":"reference/core/#beautyspot.core.Spot.shutdown","title":"<code>shutdown(wait=True)</code>","text":"<p>Manually release resources.</p> <p>Parameters:</p> Name Type Description Default <code>wait</code> <code>bool</code> <p>Whether to wait for the executor to be shut down.</p> <code>True</code> Source code in <code>src/beautyspot/core.py</code> <pre><code>def shutdown(self, wait: bool = True):\n    \"\"\"\n    Manually release resources.\n\n    Args:\n        wait: Whether to wait for the executor to be shut down.\n    \"\"\"\n    if self._own_executor and self._finalizer.alive:\n        self._finalizer()\n</code></pre>"},{"location":"reference/philosophy/","title":"\ud83c\udf11 The Philosophy of beautyspot","text":"<p><code>beautyspot</code> \u306f\u3001\u751f\u6210AI\u3068\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u30c7\u30fc\u30bf\u3092\u6271\u3046\u30b7\u30fc\u30f3\u306b\u304a\u3044\u3066\u3001\u958b\u767a\u8005\u304c\u300c\u30ed\u30b8\u30c3\u30af\u305d\u306e\u3082\u306e\u300d\u306b\u6ca1\u982d\u3057\u3001\u5408\u7406\u7684\u304b\u3064\u9ad8\u901f\u306b\u4fa1\u5024\u3092\u751f\u307f\u51fa\u3059\u305f\u3081\u306e\u958b\u767a\u30c4\u30fc\u30eb\u3067\u3059\u3002</p>"},{"location":"reference/philosophy/#1-core-philosophy","title":"1. Core Philosophy (\u8a2d\u8a08\u601d\u60f3)","text":""},{"location":"reference/philosophy/#kuroko-and-hokuro-non-intrusive-design","title":"Kuroko and Hokuro: Non-Intrusive Design","text":"<p>\u4e3b\u5f79\u306f\u5e38\u306b\u3001\u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\uff08\u30ed\u30b8\u30c3\u30af\uff09\u3067\u3059\u3002 <code>beautyspot</code> \u306f\u30c7\u30b3\u30ec\u30fc\u30bf\u3068\u3044\u3046\u5f62\u3067\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u304c\u3001\u3042\u306a\u305f\u306e\u30af\u30e9\u30b9\u8a2d\u8a08\u3084\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u306f\u4e00\u5207\u5e72\u6e09\u3057\u307e\u305b\u3093\u3002 \u7d99\u627f\u3092\u5f37\u8981\u305b\u305a\u3001\u8907\u96d1\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3082\u3042\u308a\u307e\u305b\u3093\u3002</p> <p>\"Beauty Spot (Hokuro)\" \u306e\u540d\u306e\u901a\u308a\u3001\u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\u4e0a\u306e\u91cd\u8981\u306a\u5834\u6240\uff08Spot\uff09\u306b\u5370\uff08Mark\uff09\u3092\u4ed8\u3051\u308b\u3060\u3051\u3067\u6a5f\u80fd\u3057\u307e\u3059\u3002 \u300c\u9ed2\u5b50\u300d\u3068\u3057\u3066\u3001\u88cf\u5074\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3084\u30ec\u30fc\u30c8\u5236\u9650\u3068\u3044\u3063\u305f\u8907\u96d1\u306a\u5236\u5fa1\u3092\u4e00\u624b\u306b\u5f15\u304d\u53d7\u3051\u3001\u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\u3092\u7f8e\u3057\u304f\u300c\u7d14\u7c8b\u306a\u30ed\u30b8\u30c3\u30af\u300d\u306e\u72b6\u614b\u306b\u4fdd\u3064\u3053\u3068\u306b\u8ca2\u732e\u3057\u307e\u3059\u3002</p>"},{"location":"reference/philosophy/#rational-iteration-speed-with-confidence","title":"Rational Iteration: Speed with Confidence","text":"<p>\u5065\u5168\u306a\u8a66\u884c\u932f\u8aa4\u306e\u305f\u3081\u306e\u57fa\u76e4\u3092\u3001\u6700\u901f\u6700\u8efd\u91cf\u3067\u63d0\u4f9b\u3057\u307e\u3059\u3002 API\u306e\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3001\u9014\u4e2d\u505c\u6b62\u304b\u3089\u306e\u30ea\u30ab\u30d0\u30ea\u3001\u305d\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u7ba1\u7406\u3002\u3053\u308c\u3089\u306f\u3001\u751f\u6210AI\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u3068\u3063\u3066\u672c\u8cea\u7684\u306a\u8981\u7d20\u3067\u3001\u5408\u7406\u7684\u306a\u8a66\u884c\u932f\u8aa4\u3092\u884c\u3046\u305f\u3081\u306b\u4e0d\u53ef\u6b20\u306a\u300c\u8db3\u5834\u300d\u3067\u3059\u3002 \u3057\u304b\u3057\u3001\u3053\u306e\u8db3\u5834\u3092\u7d44\u3080\u305f\u3081\u306b\u6642\u9593\u3092\u8cbb\u3084\u3057\u3066\u306f\u3001\u672c\u672b\u8ee2\u5012\u3067\u3059\u3002 <code>beautyspot</code> \u306f\u3001\u3053\u306e\u5fc5\u9808\u306e\u8db3\u5834\u3092\u5373\u5ea7\u306b\u63d0\u4f9b\u3057\u307e\u3059\u3002\u300c\u5931\u6557\u3057\u3066\u3082\u5927\u4e08\u592b\u300d\u300c\u6b62\u307e\u3063\u3066\u3082\u518d\u958b\u3067\u304d\u308b\u300d\u3068\u3044\u3046\u5b89\u5fc3\u611f\u304c\u30c1\u30e3\u30ec\u30f3\u30b8\u3092\u5bb9\u6613\u306b\u3057\u3001\u767a\u60f3\u306e\u4f59\u5730\u3092\u5e83\u3052\u3001\u30b9\u30d4\u30fc\u30c9\u3068\u54c1\u8cea\u3092\u540c\u6642\u306b\u5f15\u304d\u4e0a\u3052\u307e\u3059\u3002</p>"},{"location":"reference/philosophy/#transparent-existence-no-lock-in","title":"Transparent Existence: No Lock-in","text":"<p>\u7a7a\u6c17\u306e\u3088\u3046\u306b\u7e8f\u3044\u3001\u3044\u3064\u3067\u3082\u8131\u3052\u308b\u3053\u3068\u3002 \u7279\u5b9a\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3078\u306e\u30ed\u30c3\u30af\u30a4\u30f3\uff08\u56f2\u3044\u8fbc\u307f\uff09\u3092\u5acc\u3044\u307e\u3059\u3002 \u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u5916\u3057\u305f\u77ac\u9593\u3001\u3042\u306a\u305f\u306e\u30b3\u30fc\u30c9\u306f\u6a19\u6e96\u7684\u306a Python \u95a2\u6570\u306b\u623b\u308a\u307e\u3059\u3002 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304c\u6210\u9577\u3057\u3001\u5927\u898f\u6a21\u306a\u5206\u6563\u57fa\u76e4\u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u3068\u304d\u2500\u2500\u305d\u308c\u304c <code>beautyspot</code> \u304b\u3089\u306e\u300c\u5352\u696d\u300d\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3059\u3002\u305d\u306e\u6642\u3001\u3042\u306a\u305f\u306f\u75db\u307f\u306a\u304f\u6b21\u306e\u30b9\u30c6\u30fc\u30b8\u3078\u79fb\u884c\u3067\u304d\u307e\u3059\u3002\u305d\u308c\u307e\u3067\u306e\u9593\u3001\u79c1\u305f\u3061\u306f\u6700\u9ad8\u306e\u4f34\u8d70\u8005\u3068\u3057\u3066\u632f\u308b\u821e\u3044\u307e\u3059\u3002</p>"},{"location":"reference/philosophy/#2-anti-goals","title":"2. Anti-Goals (\u3084\u3089\u306a\u3044\u3053\u3068)","text":"<p>\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30b7\u30f3\u30d7\u30eb\u3055\u3068\u300c\u5352\u696d\u306e\u3057\u3084\u3059\u3055\u300d\u3092\u5b88\u308b\u305f\u3081\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u306f\u610f\u56f3\u7684\u306b\u5b9f\u88c5\u3057\u307e\u305b\u3093\u3002</p>"},{"location":"reference/philosophy/#not-a-distributed-system","title":"Not a Distributed System (\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u306a\u3044)","text":"<p>Redis \u3084 Memcached \u3092\u524d\u63d0\u3068\u3057\u305f\u5206\u6563\u30ed\u30c3\u30af\u3001\u30ea\u30fc\u30c0\u30fc\u9078\u51fa\u3001\u6574\u5408\u6027\u30d7\u30ed\u30c8\u30b3\u30eb\uff08Raft/Paxos\uff09\u306f\u5b9f\u88c5\u3057\u307e\u305b\u3093\u3002 \u3053\u308c\u3089\u304c\u5fc5\u8981\u306a\u898f\u6a21\u306f <code>beautyspot</code> \u306e\u9818\u5206\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u79c1\u305f\u3061\u306f\u3001\u30ed\u30fc\u30ab\u30eb\uff08\u307e\u305f\u306f\u5358\u4e00\u30ce\u30fc\u30c9\uff09\u74b0\u5883\u306b\u304a\u3044\u3066\u3001\u6700\u901f\u6700\u8efd\u91cf\u306e\u958b\u767a\u4f53\u9a13\u3092\u63d0\u4f9b\u3059\u308b\u3053\u3068\u306b\u96c6\u4e2d\u3057\u307e\u3059\u3002</p>"},{"location":"reference/philosophy/#not-a-workflow-engine","title":"Not a Workflow Engine (\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u30a8\u30f3\u30b8\u30f3\u3067\u306f\u306a\u3044)","text":"<p>Airflow \u3084 Prefect \u306e\u3088\u3046\u306a\u3001DAG\uff08\u6709\u5411\u975e\u5de1\u56de\u30b0\u30e9\u30d5\uff09\u306b\u3088\u308b\u4f9d\u5b58\u95a2\u4fc2\u89e3\u6c7a\u3084\u3001\u8907\u96d1\u306a\u30ea\u30c8\u30e9\u30a4\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306f\u63d0\u4f9b\u3057\u307e\u305b\u3093\u3002 \u3042\u304f\u307e\u3067\u300c\u95a2\u6570\u5358\u4f4d\u300d\u306e\u5b9f\u884c\u5236\u5fa1\u306b\u7559\u3081\u307e\u3059\u3002</p>"},{"location":"reference/philosophy/#not-a-job-queue","title":"Not a Job Queue (\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u3067\u306f\u306a\u3044)","text":"<p>Celery \u306e\u3088\u3046\u306a\u3001\u30ef\u30fc\u30ab\u30fc\u3078\u306e\u30bf\u30b9\u30af\u5206\u6563\uff08Dispatch\uff09\u6a5f\u80fd\u306f\u6301\u3061\u307e\u305b\u3093\u3002 \u3053\u306e\u30c4\u30fc\u30eb\u306f\u300c\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u305f\u305d\u306e\u5834\u300d\u3067\u4ed5\u4e8b\u3092\u3057\u307e\u3059\u3002</p>"},{"location":"reference/philosophy/#not-an-observability-platform","title":"Not an Observability Platform (\u76e3\u8996\u57fa\u76e4\u3067\u306f\u306a\u3044)","text":"<p>Datadog \u3084 Prometheus \u306e\u3088\u3046\u306a\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u84c4\u7a4d\u30fb\u76e3\u8996\u30fb\u30a2\u30e9\u30fc\u30c8\u6a5f\u80fd\u306f\u5185\u88fd\u3057\u307e\u305b\u3093\u3002 \u30ed\u30b0\u3084\u30a4\u30d9\u30f3\u30c8\u306f\u300c\u5410\u304d\u51fa\u3059\u300d\u3053\u3068\u306b\u5fb9\u3057\u3001\u305d\u306e\u6d3b\u7528\u306f\u5c02\u7528\u306e\u30c4\u30fc\u30eb\u306b\u59d4\u306d\u307e\u3059\u3002\u4ed8\u5c5e\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306f\u3001\u3042\u304f\u307e\u3067\u958b\u767a\u4e2d\u306e\u300c\u30c7\u30d0\u30c3\u30b0\u3068\u73fe\u72b6\u78ba\u8a8d\u300d\u306e\u305f\u3081\u306e\u7c21\u6613\u30d3\u30e5\u30fc\u30a2\u3067\u3059\u3002</p>"},{"location":"reference/storage/","title":"Storage","text":""},{"location":"reference/storage/#beautyspot.storage","title":"<code>beautyspot.storage</code>","text":""},{"location":"reference/storage/#beautyspot.storage.CacheCorruptedError","title":"<code>CacheCorruptedError</code>","text":"<p>               Bases: <code>Exception</code></p> <p>Raised when blob data cannot be deserialized (e.g. code changes).</p> Source code in <code>src/beautyspot/storage.py</code> <pre><code>class CacheCorruptedError(Exception):\n    \"\"\"Raised when blob data cannot be deserialized (e.g. code changes).\"\"\"\n    pass\n</code></pre>"},{"location":"reference/storage/#beautyspot.storage.create_storage","title":"<code>create_storage(path, options=None)</code>","text":"<p>Factory function to create a storage backend based on the path protocol.</p> <p>Parameters:</p> Name Type Description Default <code>path</code> <code>str</code> <p>Storage path or URI (e.g., \"./data\", \"s3://my-bucket/prefix\").</p> required <code>options</code> <code>dict | None</code> <p>Extra options passed to the backend (e.g., boto3 client args).</p> <code>None</code> Source code in <code>src/beautyspot/storage.py</code> <pre><code>def create_storage(path: str, options: dict | None = None) -&gt; BlobStorageBase:\n    \"\"\"\n    Factory function to create a storage backend based on the path protocol.\n\n    Args:\n        path: Storage path or URI (e.g., \"./data\", \"s3://my-bucket/prefix\").\n        options: Extra options passed to the backend (e.g., boto3 client args).\n    \"\"\"\n    if path.startswith(\"s3://\"):\n        return S3Storage(path, options)\n\n    # \u5c06\u6765\u7684\u306a\u62e1\u5f35\u30dd\u30a4\u30f3\u30c8 (\u4f8b: gs://, azure://)\n    # if path.startswith(\"gs://\"):\n    #     return GCSStorage(path, options)\n\n    return LocalStorage(path)\n</code></pre>"},{"location":"reference/types/","title":"Types","text":""},{"location":"reference/types/#beautyspot.types","title":"<code>beautyspot.types</code>","text":""},{"location":"reference/types/#beautyspot.types.ContentType","title":"<code>ContentType</code>","text":"<p>Supported semantic content types for beautyspot tasks. Used by the dashboard to determine the appropriate rendering widget.</p> Source code in <code>src/beautyspot/types.py</code> <pre><code>class ContentType:\n    \"\"\"\n    Supported semantic content types for beautyspot tasks.\n    Used by the dashboard to determine the appropriate rendering widget.\n    \"\"\"\n\n    TEXT = \"text/plain\"\n    JSON = \"application/json\"\n    MARKDOWN = \"text/markdown\"\n    PNG = \"image/png\"\n    JPEG = \"image/jpeg\"\n    MERMAID = \"text/vnd.mermaid\"\n    GRAPHVIZ = \"text/vnd.graphviz\"\n    HTML = \"text/html\"\n</code></pre>"}]}